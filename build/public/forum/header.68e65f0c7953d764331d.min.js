"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[34590,99127,13201,98813,68326,34271,1091,49897],{86174:(E,m,i)=>{var l,p;l=[i(19046),i(71949),i(11599),i(29930)],p=function(h,C,g,u){const d={};d.prepareDOM=function(){app.user.uid>0&&h.initUnreadTopics(),C.prepareDOM(),g.prepareDOM(),n(),r(),f()};function n(){$('[component="header/usercontrol"] [data-status]').off("click").on("click",function(s){const e=$(this).attr("data-status");socket.emit("user.setStatus",e,function(o){if(o)return u.error(o);$('[data-uid="'+app.user.uid+'"] [component="user/status"], [component="header/profilelink"] [component="user/status"]').removeClass("away online dnd offline").addClass(e),$('[component="header/usercontrol"] [data-status]').each(function(){$(this).toggleClass("selected",$(this).attr("data-status")===e)}),app.user.status=e}),s.preventDefault()})}function r(){const s=utils.findBootstrapEnvironment();s==="xs"||s==="sm"||utils.isTouchDevice()||$("#header-menu #main-nav").tooltip({selector:".nav-item",placement:"bottom",trigger:"hover",container:"body",animation:!1})}function f(){$("body").on("click",'[component="user/logout"]',function(){return i.e(20739).then(function(){var s=[i(75427)];(function(e){e()}).apply(null,s)}).catch(i.oe),!1})}return d}.apply(m,l),p!==void 0&&(E.exports=p)},11599:(E,m,i)=>{var l,p;l=[i(52473),i(91749),i(49897)],p=function(h,C,g){const u={};u.prepareDOM=function(){const s=$('[component="chat/dropdown"]');s.length&&(s.on("show.bs.dropdown",e=>{f("loadChatsDropdown",$(e.target).parent().find('[component="chat/list"]'))}),s.each((e,o)=>{const t=$(o).parent().find(".dropdown-menu");t.hasClass("show")&&f("loadChatsDropdown",t.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",d),socket.on("event:chats.receive",d),socket.removeListener("event:chats.typing",n),socket.on("event:chats.typing",n),socket.removeListener("event:chats.roomRename",r),socket.on("event:chats.roomRename",r),socket.on("event:unread.updateChatCount",async function(e){if(e){const[a,w]=await app.require(["chat","forum/chats"]);if(a.isFromBlockedUser(e.fromUid)||a.isLookingAtRoom(e.roomId)||app.user.uid===parseInt(e.fromUid,10))return;w.markChatPageElUnread(e)}let{count:o}=await g.get("/chats/unread");const t=h.get("chat/icon");o=Math.max(0,o),t.toggleClass("fa-comment",o>0).toggleClass("fa-comment-o",o<=0);const c=o>99?"99+":o;h.get("chat/icon").toggleClass("unread-count",o>0).attr("data-content",c),h.get("chat/count").toggleClass("hidden",o<=0).text(c),C.fire("action:chat.updateCount",{count:o})}))};function d(s){f("onChatMessageReceived",s)}function n(s){f("onUserTyping",s)}function r(s){f("onRoomRename",s)}async function f(s,e){(await app.require("chat"))[s](e)}return u}.apply(m,l),p!==void 0&&(E.exports=p)},71949:(E,m,i)=>{var l;l=function(){const p={};p.prepareDOM=function(){const u=$('[component="notifications"] [data-bs-toggle="dropdown"]');u.length&&(u.on("show.bs.dropdown",d=>{g("loadNotifications",$(d.target).parent().find('[component="notifications/list"]'))}),u.each((d,n)=>{const r=$(n).parent().find(".dropdown-menu");r.hasClass("show")&&g("loadNotifications",r.find('[component="notifications/list"]'))}),socket.removeListener("event:new_notification",h),socket.on("event:new_notification",h),socket.removeListener("event:notifications.updateCount",C),socket.on("event:notifications.updateCount",C))};function h(u){g("onNewNotification",u)}function C(u){g("updateNotifCount",u)}function g(u,d){Promise.all([i.e(65928),i.e(81307)]).then(function(){var n=[i(36849)];(function(r){r[u](d)}).apply(null,n)}).catch(i.oe)}return p}.call(m,i,m,E),l!==void 0&&(E.exports=l)},19046:(E,m,i)=>{var l,p;l=[i(91749)],p=function(h){const C={},g={ignoring:1,notwatching:2,watching:3};C.initUnreadTopics=function(){const n=app.user.unreadData;function r(e){if(e&&e.posts&&e.posts.length&&n){const o=e.posts[0];if(parseInt(o.uid,10)===parseInt(app.user.uid,10)||!o.topic.isFollowing&&o.categoryWatchState!==g.watching)return;const t=o.topic.tid;(!n[""][t]||!n.new[t]||!n.watched[t]||!n.unreplied[t])&&s(t),n[""][t]||(f(""),n[""][t]=!0),o.isMain&&parseInt(o.uid,10)!==parseInt(app.user.uid,10)&&!n.new[t]&&(f("new"),n.new[t]=!0),parseInt(o.topic.postcount,10)<=1&&!n.unreplied[t]&&(f("unreplied"),n.unreplied[t]=!0),o.topic.isFollowing&&!n.watched[t]&&(f("watched"),n.watched[t]=!0)}}function f(e){const o="/unread"+(e?"?filter="+e:""),t=1+parseInt($('a[href="'+config.relative_path+o+'"].navigation-link i').attr("data-content"),10);d(o,t)}function s(e){$('[data-tid="'+e+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(e){delete n[e][ajaxify.data.tid]})}),socket.removeListener("event:new_post",r),socket.on("event:new_post",r),socket.removeListener("event:unread.updateCount",u),socket.on("event:unread.updateCount",u)};function u(n){d("/unread",n.unreadTopicCount),d("/unread?filter=new",n.unreadNewTopicCount),d("/unread?filter=watched",n.unreadWatchedTopicCount),d("/unread?filter=unreplied",n.unreadUnrepliedTopicCount)}function d(n,r){if(!utils.isNumber(r))return;r=Math.max(0,r);const f=r>99?"99+":r,s=$('a[href="'+config.relative_path+n+'"].navigation-link');s.find("i").toggleClass("unread-count",r>0).attr("data-content",f),s.find('[component="navigation/count"]').toggleClass("hidden",r<=0).text(r),$('#mobile-menu [data-unread-url="'+n+'"]').attr("data-content",f),$('[component="unread/count"][data-unread-url="'+n+'"]').toggleClass("hidden",r<=0).text(f),h.fire("action:unread.updateCount",{url:n,count:r})}return C.updateUnreadTopicCount=d,C}.apply(m,l),p!==void 0&&(E.exports=p)},49897:(E,m,i)=>{i.r(m),i.d(m,{del:()=>o,get:()=>n,head:()=>r,patch:()=>s,post:()=>f,put:()=>e});var l=i(91749),p=i.n(l),h=i(40027),C=i.n(h);const g=config.relative_path+"/api/v3";async function u(t,c){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:g+t.url,typeof c=="function"){d(t).then(a=>c(null,a),a=>c(a));return}try{return await d(t)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again.")return(0,h.confirm)("[[error:api.reauth-required]]",w=>{w&&ajaxify.go("login")});throw a}}async function d(t){const{url:c}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,l.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const a=await fetch(c,t),{headers:w}=a,D=w.get("content-type"),A=D&&D.startsWith("application/json");let v;if(t.method!=="head"&&(A?v=await a.json():v=await a.text()),!a.ok)throw v?new Error(A?v.status.message:v):new Error(a.statusText);return A&&v&&v.hasOwnProperty("status")&&v.hasOwnProperty("response")?v.response:v}function n(t,c,a){return u({url:t+(c&&Object.keys(c).length?"?"+$.param(c):"")},a)}function r(t,c,a){return u({url:t+(c&&Object.keys(c).length?"?"+$.param(c):""),method:"head"},a)}function f(t,c,a){return u({url:t,method:"post",data:c,headers:{"x-csrf-token":config.csrf_token}},a)}function s(t,c,a){return u({url:t,method:"patch",data:c,headers:{"x-csrf-token":config.csrf_token}},a)}function e(t,c,a){return u({url:t,method:"put",data:c,headers:{"x-csrf-token":config.csrf_token}},a)}function o(t,c,a){return u({url:t,method:"delete",data:c,headers:{"x-csrf-token":config.csrf_token}},a)}}}]);
