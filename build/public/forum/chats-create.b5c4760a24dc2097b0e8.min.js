"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[73023,99127,37147,34271,1091,49897],{80083:(A,m,s)=>{var d,l;d=[s(52473),s(49897),s(29930),s(53309)],l=function(h,v,f,c){const i={};i.init=function(){h.get("chat/create").on("click",g)};async function g(){let p=[];app.user.isAdmin&&({groups:p}=await v.get("/admin/groups"),p.sort((a,e)=>e.system-a.system).map(a=>{const{name:e,displayName:t}=a;return{name:e,displayName:t}}));const y=await app.parseAndTranslate("modals/create-room",{user:app.user,groups:p}),o=bootbox.dialog({title:"[[modules:chat.create-room]]",message:y,onEscape:!0,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:function(){const a=o.find('[component="chat/room/name"]').val(),e=o.find('[component="chat/room/users"] [component="chat/user"]').find("[data-uid]").map((E,C)=>$(C).attr("data-uid")).get(),t=o.find('[component="chat/room/type"]').val(),n=o.find('[component="chat/room/groups"]').val();return t==="private"&&!e.length?(f.error("[[error:no-users-selected]]"),!1):t==="public"&&!n.length?(f.error("[[error:no-groups-selected]]"),!1):app.user.uid?(v.post("/chats",{roomName:a,uids:e,type:t,groups:n}).then(({roomId:E})=>{ajaxify.go("chats/"+E),o.modal("hide")}).catch(f.error),!1):(f.error("[[error:not-logged-in]]"),!1)}}}}),r=o.find('[component="chat/room/users"]');c.init({onSelect:async function(a){const e=await app.parseAndTranslate("modals/create-room","selectedUsers",{selectedUsers:[a]});r.append(e)}}),r.on("click",'[component="chat/room/users/remove"]',function(){$(this).parents("[data-uid]").remove()}),o.find('[component="chat/room/type"]').on("change",function(){const a=$(this).val();o.find('[component="chat/room/public/options"]').toggleClass("hidden",a==="private")})}return i}.apply(m,d),l!==void 0&&(A.exports=l)},53309:(A,m,s)=>{var d,l;d=[s(52473),s(49897),s(29930)],l=function(h,v,f){const c={};let i=[];c.init=function(r){r=r||{},i.length=0,h.get("chat/search").on("keyup",utils.debounce(p,250));const a=$('[component="chat/search/list"]');a.on("click","[data-uid]",function(){r.onSelect&&r.onSelect(i.find(e=>parseInt(e.uid,10)===parseInt($(this).attr("data-uid"),10))),g(a)})};function g(r){h.get("chat/search").val(""),y(r),r.find('[component="chat/search/no-users"]').addClass("hidden"),r.find('[component="chat/search/start-typing"]').removeClass("hidden")}function p(){const r=$('[component="chat/search/list"]'),a=h.get("chat/search").val();if(!a)return g(r);r.find('[component="chat/search/start-typing"]').addClass("hidden"),v.get("/api/users",{query:a,searchBy:"username",paginate:!1}).then(o).catch(f.error)}function y(r){i.length=0,r.find("[data-uid]").remove()}async function o(r){const a=$('[component="chat/search/list"]');if(y(a),r.users=r.users.filter(function(t){return parseInt(t.uid,10)!==parseInt(app.user.uid,10)}),i=r.users,!r.users.length)return a.find('[component="chat/search/no-users"]').removeClass("hidden");a.find('[component="chat/search/no-users"]').addClass("hidden");const e=await app.parseAndTranslate("modals/create-room","searchUsers",{searchUsers:r.users});a.append(e),a.parent().toggleClass("show",!0)}return c}.apply(m,d),l!==void 0&&(A.exports=l)},49897:(A,m,s)=>{s.r(m),s.d(m,{del:()=>a,get:()=>g,head:()=>p,patch:()=>o,post:()=>y,put:()=>r});var d=s(91749),l=s.n(d),h=s(40027),v=s.n(h);const f=config.relative_path+"/api/v3";async function c(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:f+e.url,typeof t=="function"){i(e).then(n=>t(null,n),n=>t(n));return}try{return await i(e)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again.")return(0,h.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go("login")});throw n}}async function i(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,d.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const n=await fetch(t,e),{headers:E}=n,C=E.get("content-type"),D=C&&C.startsWith("application/json");let u;if(e.method!=="head"&&(D?u=await n.json():u=await n.text()),!n.ok)throw u?new Error(D?u.status.message:u):new Error(n.statusText);return D&&u&&u.hasOwnProperty("status")&&u.hasOwnProperty("response")?u.response:u}function g(e,t,n){return c({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},n)}function p(e,t,n){return c({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},n)}function y(e,t,n){return c({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function o(e,t,n){return c({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function r(e,t,n){return c({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}function a(e,t,n){return c({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},n)}}}]);
