"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[26477,99127,5719,42289,34271,51831,69185,86198,1091,49897],{67855:(j,v,s)=>{var C,h;C=[s(39259),s(65348),s(49897),s(29930),s(40027),s(28061),s(47283)],h=function(b,A,x,g,d,t,e){const c={};c.init=function(){$('[data-bs-toggle="tooltip"]').tooltip(),b.init($('[component="category/dropdown"]'),{privilege:"moderate"}),n(),o(),u('[data-action="editContent"]',".post-content-editable","textarea",".post-content"),u('[data-action="editTitle"]',".topic-title-editable","input",".topic-title"),$(".posts-list").on("click",".topic-category[data-editable]",function(r){l(this),r.stopPropagation(),r.preventDefault()}),$('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid")};function a(r){return new Promise(f=>{d.confirm(r,f)})}function u(r,f,m,p){$(".posts-list").on("click",r,function(){const y=$(this),E=y.parents("[data-id]").find(f),w=y.parents("[data-id]").find(p);E.length&&(w.addClass("hidden"),E.removeClass("hidden").find(m).focus())}),$(".posts-list").on("blur",f+" "+m,function(){const y=$(this),E=y.parent().parent().find(p),w=y.parents("[data-id]").attr("data-id"),D=r==='[data-action="editTitle"]';socket.emit("posts.editQueuedContent",{id:w,title:D?y.val():void 0,content:D?void 0:y.val()},function(k,S){if(k)return g.error(k);D?E.find(".title-text").text(S.postData.title):E.html(S.postData.content),y.parent().addClass("hidden"),E.removeClass("hidden")})})}function l(r){const f=$(r),m=f.parents("[data-id]").attr("data-id");return A.modal({onSubmit:function(p){Promise.all([x.get(`/categories/${p.cid}`,{}),socket.emit("posts.editQueuedContent",{id:m,cid:p.cid})]).then(function(y){const E=y[0];app.parseAndTranslate("post-queue","posts",{posts:[{category:E}]},function(w){f.find(".category-text").length?f.find(".category-text").text(w.find(".topic-category .category-text").text()):f.replaceWith(w.find(".topic-category"))})}).catch(g.error)}}),!1}function n(){const r=document.querySelector(".posts-list");r&&r.addEventListener("click",f=>{const m=f.target.closest("[data-action]");if(m){const p=m.getAttribute("data-action"),y=m.closest("[data-uid]").getAttribute("data-uid");switch(p){case"editCategory":{const E=f.target.closest("[data-id]").querySelector(".topic-category");l(E);break}case"ban":t.banAccount(y,ajaxify.refresh);break;case"unban":t.unbanAccount(y);break;case"mute":t.muteAccount(y,ajaxify.refresh);break;case"unmute":t.unmuteAccount(y);break;case"delete-account":e.account(y,ajaxify.go.bind(null,"post-queue"));break;case"delete-content":e.content(y,ajaxify.go.bind(null,"post-queue"));break;case"delete-all":e.purge(y,ajaxify.go.bind(null,"post-queue"));break;default:i.call(f.target);break}}})}async function i(){function r(){return new Promise(E=>{const w=d.dialog({title:"[[post-queue:notify-user]]",message:'<textarea class="form-control"></textarea>',buttons:{OK:{label:"[[modules:bootbox.send]]",callback:function(){const D=w.find("textarea").val();D&&E(D)}}}})})}const f=$(this).parents("[data-id]"),m=$(this).attr("data-action"),p=f.attr("data-id"),y=f.get(0).parentNode;if(!(!["accept","reject","notify"].includes(m)||m==="reject"&&!await a(ajaxify.data.canAccept?"[[post-queue:confirm-reject]]":"[[post-queue:confirm-remove]]")))return socket.emit("posts."+m,{id:p,message:m==="notify"?await r():void 0},function(E){if(E)return g.error(E);(m==="accept"||m==="reject")&&f.remove(),y.childElementCount===0&&(ajaxify.data.singlePost?ajaxify.go("/post-queue"+window.location.search):ajaxify.refresh())}),!1}function o(){$('[component="post-queue/bulk-actions"]').on("click","[data-action]",async function(){const r=$(this).attr("data-action");let f=$(".posts-list [data-id]");(r==="accept-selected"||r==="reject-selected")&&(f=f.filter((D,k)=>$(k).find('input[type="checkbox"]').is(":checked")));const m=f.map((D,k)=>$(k).attr("data-id")).get(),p=r==="reject-all"||r==="reject-selected",y=ajaxify.data.canAccept?`${r}-confirm`:`${r.replace(/^reject/,"remove")}-confirm`;if(!m.length||p&&!await a(`[[post-queue:${y}, ${m.length}]]`))return;const E=r.split("-")[0],w=m.map(D=>socket.emit("posts."+E,{id:D}));Promise.allSettled(w).then(function(D){const k=D.filter(P=>P.status==="fulfilled").length,S=D.filter(P=>P.status==="rejected");k&&(g.success(`[[post-queue:bulk-${E}-success, ${k}]]`),ajaxify.refresh()),S.forEach(P=>g.error(P.reason))})})}return c}.apply(v,C),h!==void 0&&(j.exports=h)},47283:(j,v,s)=>{var C,h;C=[s(49897),s(40027),s(29930)],h=function(b,A,x){const g={};g.account=function(t,e){d(t,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",e)},g.content=function(t,e){d(t,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",e)},g.purge=function(t,e){d(t,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",e)};function d(t,e,c,a,u){A.confirm(e,function(l){l&&b.del(`/users/${t}${c}`,{}).then(()=>{if(x.success(a),typeof u=="function")return u()}).catch(x.error)})}return g}.apply(v,C),h!==void 0&&(j.exports=h)},28061:(j,v,s)=>{var C,h;C=[s(81335),s(49897),s(40027),s(29930)],h=function(b,A,x,g){const d={};return d.banAccount=function(t,e){t=t||ajaxify.data.theirid,b.render("modals/temporary-ban",{}).then(function(c){x.dialog({className:"ban-modal",title:"[[user:ban-account]]",message:c,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban-account]]",callback:function(){const a=$(".ban-modal form").serializeArray().reduce(function(l,n){return l[n.name]=n.value,l},{}),u=a.length>0?Date.now()+a.length*1e3*60*60*(parseInt(a.unit,10)?24:1):0;A.put("/users/"+t+"/ban",{until:u,reason:a.reason||""}).then(()=>{if(typeof e=="function")return e();ajaxify.refresh()}).catch(g.error)}}}})})},d.unbanAccount=function(t){A.del("/users/"+t+"/ban").then(()=>{ajaxify.refresh()}).catch(g.error)},d.muteAccount=function(t,e){t=t||ajaxify.data.theirid,b.render("modals/temporary-mute",{}).then(function(c){x.dialog({className:"mute-modal",title:"[[user:mute-account]]",message:c,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute-account]]",callback:function(){const a=$(".mute-modal form").serializeArray().reduce(function(l,n){return l[n.name]=n.value,l},{}),u=a.length>0?Date.now()+a.length*1e3*60*60*(parseInt(a.unit,10)?24:1):0;A.put("/users/"+t+"/mute",{until:u,reason:a.reason||""}).then(()=>{if(typeof e=="function")return e();ajaxify.refresh()}).catch(g.error)}}}})})},d.unmuteAccount=function(t){A.del("/users/"+t+"/mute").then(()=>{ajaxify.refresh()}).catch(g.error)},d}.apply(v,C),h!==void 0&&(j.exports=h)},49897:(j,v,s)=>{s.r(v),s.d(v,{del:()=>l,get:()=>t,head:()=>e,patch:()=>a,post:()=>c,put:()=>u});var C=s(91749),h=s.n(C),b=s(40027),A=s.n(b);const x=config.relative_path+"/api/v3";async function g(n,i){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:x+n.url,typeof i=="function"){d(n).then(o=>i(null,o),o=>i(o));return}try{return await d(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again.")return(0,b.confirm)("[[error:api.reauth-required]]",r=>{r&&ajaxify.go("login")});throw o}}async function d(n){const{url:i}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,C.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(i,n),{headers:r}=o,f=r.get("content-type"),m=f&&f.startsWith("application/json");let p;if(n.method!=="head"&&(m?p=await o.json():p=await o.text()),!o.ok)throw p?new Error(m?p.status.message:p):new Error(o.statusText);return m&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function t(n,i,o){return g({url:n+(i&&Object.keys(i).length?"?"+$.param(i):"")},o)}function e(n,i,o){return g({url:n+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"head"},o)}function c(n,i,o){return g({url:n,method:"post",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function a(n,i,o){return g({url:n,method:"patch",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function u(n,i,o){return g({url:n,method:"put",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function l(n,i,o){return g({url:n,method:"delete",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}},39259:(j,v,s)=>{var C,h;C=[s(96349),s(49897),s(91749)],h=function(b,A,x){const g={};g.init=function(t,e){if(!t||!t.length)return;e=e||{},e.states=e.states||["watching","tracking","notwatching","ignoring"],e.template=e.template||"partials/category/filter-dropdown-left",x.fire("action:category.filter.options",{el:t,options:e}),b.init(t,e);let c=[],a=[];Array.isArray(e.selectedCids)?c=e.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(c=ajaxify.data.selectedCids.map(String)),a=c.slice(),t.on("hidden.bs.dropdown",function(){let u=a.length!==c.length;if(a.forEach(function(l,n){l!==c[n]&&(u=!0)}),a=c.slice(),u&&(e.updateButton?e.updateButton({el:t,changed:u,selectedCids:c.slice()}):e.updateButton!==!1&&d(t,c)),e.onHidden){e.onHidden({changed:u,selectedCids:c.slice()});return}if(u){let l=window.location.pathname;const n=utils.params();c.length?n.cid=c:delete n.cid,delete n.page,Object.keys(n).length&&(l+="?"+decodeURIComponent($.param(n))),ajaxify.go(l)}}),t.on("click",'[component="category/list"] [data-cid]',function(){const u=t.find('[component="category/list"]'),l=$(this),n=l.find("a").attr("href");if(n&&n!=="#"&&n.length)return;const i=l.attr("data-cid"),o=l.find('[component="category/select/icon"]');return i!=="all"?(c.includes(i)?c.splice(c.indexOf(i),1):c.push(i),c.sort(function(r,f){return r-f}),o.toggleClass("invisible"),u.find('[data-cid="all"] i').toggleClass("invisible",!!c.length)):(t.find('[component="category/select/icon"]').addClass("invisible"),u.find('[data-cid="all"] i').removeClass("invisible"),c=[]),e.selectedCids=c,e.onSelect&&e.onSelect({cid:i,selectedCids:c.slice()}),!1})};function d(t,e){e.length>1?c({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):e.length===1?A.get(`/categories/${e[0]}`,{}).then(c):c();function c(a){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:a},function(u){t.find("button").replaceWith($("<div/>").html(u).find("button"))})}}return g}.apply(v,C),h!==void 0&&(j.exports=h)},96349:(j,v,s)=>{var C,h;C=[s(29930),s(89336),s(49897)],h=function(b,A,x){const g={};return g.init=function(d,t){let e=null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let c=[];Array.isArray(t.localCategories)&&(c=t.localCategories.map(i=>({...i}))),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const a=d.find('[component="category-selector-search"]');if(!a.length)return;const u=a.parent('[component="category/dropdown"]').length>0||a.parent('[component="category-selector"]').length>0;d.on("show.bs.dropdown",function(){u&&(d.find(".dropdown-toggle").css({visibility:"hidden"}),a.removeClass("hidden"),a.css({"z-index":d.find(".dropdown-toggle").css("z-index")+1}));function i(){const o=a.find("input").val();o.length>1||!o&&!e?l(o,function(r){e=t.cacheList&&(e||r),n(r)}):!o&&e&&n(e)}a.on("click",function(o){o.preventDefault(),o.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(i,300)),i()}),d.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||a.find("input").focus()}),d.on("hide.bs.dropdown",function(){u&&(d.find(".dropdown-toggle").css({visibility:"inherit"}),a.addClass("hidden")),a.off("click"),a.find("input").off("keyup")});function l(i,o){x.get("/search/categories",{search:i,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(r,{categories:f}){if(r)return b.error(r);o(c.concat(f))})}function n(i){const o=t.selectedCids.map(String);i.forEach(function(r){r.selected=o.includes(String(r.cid))}),app.parseAndTranslate(t.template,{categoryItems:i.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(r){d.find('[component="category/list"]').html(r.find('[component="category/list"]').html()),d.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!i.length);const f=A.Dropdown.getInstance(d.find(".dropdown-toggle").get(0));f&&f.update()})}},g}.apply(v,C),h!==void 0&&(j.exports=h)},65348:(j,v,s)=>{var C,h;C=[s(96349),s(40027),s(91749),s(17459)],h=function(b,A,x,g){const d={};return d.init=function(t,e){if(!t||!t.length)return;e=e||{};const c=e.onSelect||function(){};e.states=e.states||["watching","tracking","notwatching","ignoring"],e.template=e.template||"partials/category/selector-dropdown-left",x.fire("action:category.selector.options",{el:t,options:e}),b.init(t,e);const a={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const l=$(this);return l.hasClass("disabled")?!1:(a.selectCategory(l.attr("data-cid")),c(a.selectedCategory))});let u=a.el.find('[component="category-selector-selected"]').html();return g.translate(u,l=>{u=l}),a.selectCategory=function(l){const n=a.el.find('[data-cid="'+l+'"]');a.selectedCategory={cid:l,name:n.attr("data-name")},n.length?a.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(u)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},e.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(e.template,{selectedCategory:e.selectedCategory},function(l){a.el.find('[component="category-selector-selected"]').html(l.find('[component="category-selector-selected"]').html())}),a},d.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(e){const c=A.dialog({title:t.title||"[[modules:composer.select-category]]",message:e,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),a=d.init(c.find('[component="category-selector"]'),t);function u(l){return l.preventDefault(),a.selectedCategory&&(t.onSubmit(a.selectedCategory),c.modal("hide")),!1}t.openOnLoad&&c.on("shown.bs.modal",function(){c.find(".dropdown-toggle").dropdown("toggle")}),c.find("form").on("submit",u)})},d}.apply(v,C),h!==void 0&&(j.exports=h)}}]);
