"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[76177,22765,75264,18631],{22410:(R,B,r)=>{var S,y;S=[r(91749),r(29930),r(49897)],y=function(N,E,I){const M={};let g,f=0,e=!1,u,T=0;M.init=function(i,d){const c=$("body");typeof i=="function"?(g=i,u=c):(g=d,u=i||c),f=$(window).scrollTop(),$(window).off("scroll",n).on("scroll",n),c.height()<=$(window).height()&&g(1)};function n(){T&&clearTimeout(T),T=setTimeout(function(){T=0,m()},60)}function m(){const i=utils.findBootstrapEnvironment(),d=(i==="xs"||i==="sm")&&$("html").hasClass("composing");if(e||d||app.flags._glance)return;const c=$(window).scrollTop(),l=$(window).height(),h=u.height()-l,v=u.offset()?u.offset().top:0,w=100*(c-v)/(h<=0?l:h),O=15,W=85,b=c>f?1:-1;(w<O&&c<f||w>W&&c>f||w<0&&b>0&&h<0)&&g(b),f=c}return M.loadMore=function(i,d,c){if(e)return;e=!0;const l={method:i,data:d};N.fire("action:infinitescroll.loadmore",l),(l.method.startsWith("/")?I.get:socket.emit)(l.method,l.data,function(v,w){if(v)return e=!1,E.error(v);c(w,function(){e=!1})})},M.loadMoreXhr=function(i,d){if(e)return;e=!0;const c=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),l={url:c,data:i};N.fire("action:infinitescroll.loadmore.xhr",l),$.get(c,i,function(h){d(h,function(){e=!1})}).fail(function(h){e=!1,E.error(String(h.responseJSON||"[[error:no-connection]]"))})},M.removeExtra=function(i,d,c){let l=$();if(i.length<=c)return l;const h=i.length-c;if(d>0){const v=$(document).height(),w=$(window).scrollTop();l=i.slice(0,h).remove(),$(window).scrollTop(w+($(document).height()-v))}else l=i.slice(i.length-h).remove();return l},M}.apply(B,S),y!==void 0&&(R.exports=y)},2269:(R,B)=>{var r,S;r=[],S=function(){const y={},N=/-resized(\.[\w]+)?$/;return y.wrapImagesInLinks=function(E){E.find('[component="post/content"] img:not(.emoji)').each(function(){y.wrapImageInLink($(this))})},y.wrapImageInLink=function(E){let I=E.attr("src")||"";if(I!=="about:blank"&&!E.parent().is("a")){utils.isRelativeUrl(I)&&N.test(I)&&(I=I.replace(N,"$1"));const M=E.attr("alt")||"",g=I.split(".").slice(1).pop(),f=M.split("/").pop(),e=f.split(".").slice(1).pop();E.wrap('<a href="'+I+'" '+(!g&&e?' download="'+utils.escapeHTML(f)+'" ':"")+' target="_blank" rel="noopener">')}},y}.apply(B,r),S!==void 0&&(R.exports=S)},47536:(R,B,r)=>{var S,y;S=[r(25967),r(22410),r(8454),r(2269),r(96352),r(52473),r(17459),r(91749),r(30076)],y=function(N,E,I,M,g,f,e,u,T){const n={};n.signaturesShown={};const m=$(window);n.onNewPost=function(t){!t||!t.posts||!t.posts.length||parseInt(t.posts[0].tid,10)!==parseInt(ajaxify.data.tid,10)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),n.modifyPostsByPrivileges(t.posts),d(t.posts),i(t.posts[0]),c(t.posts),ajaxify.data.postcount+=1,I.updatePostCount(ajaxify.data.postcount),config.usePagination?l(t):v(t),r.e(18631).then(function(){var o=[r(18631)];(function(s){s.onNewPost(t)}).apply(null,o)}).catch(r.oe))};function i(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}n.modifyPostsByPrivileges=function(t){t.forEach(function(o){o.selfPost=!!app.user.uid&&parseInt(o.uid,10)===parseInt(app.user.uid,10),o.topicOwnerPost=parseInt(o.uid,10)===parseInt(ajaxify.data.uid,10),o.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_moderator_tools=o.display_edit_tools||o.display_delete_tools,o.display_move_tools=ajaxify.data.privileges.isAdminOrMod,o.display_post_menu=ajaxify.data.privileges.isAdminOrMod||o.selfPost&&!ajaxify.data.locked&&!o.deleted||o.selfPost&&o.deleted&&parseInt(o.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!o.deleted})};function d(t){for(let o=0;o<t.length;o+=1){const s=f.get("user/postcount",t[o].uid);s.html(T.formattedNumber(parseInt(s.attr("data-postcount"),10)+1))}}function c(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,f.get("post").not("[data-index=0]").each(function(){const o=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",o)}))}function l(t){function o(){w(t.posts[0])}const s=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(s[0].topic.postcount/config.postsPerPage));const a=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&a===1||ajaxify.data.pagination.currentPage===1&&a===-1){const C=$('[component="post"]:not([data-index=0]), [component="topic/event"]');O(t,C,a,!1,o)}else ajaxify.data.scrollToMyPost&&parseInt(s[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){N.loadPage(ajaxify.data.pagination.pageCount,o)},250):h()}function h(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(o){$('[component="pagination"]').after(o).remove()})})}function v(t){const o=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,s=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!s&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!s&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const a=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');O(t,a,o,!1,function(p){p&&p.addClass("new"),w(t.posts[0])})}function w(t){t.selfPost&&ajaxify.data.scrollToMyPost&&g.scrollBottom(t.index)}function O(t,o,s,a,p){if(p=p||function(){},!t||t.posts&&!t.posts.length)return p();function C(){const A=$('[component="post"].new');if(A.length===t.posts.length){let j=!0;if(A.each(function(x,_){parseInt($(_).attr("data-pid"),10)!==parseInt(t.posts[x].pid,10)&&(j=!1)}),j){A.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}A.length&&t.posts.length>1&&t.posts.forEach(function(j){const x=f.get("post","pid",j.pid);x.hasClass("new")&&x.remove()}),t.posts=t.posts.filter(function(j){return j.allowDupe||$('[component="post"][data-pid="'+j.pid+'"]').length===0})}if(C(),!t.posts.length)return p();let P,D;s>0&&o.length?P=o.last():s<0&&o.length&&(D=o.first()),u.fire("action:posts.loading",{posts:t.posts,after:P,before:D}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(A){A=A.filter(function(){const x=$(this),_=x.attr("data-pid"),K=x.attr("data-allow-dupe");return!x.is('[component="post"]')||K||_&&$('[component="post"][data-pid="'+_+'"]').length===0});const j=E.removeExtra($('[component="post"]'),s,Math.max(20,config.postsPerPage*2));if(P)A.insertAfter(P);else if(D){const x=$(document).height(),_=m.scrollTop();A.insertBefore(D),(a||_>0)&&m.scrollTop(_+($(document).height()-x))}else f.get("topic").append(A);await n.onNewPostsAddedToDom(A),F(j),u.fire("action:posts.loaded",{posts:t.posts}),p(A)})}n.loadMorePosts=function(t){if(!f.get("topic").length||g.scrollActive)return;const o=f.get("topic").find(f.get("post").not("[data-index=0]").not(".new")),s=t>0?o.last():o.first(),a=parseInt(s.attr("data-index"),10)||0,p=ajaxify.data.tid;if(!utils.isNumber(p)||!utils.isNumber(a)||t<0&&f.get("post","index",0).length)return;const C=$(".loading-indicator");C.is(":animated")||C.fadeIn(),E.loadMore("topics.loadMore",{tid:p,after:a+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(P,D){if(C.fadeOut(),P&&P.posts&&P.posts.length){const A=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');O(P,A,t,!0,D)}else g.update(),D()})},n.onTopicPageLoad=async function(t){L(t),M.wrapImagesInLinks(t),b(t),n.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),n.addBlockquoteEllipses(t),U(t),await W()},n.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const o=await Promise.all(t.map(s=>app.parseAndTranslate("partials/topic/event",{...s,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(o);else if(config.topicPostSort==="newest_to_oldest"){const s=$('[component="topic"] [component="post"][data-index="0"]');s.length?s.after(o.reverse()):$('[component="topic"]').prepend(o.reverse())}$('[component="topic/event"] .timeago').timeago()};async function W(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const o=m.scrollTop(),s=$('[component="post"]').toArray();await Promise.all(s.map(async function(a){a=$(a);const p=a.prev('[component="post"]');if(a.is(":has(.necro-post)")||!p.length||config.topicPostSort==="newest_to_oldest"&&parseInt(p.attr("data-index"),10)===0)return;const C=a.attr("data-timestamp")-p.attr("data-timestamp");if(Math.abs(C)>=t){const P=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],D={};P.forEach(x=>{D[x]=$.timeago.settings.strings[x],$.timeago.settings.strings[x]=""});const A=(C>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(C)+"]]";P.forEach(x=>{$.timeago.settings.strings[x]=D[x]});const j=await app.parseAndTranslate("partials/topic/necro-post",{text:A});j.attr("data-necro-post-index",p.attr("data-index")),j.insertBefore(a)}})),o>0&&m.scrollTop()<o&&m.scrollTop(o)}function b(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((o,s)=>{const a=$(s).find('[component="post/signature"]'),p=a.attr("data-uid");n.signaturesShown[p]?a.addClass("hidden"):n.signaturesShown[p]=!0})}function F(t){t.each((o,s)=>{$(`[data-necro-post-index="${$(s).attr("data-index")}"]`).remove()})}function L(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const o=document.createElement("a");o.className="login-required",o.href=config.relative_path+"/login",e.translate("[[topic:login-to-view]]",function(s){o.appendChild(document.createTextNode(s)),t.each(function(a,p){$(p).find('[component="post/content"] img').each(function(C,P){P=$(P),P.attr("src").startsWith(config.relative_path+config.upload_url)&&P.replaceWith(o.cloneNode(!0))})})})}n.onNewPostsAddedToDom=async function(t){await n.onTopicPageLoad(t),t.find(".timeago").timeago()},n.showBottomPostBar=function(){const t=f.get("post","index",0),o=$(".post-bar-placeholder"),s=$('[component="post"]');t.length&&s.length>1&&$(".post-bar").length<2&&o.length?($(".post-bar").clone().insertAfter(o),o.remove()):t.length&&s.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&I.toggle($(this).attr("data-pid"),!0)})}return n.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((a,p)=>!$(p).parent().is("blockquote")).find(">blockquote").each(function(){const a=$(this);a.find(":hidden:not(br)").length&&!a.find(".toggle").length&&a.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},n}.apply(B,S),y!==void 0&&(R.exports=y)},18631:(R,B,r)=>{var S,y;S=[r(47536),r(91749),r(29930),r(49897)],y=function(N,E,I,M){const g={};g.init=function(e){const u=e.closest("[data-pid]"),T=u.data("pid"),n=e.find('[component="post/replies/open"]'),m=e.find('[component="post/replies/loading"]'),i=e.find('[component="post/replies/close"]');n.is(":not(.hidden)")&&m.is(".hidden")?(n.addClass("hidden"),m.removeClass("hidden"),M.get(`/posts/${T}/replies`,{},function(d,{replies:c}){const l=c;if(m.addClass("hidden"),d)return n.removeClass("hidden"),I.error(d);i.removeClass("hidden"),l.forEach((v,w)=>{v&&(v.index=w)}),N.modifyPostsByPrivileges(l);const h={posts:l,privileges:ajaxify.data.privileges,"downvote:disabled":ajaxify.data["downvote:disabled"],"reputation:disabled":ajaxify.data["reputation:disabled"],loggedIn:!!app.user.uid,hideReplies:config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0};app.parseAndTranslate("topic","posts",h,async function(v){const w=$("<ul>",{component:"post/replies",class:"list-unstyled"}).html(v).hide();e.attr("data-target-component")?u.find('[component="'+e.attr("data-target-component")+'"]').html(w):w.insertAfter(e),w.slideDown("fast"),await N.onNewPostsAddedToDom(v),E.fire("action:posts.loaded",{posts:l})})})):i.is(":not(.hidden)")&&(i.addClass("hidden"),n.removeClass("hidden"),m.addClass("hidden"),u.find('[component="post/replies"]').slideUp("fast",function(){$(this).remove()}))},g.onNewPost=function(e){const u=e.posts[0];u&&(f(u,1),e.hideReplies=config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0,app.parseAndTranslate("topic","posts",e,async function(T){const n=$('[component="post"][data-pid="'+u.toPid+'"] [component="post/replies"]').first();n.length&&(config.topicPostSort==="newest_to_oldest"?n.prepend(T):n.append(T),await N.onNewPostsAddedToDom(T))}))},g.onPostPurged=function(e){f(e,-1)};function f(e,u){const T=document.querySelector(`[component="post"][data-pid="${e.toPid}"]`);if(!T)return;const n=$('[component="post"][data-pid="'+e.toPid+'"]').find('[component="post/reply-count"]').first(),m=n.find('[component="post/reply-count/text"]'),i=n.find('[component="post/reply-count/avatars"]'),d=Math.max(0,(parseInt(m.attr("data-replies"),10)||0)+u),c=n.find(".timeago").attr("title",e.timestampISO),l=T.getAttribute("data-index"),h=d===1&&Math.abs(e.index-l)===1;m.attr("data-replies",d),n.toggleClass("hidden",d<=0||h),d>1?m.translateText("[[topic:replies-to-this-post, "+d+"]]"):m.translateText("[[topic:one-reply-to-this-post]]"),!i.find('[data-uid="'+e.uid+'"]').length&&d<7&&app.parseAndTranslate("topic","posts",{posts:[{replies:{count:d,hasMore:!1,users:[e.user]}}]},function(v){i.prepend(v.find('[component="post/reply-count/avatars"]').html())}),i.addClass("hasMore"),c.data("timeago",null).timeago()}return g}.apply(B,S),y!==void 0&&(R.exports=y)}}]);
