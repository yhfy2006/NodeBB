"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[12533,99127,22765,34271,1091,49897,92747],{92747:(b,E,c)=>{var p,h;p=[c(49897),c(40027),c(29930),c(2269)],h=function(u,m,a){const r={},y={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};r.open=function(s){config.enablePostHistory&&u.get(`/posts/${s}/diffs`,{}).then(f=>{g(f).then(l=>{const o=m.dialog({title:"[[topic:diffs.title]]",message:l,size:"large",onEscape:!0,backdrop:!0});if(!f.timestamps.length)return;const i=o.find("select"),t=o.find('button[data-action="restore"]'),n=o.find('button[data-action="delete"]'),e=o.find("ul.posts-list"),_=o.find(".number-of-diffs strong");i.on("change",function(){r.load(s,this.value,e),t.prop("disabled",f.timestamps.indexOf(this.value)===0),n.prop("disabled",f.timestamps.indexOf(this.value)===0)}),t.on("click",function(){r.restore(s,i.val(),o)}),n.on("click",function(){r.delete(s,i.val(),i,_)}),o.on("shown.bs.modal",function(){r.load(s,i.val(),e),t.prop("disabled",!0),n.prop("disabled",!0)})})}).catch(a.error)},r.load=function(s,f,l){config.enablePostHistory&&u.get(`/posts/${s}/diffs/${f}`,{}).then(o=>{o.deleted=!!parseInt(o.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[o]},function(i){l.empty().append(i),l.find(".timeago").timeago()})}).catch(a.error)},r.restore=function(s,f,l){config.enablePostHistory&&u.put(`/posts/${s}/diffs/${f}`,{}).then(()=>{l.modal("hide"),a.success("[[topic:diffs.post-restored]]")}).catch(a.error)},r.delete=function(s,f,l,o){u.del(`/posts/${s}/diffs/${f}`).then(i=>{g(i,"diffs").then(t=>{l.empty().append(t),l.trigger("change");const n=l.find("option").length;o.text(n),a.success("[[topic:diffs.deleted]]")})}).catch(a.error)};function g(s,f){return new Promise(l=>{const o=[{diffs:s.revisions.map(function(i){const t=parseInt(i.timestamp,10);return{username:i.username,timestamp:t,pretty:new Date(t).toLocaleString(config.userLang.replace("_","-"),y)}}),numDiffs:s.timestamps.length,editable:s.editable,deletable:s.deletable},function(i){l(i)}];f&&o.unshift(f),app.parseAndTranslate("modals/post-history",...o)})}return r}.apply(E,p),h!==void 0&&(b.exports=h)},2269:(b,E)=>{var c,p;c=[],p=function(){const h={},u=/-resized(\.[\w]+)?$/;return h.wrapImagesInLinks=function(m){m.find('[component="post/content"] img:not(.emoji)').each(function(){h.wrapImageInLink($(this))})},h.wrapImageInLink=function(m){let a=m.attr("src")||"";if(a!=="about:blank"&&!m.parent().is("a")){utils.isRelativeUrl(a)&&u.test(a)&&(a=a.replace(u,"$1"));const r=m.attr("alt")||"",y=a.split(".").slice(1).pop(),g=r.split("/").pop(),s=g.split(".").slice(1).pop();m.wrap('<a href="'+a+'" '+(!y&&s?' download="'+utils.escapeHTML(g)+'" ':"")+' target="_blank" rel="noopener">')}},h}.apply(E,c),p!==void 0&&(b.exports=p)},49897:(b,E,c)=>{c.r(E),c.d(E,{del:()=>i,get:()=>g,head:()=>s,patch:()=>l,post:()=>f,put:()=>o});var p=c(91749),h=c.n(p),u=c(40027),m=c.n(u);const a=config.relative_path+"/api/v3";async function r(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:a+t.url,typeof n=="function"){y(t).then(e=>n(null,e),e=>n(e));return}try{return await y(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,u.confirm)("[[error:api.reauth-required]]",_=>{_&&ajaxify.go("login")});throw e}}async function y(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,p.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:_}=e,P=_.get("content-type"),D=P&&P.startsWith("application/json");let d;if(t.method!=="head"&&(D?d=await e.json():d=await e.text()),!e.ok)throw d?new Error(D?d.status.message:d):new Error(e.statusText);return D&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function g(t,n,e){return r({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function s(t,n,e){return r({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},e)}function f(t,n,e){return r({url:t,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function l(t,n,e){return r({url:t,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function o(t,n,e){return r({url:t,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function i(t,n,e){return r({url:t,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
