"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[94747,99127,34271,1091,38395,49897,90677],{90677:(_,v,f)=>{var p,h;p=[f(52473),f(16227),f(17459),f(29930),f(49897)],h=function(x,s,g,c,m){const y={};let a,l,d;y.init=function(e){a||(d=ajaxify.data.tid,app.parseAndTranslate("modals/move-post",{},function(i){a=i,l=a.find("#move_posts_confirm"),$("body").append(a),a.find("#move_posts_cancel").on("click",P),a.find("#topicId").on("keyup",utils.debounce(n,200)),s.init(o),t(),e&&s.togglePostSelection(e,e.attr("data-pid")),$(window).off("action:ajaxify.end",r).on("action:ajaxify.end",r),l.on("click",function(){const j=u();if(!j)return;l.attr("disabled",!0);const A={pids:s.pids.slice(),tid:j};if(config.undoTimeout>0)return c.alert({alert_id:"pids_move_"+s.pids.join("-"),title:"[[topic:thread-tools.move-posts]]",message:"[[topic:topic-move-posts-success]]",type:"success",timeout:config.undoTimeout,timeoutfn:function(){E(A)},clickfn:function(k,I){delete I.timeoutfn,c.success("[[topic:topic-move-posts-undone]]"),l.removeAttr("disabled")}});E(A)})}))};function r(){if(!a)return;const e=a.find("#topicId");let i=null;ajaxify.data.template.topic&&ajaxify.data.tid&&parseInt(ajaxify.data.tid,10)!==d&&(i=ajaxify.data.tid),i&&e.val(i),n()}function u(){const e=a.find("#topicId");return e.length&&e.val()?e.val():ajaxify.data.template.topic&&ajaxify.data.tid}function t(){if(!a)return;const e=u();s.pids.length?e&&parseInt(e,10)!==parseInt(d,10)?m.get("/topics/"+e,{}).then(function(i){if(!i||!i.tid)return c.error("[[error:no-topic]]");if(i.scheduled)return c.error("[[error:cant-move-posts-to-scheduled]]");const j=g.compile("topic:x-posts-will-be-moved-to-y",s.pids.length,i.title);a.find("#pids").translateHtml(j)}):a.find("#pids").translateHtml("[[topic:x-posts-selected, "+s.pids.length+"]]"):a.find("#pids").translateHtml("[[topic:no-posts-selected]]")}function n(){if(!a)return;const e=u();s.pids.length&&e&&parseInt(e,10)!==parseInt(d,10)?l.removeAttr("disabled"):l.attr("disabled",!0),t()}function o(){n()}function E(e){e.tid&&Promise.all(e.pids.map(i=>m.put(`/posts/${i}/move`,{tid:e.tid}))).then(()=>{e.pids.forEach(function(i){x.get("post","pid",i).fadeOut(500,function(){$(this).remove()})}),e.pids.length&&ajaxify.data.template.topic&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go(`/post/${e.pids[0]}`),P()}).catch(c.error)}function P(){a&&(a.remove(),a=null,s.disable(),$(window).off("action:ajaxify.end",r))}return y}.apply(v,p),h!==void 0&&(_.exports=h)},49897:(_,v,f)=>{f.r(v),f.d(v,{del:()=>u,get:()=>y,head:()=>a,patch:()=>d,post:()=>l,put:()=>r});var p=f(91749),h=f.n(p),x=f(40027),s=f.n(x);const g=config.relative_path+"/api/v3";async function c(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:g+t.url,typeof n=="function"){m(t).then(o=>n(null,o),o=>n(o));return}try{return await m(t)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again.")return(0,x.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go("login")});throw o}}async function m(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,p.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const o=await fetch(n,t),{headers:E}=o,P=E.get("content-type"),e=P&&P.startsWith("application/json");let i;if(t.method!=="head"&&(e?i=await o.json():i=await o.text()),!o.ok)throw i?new Error(e?i.status.message:i):new Error(o.statusText);return e&&i&&i.hasOwnProperty("status")&&i.hasOwnProperty("response")?i.response:i}function y(t,n,o){return c({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},o)}function a(t,n,o){return c({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},o)}function l(t,n,o){return c({url:t,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}function d(t,n,o){return c({url:t,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}function r(t,n,o){return c({url:t,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}function u(t,n,o){return c({url:t,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},o)}},16227:(_,v,f)=>{var p,h;p=[f(52473)],h=function(x){const s={};let g;s.pids=[];let c=!1;s.init=function(d,r){s.pids.length=0,g=d,r=r||{},c=r.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',m),a()};function m(d){d.stopPropagation();const r=$(this).attr("data-pid"),u=$('[component="topic"] [data-pid="'+r+'"]');!c&&parseInt($(this).attr("data-index"),10)===0||s.togglePostSelection(u,r)}s.disable=function(){s.pids.forEach(function(d){x.get("post","pid",d).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',m),l()},s.togglePostSelection=function(d,r){if(r){const u=s.pids.indexOf(r);u===-1?(s.pids.push(r),d.toggleClass("selected",!0)):(s.pids.splice(u,1),d.toggleClass("selected",!1)),s.pids.length&&s.pids.sort(function(t,n){return t-n}),typeof g=="function"&&g()}};function y(){return!1}function a(){$("#content").on("click",'[component="post"] button, [component="post"] a',y)}function l(){$("#content").off("click",'[component="post"] button, [component="post"] a',y)}return s}.apply(v,p),h!==void 0&&(_.exports=h)}}]);
