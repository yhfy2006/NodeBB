(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[27810,98088,25285,33069,98463],{22148:(x,R,o)=>{"use strict";var I,b;I=[o(22410),o(60984),o(8454),o(57642),o(47536),o(96352),o(43349),o(95692),o(52473),o(68636),o(91749),o(49897),o(29930),o(40027),o(57576)],b=function(g,E,s,y,v,i,l,d,t,n,r,a,m,k,w){const P={};let A=0,C="";$(window).on("action:ajaxify.start",function(c,f){y.removeListeners(),String(f.url).startsWith("topic/")||(i.disable(),t.get("navbar/title").find("span").text("").hide(),m.remove("bookmark"))}),P.init=async function(){const c=!A||parseInt(A,10)!==parseInt(ajaxify.data.tid,10);A=ajaxify.data.tid,C=ajaxify.currentPage,r.fire("action:topic.loading"),app.enterRoom("topic_"+A),c&&(v.signaturesShown={}),await v.onTopicPageLoad(t.get("post")),i.init('[component="topic"]>[component="post"]',ajaxify.data.postcount,P.toTop,P.toBottom,P.navigatorCallback),s.init(A),E.init(A,$(".topic")),y.init(),l.handleSort("topicPostSort","topic/"+ajaxify.data.slug),config.usePagination||g.init($('[component="topic"]'),v.loadMorePosts),e(),h(),j(),L(),K(),Y(),U(A),H(),$(window).on("scroll",utils.debounce(Q,250)),N(),r.fire("action:topic.loaded",ajaxify.data)};function N(){Promise.resolve().then(function(){var c=[o(6411)];(f=>{config.topicSearchEnabled&&Promise.resolve().then(function(){var p=[o(69749)];(function(u){f.bind(["command+f","ctrl+f"],function(T){T.preventDefault();let D=$('[component="navbar"] [component="search/form"]');D.length||(D=$('[component="sidebar/right"] [component="search/form"]')),D.find('[component="search/fields"] input[name="query"]').val("in:topic-"+ajaxify.data.tid+" "),u.showAndFocusInput(D)}),r.onPage("action:ajaxify.cleanup",()=>{f.unbind(["command+f","ctrl+f"])})}).apply(null,p)}).catch(o.oe),f.bind("j",p=>{if(p.target.classList.contains("mousetrap"))return;const u=i.getIndex(),T=i.getCount();u!==T&&i.scrollToIndex(u,!0,0)}),f.bind("k",p=>{if(p.target.classList.contains("mousetrap"))return;const u=i.getIndex();u!==1&&i.scrollToIndex(u-2,!0,0)})}).apply(null,c)}).catch(o.oe)}P.toTop=function(){i.scrollTop(0)},P.toBottom=function(){socket.emit("topics.postcount",ajaxify.data.tid,function(c,f){if(c)return m.error(c);i.scrollBottom(f-1)})};function U(c){if(window.location.hash){const u=$(utils.escapeHTML(window.location.hash));if(u.length){const T=u.parents("[data-pid]");return i.scrollToElement(T,!0,0)}}const f=ajaxify.data.bookmark||n.getItem("topic:"+c+":bookmark"),p=ajaxify.data.postIndex;if(B(p),i.shouldScrollToPost(p))return i.scrollToPostIndex(p-1,!0,0);f&&(!config.usePagination||config.usePagination&&ajaxify.data.pagination.currentPage===1)&&ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&m.alert({alert_id:"bookmark",message:"[[topic:bookmark-instructions]]",timeout:15e3,type:"info",clickfn:function(){i.scrollToIndex(Math.max(0,parseInt(f,10)-1),!0)},closefn:function(){n.removeItem("topic:"+c+":bookmark")}})}function H(){const c=document.querySelector('[component="topic/thumb/list"]');c&&c.addEventListener("click",async f=>{const p=f.target.closest("a");if(p){const u=Array.from(p.parentNode.children).indexOf(p);f.preventDefault();const T=ajaxify.data.thumbs.map(S=>({...S}));T.forEach((S,F)=>{S.selected=F===u});const D=await app.parseAndTranslate("modals/topic-thumbs-view",{src:p.href,thumbs:T});k.dialog({size:"lg",onEscape:!0,backdrop:!0,message:D}).on("click",'[component="topic/thumb/select"]',function(){$('[component="topic/thumb/select"]').removeClass("border-primary"),$(this).addClass("border-primary"),$('[component="topic/thumb/current"]').attr("src",$(this).attr("src"))})}})}function e(){t.get("topic").on("click","blockquote .toggle",function(){const c=$(this).parent("blockquote"),f=$(this);c.toggleClass("uncollapsed");const p=!c.hasClass("uncollapsed");f.toggleClass("fa-angle-down",p).toggleClass("fa-angle-up",!p)})}function h(){new w('[component="copy/code/btn"]',{text:function(f){const p=$(f);p.find("i").removeClass("fa-copy").addClass("fa-check"),setTimeout(()=>p.find("i").removeClass("fa-check").addClass("fa-copy"),2e3);const u=p.parent().find("code");return u.attr("data-lines")&&u.find(".hljs-ln-code[data-line-number]").length?u.find(".hljs-ln-code[data-line-number]").map((T,D)=>D.textContent).get().join(`
`):u.text()}});function c(){function f(S){return S.scrollHeight>S.clientHeight}function p(S){if(S.length){if(!S[0].scrollHeight)return setTimeout(p,100,S);f(S.get(0))&&S.parent().parent().find('[component="copy/code/btn"]').css({margin:"0.5rem 1.5rem 0 0"})}}let u=$('[component="topic"] [component="post/content"] code:not([data-button-added])');u=u.filter((S,F)=>$(F).text().includes(`
`));const T=$('<div class="hover-parent position-relative"></div>'),D=$('<button component="copy/code/btn" class="hover-visible position-absolute top-0 btn btn-sm btn-outline-secondary" style="right: 0px; margin: 0.5rem 0.5rem 0 0;"><i class="fa fa-fw fa-copy"></i></button>'),W=u.parent();W.wrap(T).parent().append(D),W.parent().find('[component="copy/code/btn"]').translateAttr("title","[[topic:copy-code]]"),W.each((S,F)=>{p($(F).find("code"))}),u.attr("data-button-added",1)}r.registerPage("action:posts.loaded",c),r.registerPage("action:topic.loaded",c),r.registerPage("action:posts.edited",c)}function j(){t.get("topic").on("click",'[component="post/parent"]',function(c){const f=$(this).attr("data-topid"),p=$('[component="topic"]>[component="post"][data-pid="'+f+'"]');if(p.length)return c.preventDefault(),i.scrollToIndex(p.attr("data-index"),!0),!1})}function L(){$('[component="topic"]').on("click",'[component="post/reply-count"]',function(){const c=$(this);o.e(18631).then(function(){var f=[o(18631)];(function(p){p.init(c)}).apply(null,f)}).catch(o.oe)})}function K(){if(!ajaxify.data.showPostPreviewsOnHover||utils.isMobile())return;let c=0,f=!1;const p={};function u(){clearTimeout(c),$("#post-tooltip").remove(),f=!0}$(window).one("action:ajaxify.start",u),$('[component="topic"]').on("mouseenter",'[component="post"] a, [component="topic/event"] a',async function(){const T=$(this);f=!1;async function D(O){const M=p[O]||await a.get(`/posts/${O}/summary`);if($("#post-tooltip").remove(),M&&ajaxify.data.template.topic){p[O]=M;const z=await app.parseAndTranslate("partials/topic/post-preview",{post:M});if(f)return;z.hide().find(".timeago").timeago(),z.appendTo($("body")).fadeIn(300);const X=T.parents('[component="topic"]').find('[component="post/content"]').first(),Z=X.offset(),q=X.width(),_=T.offset();z.css({top:_.top+30,left:Z.left,width:q})}}const W=T.attr("href"),S=utils.urlToLocation(W),F=S.pathname,J=W&&W!=="#"&&window.location.hostname===S.hostname;$("#post-tooltip").remove();const V=J&&F&&F.match(/\/post\/([\d]+)/),G=J&&F&&F.match(/\/topic\/([\d]+)/);if(V){const O=V[1];if(parseInt(T.parents('[component="post"]').attr("data-pid"),10)===parseInt(O,10))return;c=setTimeout(async()=>{D(O)},300)}else G&&(c=setTimeout(async()=>{const O=G[1],M=await a.get("/topics/"+O,{});D(M.mainPid)},300))}).on("mouseleave",'[component="post"] a, [component="topic/event"] a',u)}function Y(){(config.enableQuickReply||config.theme&&config.theme.enableQuickReply)&&d.init()}function Q(){const c=t.get("navbar/title").find("span");$(window).scrollTop()>50&&c.hasClass("hidden")?c.html(ajaxify.data.title).removeClass("hidden"):$(window).scrollTop()<=50&&!c.hasClass("hidden")&&c.html("").addClass("hidden"),$(window).scrollTop()>300&&m.remove("bookmark")}P.navigatorCallback=function(c,f){if(!ajaxify.data.template.topic||i.scrollActive)return;const p="topic/"+ajaxify.data.slug+(c>1?"/"+c:"");if(p!==C&&(C=p,c>=f&&app.user.uid&&a.put(`/topics/${ajaxify.data.tid}/read`),B(c),ajaxify.data.updateUrlWithPostIndex&&history.replaceState)){let u=window.location.search||"";config.usePagination||(u=u&&!/^\?page=\d+$/.test(u)?u:""),history.replaceState({url:p+u},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+p+u)}};function B(c){const f="topic:"+ajaxify.data.tid+":bookmark",p=ajaxify.data.bookmark||n.getItem(f);config.topicPostSort==="newest_to_oldest"&&(c=Math.max(1,ajaxify.data.postcount-c+2)),ajaxify.data.postcount>ajaxify.data.bookmarkThreshold&&(!p||parseInt(c,10)>parseInt(p,10)||ajaxify.data.postcount<parseInt(p,10))&&(app.user.uid?(ajaxify.data.bookmark=Math.min(c,ajaxify.data.postcount),socket.emit("topics.bookmark",{tid:ajaxify.data.tid,index:ajaxify.data.bookmark},function(u){if(u)return ajaxify.data.bookmark=p,m.error(u)})):n.setItem(f,c)),(!p||parseInt(c,10)>=parseInt(p,10))&&m.remove("bookmark")}return P}.apply(R,I),b!==void 0&&(x.exports=b)},57642:(x,R,o)=>{"use strict";var I,b;I=[o(8454),o(60984),o(47536),o(2269),o(52473),o(17459),o(91749),o(30076)],b=function(g,E,s,y,v,i,l,d){const t={},n={"event:user_status_change":r,"event:voted":a,"event:bookmarked":m,"event:topic_deleted":E.setDeleteState,"event:topic_restored":E.setDeleteState,"event:topic_purged":k,"event:topic_locked":E.setLockedState,"event:topic_unlocked":E.setLockedState,"event:topic_pinned":E.setPinnedState,"event:topic_unpinned":E.setPinnedState,"event:topic_moved":w,"event:post_edited":P,"event:post_purged":A,"event:post_deleted":C,"event:post_restored":C,"posts.bookmark":N,"posts.unbookmark":N,"posts.upvote":U,"posts.downvote":U,"posts.unvote":U,"event:new_notification":H,"event:new_post":s.onNewPost};t.init=function(){t.removeListeners();for(const e in n)n.hasOwnProperty(e)&&socket.on(e,n[e])},t.removeListeners=function(){for(const e in n)n.hasOwnProperty(e)&&socket.removeListener(e,n[e])};function r(e){app.updateUserStatus($('[data-uid="'+e.uid+'"] [component="user/status"]'),e.status)}function a(e){const h=$('[data-pid="'+e.post.pid+'"] [component="post/vote-count"]').filter(function(L,K){return parseInt($(K).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),j=$('.reputation[data-uid="'+e.post.uid+'"]');h.html(e.post.votes).attr("data-votes",e.post.votes),j.html(e.user.reputation).attr("data-reputation",e.user.reputation)}function m(e){$('[data-pid="'+e.post.pid+'"] .bookmarkCount').filter(function(h,j){return parseInt($(j).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).html(e.post.bookmarks).attr("data-bookmarks",e.post.bookmarks)}function k(e){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function w(e){e&&e.slug&&parseInt(e.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+e.slug,null,!0)}function P(e){if(!e||!e.post||parseInt(e.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const h=v.get("post/content",e.post.pid).filter(function(B,c){return parseInt($(c).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),j=$(`[data-pid="${e.post.pid}"]`),L=j.find('[component="post/editor"]').filter(function(B,c){return parseInt($(c).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}),K=v.get("topic/title"),Y=v.get("navbar/title").find("span"),Q=v.get("breadcrumb/current");if(e.topic.rescheduled)return ajaxify.go("topic/"+e.topic.slug,null,!0);if(K.length&&e.topic.title&&e.topic.renamed){ajaxify.data.title=e.topic.title;const B="topic/"+e.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:B},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+B),K.fadeOut(250,function(){K.html(e.topic.title).fadeIn(250)}),Q.fadeOut(250,function(){Q.html(e.topic.title).fadeIn(250)}),Y.fadeOut(250,function(){Y.html(e.topic.title).fadeIn(250)})}e.post.changed?h.fadeOut(250,function(){if(h.html(i.unescape(e.post.content)),h.find("img:not(.not-responsive)").addClass("img-fluid"),y.wrapImagesInLinks(h.parent()),s.addBlockquoteEllipses(h.parent()),h.fadeIn(250),e.post.edited){const B={editor:e.editor,editedISO:utils.toISOString(e.post.edited)};app.parseAndTranslate("partials/topic/post-editor",B,function(c){L.replaceWith(c),j.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${d.isoTimeToLocaleString(B.editedISO,config.userLang)}]]`),j.find('[component="post/editor"] .timeago').timeago(),l.fire("action:posts.edited",e)})}}):l.fire("action:posts.edited",e),e.topic.tags&&e.topic.tagsupdated&&o.e(63).then(function(){var B=[o(63)];(function(c){c.updateTopicTags([e.topic])}).apply(null,B)}).catch(o.oe),g.removeMenu(v.get("post","pid",e.post.pid))}function A(e){!e||parseInt(e.tid,10)!==parseInt(ajaxify.data.tid,10)||(v.get("post","pid",e.pid).fadeOut(500,function(){$(this).remove(),s.showBottomPostBar()}),ajaxify.data.postcount-=1,g.updatePostCount(ajaxify.data.postcount),o.e(18631).then(function(){var h=[o(18631)];(function(j){j.onPostPurged(e)}).apply(null,h)}).catch(o.oe))}function C(e){const h=v.get("post","pid",e.pid);if(!h.length)return;h.toggleClass("deleted");const j=h.hasClass("deleted");g.toggle(e.pid,j),!ajaxify.data.privileges.isAdminOrMod&&parseInt(e.uid,10)!==parseInt(app.user.uid,10)&&(h.find('[component="post/tools"]').toggleClass("hidden",j),j?h.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):h.find('[component="post/content"]').html(i.unescape(e.content)))}function N(e){const h=$('[data-pid="'+e.post.pid+'"] [component="post/bookmark"]').filter(function(j,L){return parseInt($(L).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)});h.length&&(h.attr("data-bookmarked",e.isBookmarked),h.find('[component="post/bookmark/on"]').toggleClass("hidden",!e.isBookmarked),h.find('[component="post/bookmark/off"]').toggleClass("hidden",e.isBookmarked))}function U(e){const h=$('[data-pid="'+e.post.pid+'"]');h.find('[component="post/upvote"]').filter(function(j,L){return parseInt($(L).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).toggleClass("upvoted",e.upvote),h.find('[component="post/downvote"]').filter(function(j,L){return parseInt($(L).closest("[data-pid]").attr("data-pid"),10)===parseInt(e.post.pid,10)}).toggleClass("downvoted",e.downvote)}function H(e){const h=ajaxify.data.tid;e&&e.tid&&parseInt(e.tid,10)===parseInt(h,10)&&socket.emit("topics.markTopicNotificationsRead",[h])}return t}.apply(R,I),b!==void 0&&(x.exports=b)},74566:(x,R,o)=>{x.exports=o(12236)},449:(x,R,o)=>{x.exports=o(91943)},89596:(x,R,o)=>{x.exports=o(62590)},99594:(x,R,o)=>{x.exports=o(57904)},95692:(x,R,o)=>{"use strict";var I,b;I=[o(52473),o(71431),o(88518),o(49897),o(29930),o(43103),o(6411),o(68636),o(91749)],b=function(g,E,s,y,v,i,l,d,t){const n={};n.init=function(){const a=g.get("topic/quickreply/text"),m=`qr:draft:tid:${ajaxify.data.tid}`,k={element:a,strategies:[],options:{style:{"z-index":100}}};r(),$(window).one("action:ajaxify.start",()=>{r()}),$(window).trigger("composer:autocomplete:init",k),s._active.core_qr=s.setup(k),l.bind("ctrl+return",A=>{A.target===a.get(0)&&g.get("topic/quickreply/button").get(0).click()}),i.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:a,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:a,route:"/api/post/upload",callback:function(A){let C=a.val();A.forEach(N=>{C=C+(C?`
`:"")+(N.isImage?"!":"")+`[${N.filename}](${N.url})`}),a.val(C)}});let w=!0;g.get("topic/quickreply/button").on("click",function(A){if(A.preventDefault(),!w)return;const C=g.get("topic/quickreply/text").val(),N={tid:ajaxify.data.tid,handle:void 0,content:C},U=C.length;if(U<parseInt(config.minimumPostLength,10))return v.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(U>parseInt(config.maximumPostLength,10))return v.error("[[error:content-too-long, "+config.maximumPostLength+"]]");w=!1,y.post(`/topics/${ajaxify.data.tid}`,N,function(H,e){if(w=!0,H)return v.error(H);e&&e.queued&&v.alert({type:"success",title:"[[global:alert.success]]",message:e.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${e.id}`)}}),g.get("topic/quickreply/text").val(""),d.removeItem(m),s._active.core_qr.hide(),t.fire("action:quickreply.success",{data:e})})});const P=d.getItem(m);P&&a.val(P),a.on("keyup",utils.debounce(function(){const A=a.val();A?d.setItem(m,A):d.removeItem(m)},1e3)),g.get("topic/quickreply/expand").on("click",A=>{A.preventDefault(),d.removeItem(m);const C=g.get("topic/quickreply/text");E.newReply({tid:ajaxify.data.tid,title:ajaxify.data.title,body:C.val()}),C.val("")})};function r(){s._active.core_qr&&(s._active.core_qr.destroy(),s._active.core_qr=null)}return n}.apply(R,I),b!==void 0&&(x.exports=b)},43349:(x,R,o)=>{"use strict";var I,b;I=[o(52473)],b=function(g){const E={};return E.handleSort=function(s,y){const v=g.get("thread/sort");v.find("i").removeClass("fa-check");const i=utils.params().sort||config[s];v.find('a[data-sort="'+i+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a[data-sort]').on("click",'[component="thread/sort"] a[data-sort]',function(){const d=$(this).attr("data-sort"),t=utils.params();t.sort=d;const n=decodeURIComponent($.param(t));ajaxify.go(y+(n?"?"+n:""))})},E}.apply(R,I),b!==void 0&&(x.exports=b)},14063:(x,R,o)=>{"use strict";x=o.nmd(x);var I,b;I=[o(17459),o(91749)],b=function(g,E){const s={};let y=!1;s.init=function(){if(s.taskbar=$('[component="taskbar"]'),s.tasklist=s.taskbar.find("ul"),!s.taskbar.length||!s.tasklist.length){y=!0;return}s.taskbar.on("click","li",async function(){const t=$(this),n=t.attr("data-module"),r=t.attr("data-uuid"),a=await app.require(n);return t.hasClass("active")?a.minimize(r):(i(),a.load(r),s.toggleNew(r,!1),s.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){s.closeAll()})},s.close=async function(t,n){if(y)return;if(s.tasklist.find('[data-module="'+x+'"][data-uuid="'+n+'"]').length){const a=await app.require(t);a&&typeof a.close=="function"&&a.close(n)}},s.closeAll=function(t){if(y)return;let n="[data-uuid]";t&&(n='[data-module="'+t+'"]'+n),s.tasklist.find(n).each(function(r,a){s.close(t||a.getAttribute("data-module"),a.getAttribute("data-uuid"))})},s.discard=function(t,n){if(y)return;s.tasklist.find('[data-module="'+t+'"][data-uuid="'+n+'"]').remove(),v()},s.push=function(t,n,r,a){if(a=a||function(){},y)return a();const m=s.tasklist.find('li[data-uuid="'+n+'"]'),k={module:t,uuid:n,options:r,element:m};E.fire("filter:taskbar.push",k),!m.length&&k.module?l(k,a):a(m)},s.get=function(t){return y?[]:$('[data-module="'+t+'"]').map(function(r,a){return $(a).data()})},s.minimize=function(t,n){if(y)return;s.tasklist.find('[data-module="'+t+'"][data-uuid="'+n+'"]').toggleClass("active",!1)},s.toggleNew=function(t,n,r){if(y)return;s.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",n),r||E.fire("action:taskbar.toggleNew",t)},s.updateActive=function(t){if(y)return;const n=s.tasklist.find("li");n.removeClass("active"),n.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},s.isActive=function(t){return y?!1:s.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function v(){if(y)return;s.tasklist.find("li").length>0?s.taskbar.attr("data-active","1"):s.taskbar.removeAttr("data-active")}function i(){y||s.tasklist.find(".active").removeClass("active")}function l(t,n){if(y)return n();g.translate(t.options.title,function(r){const a=$("<div></div>").text(r||"NodeBB Task").html(),m=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+a+'" component="taskbar/title">'+a+"</span></a>").attr({title:a,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&i(),s.tasklist.append(m),v(),t.element=m,m.data(t),E.fire("action:taskbar.pushed",t),n(m)})}const d=function(t,n,r){switch(n){case"title":t.find('[component="taskbar/title"]').text(r);break;case"icon":t.find("i").attr("class","fa fa-"+r);break;case"image":t.find("a").css("background-image",r?'url("'+r.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",r);break;case"color":t.find("a").css("color",r);break}};return s.update=function(t,n,r){if(y)return;const a=s.tasklist.find('[data-module="'+t+'"][data-uuid="'+n+'"]');if(!a.length)return;const m=a.data();Object.keys(r).forEach(function(k){m[k]=r[k],d(a,k,r[k])}),a.data(m)},s}.apply(R,I),b!==void 0&&(x.exports=b)},36159:(x,R,o)=>{"use strict";var I,b;I=[o(49897),o(40027),o(29930),o(24187),o(81335),o(17459),o(65285)],b=function(g,E,s,y,v,i){const l={};return l.get=d=>g.get(`/topics/${d}/thumbs`,{}),l.getByPid=d=>g.get(`/posts/${d}`,{}).then(t=>l.get(t.tid)),l.delete=(d,t)=>g.del(`/topics/${d}/thumbs`,{path:t}),l.deleteAll=d=>{l.get(d).then(t=>{Promise.all(t.map(n=>l.delete(d,n.url)))})},l.upload=d=>new Promise(t=>{y.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${d}/thumbs`},function(n){t(n)})}),l.modal={},l.modal.open=function(d){const{id:t,pid:n}=d;let{modal:r}=d,a;return new Promise(m=>{Promise.all([l.get(t),n?l.getByPid(n):[]]).then(k=>new Promise(w=>{const P=k.reduce((A,C)=>A.concat(C));a=P.length,w(P)})).then(k=>v.render("modals/topic-thumbs",{thumbs:k})).then(k=>{r?i.translate(k,function(w){r.find(".bootbox-body").html(w),l.modal.handleSort({modal:r,numThumbs:a})}):(r=E.dialog({title:"[[modules:thumbs.modal.title]]",message:k,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(l.upload(t).then(()=>{l.modal.open({...d,modal:r}),Promise.all([o.e(54516),o.e(99166),o.e(47061),o.e(49775)]).then(function(){var w=[o(71431)];(P=>{P.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),m()}).apply(null,w)}).catch(o.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),l.modal.handleDelete({...d,modal:r}),l.modal.handleSort({modal:r,numThumbs:a}))})})},l.modal.handleDelete=d=>{d.modal.get(0).addEventListener("click",n=>{n.target.closest('button[data-action="remove"]')&&E.confirm("[[modules:thumbs.modal.confirm-remove]]",r=>{if(!r)return;const a=n.target.closest("[data-id]").getAttribute("data-id"),m=n.target.closest("[data-path]").getAttribute("data-path");g.del(`/topics/${a}/thumbs`,{path:m}).then(()=>{l.modal.open(d)}).catch(s.error)})})},l.modal.handleSort=({modal:d,numThumbs:t})=>{if(t>1){const n=d.find(".topic-thumbs-modal");n.sortable({items:"[data-id]"}),n.on("sortupdate",l.modal.handleSortChange)}},l.modal.handleSortChange=(d,t)=>{const n=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(n).forEach((r,a)=>{const m=r.getAttribute("data-id");let k=r.getAttribute("data-path");k=k.replace(new RegExp(`^${config.upload_url}`),""),g.put(`/topics/${m}/thumbs/order`,{path:k,order:a}).catch(s.error)})},l}.apply(R,I),b!==void 0&&(x.exports=b)},24187:(x,R,o)=>{"use strict";var I,b;I=[o(64061)],b=function(){const g={};g.show=function(i,l){const d=i.hasOwnProperty("fileSize")&&i.fileSize!==void 0?parseInt(i.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:i.hasOwnProperty("showHelp")&&i.showHelp!==void 0?i.showHelp:!0,fileSize:d,title:i.title||"[[global:upload-file]]",description:i.description||"",button:i.button||"[[global:upload]]",accept:i.accept?i.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const n=t.find("#uploadForm");n.attr("action",i.route),n.find("#params").val(JSON.stringify(i.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),n.submit()}),n.submit(function(){return E(t,d,l),!1})})},g.hideAlerts=function(i){$(i).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function E(i,l,d){s(i,"status","[[uploads:uploading-file]]"),i.find("#upload-progress-bar").css("width","0%"),i.find("#upload-progress-box").show().removeClass("hide");const t=i.find("#fileInput");if(!t.val())return s(i,"error","[[uploads:select-file-to-upload]]");if(!v(t[0],l))return s(i,"error","[[error:file-too-big, "+l+"]]");g.ajaxSubmit(i,d)}function s(i,l,d){g.hideAlerts(i),l==="error"&&i.find("#fileUploadSubmitBtn").removeClass("disabled"),d=d.replace(/&amp;#44/g,"&#44"),i.find("#alert-"+l).translateText(d).removeClass("hide")}g.ajaxSubmit=function(i,l){i.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=y(t),s(i,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,n,r,a){i.find("#upload-progress-bar").css("width",a+"%")},success:function(t){let n=y(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(n=t.response.images),l(n[0].url),s(i,"success","[[uploads:upload-success]]"),setTimeout(function(){g.hideAlerts(i),i.modal("hide")},750)}})};function y(i){if(typeof i=="string")try{return JSON.parse(i)}catch{return{error:"[[error:parse-error]]"}}return i}function v(i,l){return window.FileReader&&l?i.files[0].size<=l*1e3:!0}return g}.apply(R,I),b!==void 0&&(x.exports=b)}}]);
