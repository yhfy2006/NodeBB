"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18593,99127,34271,1091,92717,87212,49897,2403],{2403:(w,C,h)=>{var v,p;v=[h(69749),h(29930),h(49897)],p=function(g,m,s){const f={};let o,l,x={};f.init=function(t){t=t||function(){},!o&&app.parseAndTranslate("modals/merge-topic",{},function(i){o=i,$("body").append(o),l=o.find("#merge_topics_confirm"),o.find("#merge_topics_cancel").on("click",e),$("#content").on("click",'[component="topic/select"]',k),a(),l.on("click",function(){n(l)}),g.enableQuickSearch({searchElements:{inputEl:o.find(".topic-search-input"),resultEl:o.find(".quick-search-container")},searchOptions:{in:"titles"}}),o.on("click","[data-tid]",function(){return $(this).attr("data-tid")&&f.addTopic($(this).attr("data-tid")),!1}),t()})},f.addTopic=function(t,i){i=i||function(){},s.get(`/topics/${t}`,{}).then(function(c){const u=c?c.title:"No title";x[t]?delete x[t]:x[t]=u,r(),a(),i()}).catch(m.error)};function k(t){if(!o)return;const i=$(this).parents('[component="category/topic"]').attr("data-tid");return f.addTopic(i),t.preventDefault(),t.stopPropagation(),!1}function n(t){t.attr("disabled",!0);const i=Object.keys(x),c={};o.find(".merge-main-topic-radio").is(":checked")?c.mainTid=o.find(".merge-main-topic-select").val():o.find(".merge-new-title-radio").is(":checked")&&(c.newTopicTitle=o.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:i,options:c},function(u,y){if(t.removeAttr("disabled"),u)return m.error(u);ajaxify.go("/topic/"+y),e()})}function a(){if(!o)return;const t=Object.keys(x);t.sort(function(c,u){return c-u});const i=t.map(function(c){return{tid:c,title:x[c]}});t.length?app.parseAndTranslate("modals/merge-topic",{config,topics:i},function(c){o.find(".topics-section").html(c.find(".topics-section").html()),o.find(".merge-main-topic-select").html(c.find(".merge-main-topic-select").html())}):o.find(".topics-section").translateHtml("[[error:no-topics-selected]]")}function r(){Object.keys(x).length?l.removeAttr("disabled"):l.attr("disabled",!0)}function e(){o&&(o.remove(),o=null),x={},$("#content").off("click",'[component="topic/select"]',k)}return f}.apply(C,v),p!==void 0&&(w.exports=p)},49897:(w,C,h)=>{h.r(C),h.d(C,{del:()=>r,get:()=>l,head:()=>x,patch:()=>n,post:()=>k,put:()=>a});var v=h(91749),p=h.n(v),g=h(40027),m=h.n(g);const s=config.relative_path+"/api/v3";async function f(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:s+e.url,typeof t=="function"){o(e).then(i=>t(null,i),i=>t(i));return}try{return await o(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again.")return(0,g.confirm)("[[error:api.reauth-required]]",c=>{c&&ajaxify.go("login")});throw i}}async function o(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,v.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(t,e),{headers:c}=i,u=c.get("content-type"),y=u&&u.startsWith("application/json");let d;if(e.method!=="head"&&(y?d=await i.json():d=await i.text()),!i.ok)throw d?new Error(y?d.status.message:d):new Error(i.statusText);return y&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function l(e,t,i){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},i)}function x(e,t,i){return f({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},i)}function k(e,t,i){return f({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function n(e,t,i){return f({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function a(e,t,i){return f({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function r(e,t,i){return f({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}},69749:(w,C,h)=>{var v,p;v=[h(17459),h(68636),h(91749),h(29930),h(89336)],p=function(g,m,s,f,o){const l={current:{}};l.init=function(n){if(!config.searchEnabled)return;n=n||{in:config.searchDefaultInQuick||"titles"},$('[component="search/form"]').each((r,e)=>{x($(e),n)})};function x(n,a){const r=n.find('[component="search/button"]'),e=n.find('[component="search/fields"]'),t=e.find('input[name="query"]'),i=e.find("#quick-search-container");e.hasClass("hidden")&&t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(e.addClass("hidden"),r.removeClass("hidden"))},200)}),t.off("focus");const u={inputEl:t,resultEl:i};l.enableQuickSearch({searchOptions:a,searchElements:u}),r.off("click").on("click",function(y){return!config.loggedIn&&!app.user.privileges["search:content"]?(f.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(y.stopPropagation(),l.showAndFocusInput(n),!1)}),n.off("submit").on("submit",function(){const y=$(this).find('input[name="query"]'),d=l.getSearchPreferences();return d.term=y.val(),d.in=a.in,s.fire("action:search.submit",{searchOptions:d,searchElements:u}),l.query(d,function(){y.val(""),t.trigger("blur")}),!1})}l.enableQuickSearch=function(n){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const a=Object.assign({in:config.searchDefaultInQuick||"titles"},n.searchOptions),r=n.searchElements.resultEl,e=n.searchElements.inputEl;let t=e.val();const i=r.find(".filter-category");function c(){ajaxify.data.template.category&&ajaxify.data.cid&&g.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(E){const O=$("<div></div>").html(E).text();i.find(".name").text(O)}),i.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function u(){n.searchOptions=Object.assign({},a),n.searchOptions.term=e.val(),c(),ajaxify.data.template.category&&ajaxify.data.cid&&i.find('input[type="checkbox"]').is(":checked")&&(n.searchOptions.categories=[ajaxify.data.cid],n.searchOptions.searchChildren=!0),n.hideDuringSearch||(r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden")),s.fire("action:search.quick.start",n),n.searchOptions.searchOnly=1,l.api(n.searchOptions,function(E){if(r.find(".loading-indicator").addClass("hidden"),!E.posts||n.hideOnNoMatches&&!E.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");E.posts.forEach(function(O){const _=$("<div>"+O.content+"</div>").text(),b=e.val().toLowerCase().replace(/^in:topic-\d+/,""),S=Math.max(0,_.toLowerCase().indexOf(b)-40);O.snippet=utils.escapeHTML((S>0?"...":"")+_.slice(S,S+80)+(_.length-S>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",E,function(O){O.length&&O.find(".timeago").timeago(),r.toggleClass("hidden",!O.length||!e.is(":focus")).find(".quick-search-results-container").html(O.length?O:"");const _=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");l.highlightMatches(n.searchOptions.term,_),s.fire("action:search.quick.complete",{data:E,options:n})})})}r.find('.filter-category input[type="checkbox"]').on("change",function(){e.focus(),u()}),e.off("keyup").on("keyup",utils.debounce(function(){if(e.val().length<3){r.addClass("hidden"),t=e.val();return}if(e.val()!==t){if(t=e.val(),!e.is(":focus"))return r.addClass("hidden");u()}},500));let y=!1;r.on("mousedown",".quick-search-results > *",function(){$(window).one("mouseup",function(){r.addClass("hidden")}),y=!0}),e.on("blur",function(){setTimeout(function(){!e.is(":focus")&&!y&&!r.hasClass("hidden")&&r.addClass("hidden")},200)});let d=!1;s.on("action:ajaxify.end",function(){ajaxify.isCold()||(d=!0)}),e.on("focus",function(){y=!1;const E=e.val();t=E,E&&r.find("#quick-search-results").children().length&&(c(),d?(u(),d=!1):r.removeClass("hidden"),e[0].setSelectionRange(E.startsWith("in:topic")?E.indexOf(" ")+1:0,E.length))}),e.off("refresh").on("refresh",function(){u()})},l.showAndFocusInput=function(n){const a=n.parents(".dropdown-menu");if(a.length){const r=a.siblings("[data-bs-toggle]"),e=o.Dropdown.getOrCreateInstance(r[0]);e&&e.show()}else n.find('[component="search/fields"]').removeClass("hidden"),n.find('[component="search/button"]').addClass("hidden"),n.find('[component="search/fields"] input[name="query"]').trigger("focus")},l.query=function(n,a){a=a||function(){},ajaxify.go("search?"+k(n),a)},l.api=function(n,a){const r=config.relative_path+"/api/search?"+k(n);n.hasOwnProperty("searchOnly")&&delete n.searchOnly;const e=config.relative_path+"/search?"+k(n);$.get(r,function(t){t.url=e,a(t)})};function k(n){const a=n.in||"titles";let r=n.term.replace(/^[ ?#]*/,"");try{r=encodeURIComponent(r)}catch{return f.error("[[error:invalid-search-term]]")}const e={...n,term:r,in:a};return s.fire("action:search.createQueryString",{query:e,data:n}),decodeURIComponent($.param(e))}return l.getSearchPreferences=function(){try{return JSON.parse(m.getItem("search-preferences")||"{}")}catch{return{}}},l.highlightMatches=function(n,a){if(!n||!a.length)return;n=utils.escapeHTML(n.replace(/^"/,"").replace(/"$/,"").trim());const r=n.split(" ").filter(t=>t.length>1).map(function(t){return utils.escapeRegexChars(t)}).join("|"),e=new RegExp("("+r+")","gi");a.each(function(){const t=$(this),i=[];t.find("*").each(function(){$(this).after("<!-- "+i.length+" -->"),i.push($("<div></div>").append($(this)))}),t.html(t.html().replace(e,function(c,u){return'<strong class="search-match fw-bold text-decoration-underline">'+u+"</strong>"})),i.forEach(function(c,u){t.html(t.html().replace("<!-- "+u+" -->",function(){return c.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-fluid")},l}.apply(C,v),p!==void 0&&(w.exports=p)},68636:(w,C,h)=>{var v;v=function(){function p(){this._store={},this._keys=[]}p.prototype.isMock=!0,p.prototype.setItem=function(s,f){s=String(s),this._keys.indexOf(s)===-1&&this._keys.push(s),this._store[s]=f},p.prototype.getItem=function(s){return s=String(s),this._keys.indexOf(s)===-1?null:this._store[s]},p.prototype.removeItem=function(s){s=String(s),this._keys=this._keys.filter(function(f){return f!==s}),this._store[s]=null},p.prototype.clear=function(){this._keys=[],this._store={}},p.prototype.key=function(s){return s=parseInt(s,10)||0,this._keys[s]},Object.defineProperty&&Object.defineProperty(p.prototype,"length",{get:function(){return this._keys.length}});let g;const m=Date.now().toString();try{if(g=window.localStorage,g.setItem(m,m),g.getItem(m)!==m)throw Error("localStorage behaved unexpectedly");return g.removeItem(m),g}catch(s){console.warn(s),console.warn("localStorage failed, falling back on sessionStorage");try{if(g=window.sessionStorage,g.setItem(m,m),g.getItem(m)!==m)throw Error("sessionStorage behaved unexpectedly");return g.removeItem(m),g}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new p}}}.call(C,h,C,w),v!==void 0&&(w.exports=v)}}]);
