(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[90408,97082,16852,26174],{62734:(D,E,d)=>{"use strict";var y,m;y=[d(89664),d(67308),d(52473),d(36684),d(72254),d(49897),d(13230),d(65348),d(40027),d(29930),d(30076)],m=function(h,t,u,o,r,e,c,s,i,a,g){const n={};let l;n.init=function(){const b=u.get("groups/container");l=ajaxify.data.group.name,ajaxify.data.group.isOwner&&(n.prepareSettings(),o.init(u.get("groups/cover"),function(C,f,w){socket.emit("groups.cover.update",{groupName:l,imageData:C,position:f},w)},function(){r.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"groupName",paramValue:l},function(C){C=(C.startsWith("http")?"":config.relative_path)+C+"?"+Date.now(),u.get("groups/cover").css("background-image","url("+C+")")})},F)),h.init(),I(),u.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-fluid"),b.on("click","[data-action]",function(){const C=$(this),f=C.parents("[data-uid]"),w=f.find('[component="groups/owner/icon"]'),v=!!parseInt(f.attr("data-isowner"),10),A=f.attr("data-uid"),P=C.attr("data-action");switch(P){case"toggleOwnership":e[v?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${A}`,{}).then(()=>{w.toggleClass("invisible")}).catch(a.error);break;case"kick":i.confirm("[[groups:details.kick-confirm]]",function(k){k&&e.del(`/groups/${ajaxify.data.group.slug}/membership/${A}`,void 0).then(()=>{f.remove(),$('[component="group/member/count"]').text(g.humanReadableNumber(ajaxify.data.group.memberCount-1))}).catch(a.error)});break;case"update":n.update();break;case"delete":n.deleteGroup();break;case"join":e.put("/groups/"+ajaxify.data.group.slug+"/membership/"+(A||app.user.uid),void 0).then(()=>ajaxify.refresh()).catch(a.error);break;case"leave":e.del("/groups/"+ajaxify.data.group.slug+"/membership/"+(A||app.user.uid),void 0).then(()=>ajaxify.refresh()).catch(a.error);break;case"accept":e.put(`/groups/${ajaxify.data.group.slug}/pending/${A}`).then(()=>{f.remove(),h.refresh(),p()}).catch(a.error);break;case"reject":e.del(`/groups/${ajaxify.data.group.slug}/pending/${A}`).then(()=>{f.remove(),h.refresh(),p()}).catch(a.error);break;case"acceptInvite":e.put(`/groups/${ajaxify.data.group.slug}/invites/${app.user.uid}`).then(()=>{A?(f.remove(),h.refresh()):ajaxify.refresh()}).catch(a.error);break;case"rescindInvite":case"rejectInvite":e.del(`/groups/${ajaxify.data.group.slug}/invites/${A||app.user.uid}`).then(()=>{A?(f.remove(),x(),h.refresh()):ajaxify.refresh()}).catch(a.error);break;case"acceptAll":case"rejectAll":{const k=document.querySelector('[component="groups/pending"]');if(!k)return;const B=P==="acceptAll"?"put":"del";let R=Array.prototype.map.call(k.querySelectorAll("[data-uid]"),S=>parseInt(S.getAttribute("data-uid"),10));R=R.filter((S,j)=>R.indexOf(S)===j),Promise.all(R.map(async S=>e[B](`/groups/${ajaxify.data.group.slug}/pending/${S}`))).then(()=>{ajaxify.refresh()}).catch(a.error);break}}})},n.prepareSettings=function(){const b=u.get("groups/settings"),C=b.find('[name="labelColor"]'),f=b.find('[name="textColor"]'),w=b.find('[data-action="icon-select"]'),v=b.find(".badge"),A=b.find(".badge-text"),P=v.find("i"),k=b.find('[name="userTitle"]'),B=b.find('[name="userTitleEnabled"]'),R=b.find('[name="icon"]');C.on("input",function(){v.css("background-color",C.val())}),f.on("input",function(){v.css("color",f.val())}),w.on("click",function(){t.init(P,function(){R.val(P.val())})}),k.on("keyup",function(){A.translateText(k.val())}),B.on("change",function(){const j=u.get("groups/userTitleOption");this.checked?(j.removeAttr("disabled"),v.removeClass("hide")):(j.attr("disabled","disabled"),v.addClass("hide"))});const S=s.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(j){let T=($("#memberPostCids").val()||"").split(",").map(L=>parseInt(L,10));T.push(j.cid),T=T.filter((L,N,O)=>O.indexOf(L)===N),$("#memberPostCids").val(T.join(",")),S.selectCategory(0)}})},n.update=function(){const b=u.get("groups/settings"),C=b.find('input[type="checkbox"][name]');if(b.length){const f=b.serializeObject();Array.isArray(f.memberPostCids)||(f.memberPostCids=$("#memberPostCids").val()),C.each(function(w,v){v=$(v),v.length&&(f[v.attr("name")]=v.prop("checked"))}),e.put(`/groups/${ajaxify.data.group.slug}`,f).then(()=>{if(f.name!==ajaxify.data.group.name){let w=window.location.pathname;w=w.slice(1,w.lastIndexOf("/")+1),ajaxify.go(w+c(f.name))}a.success("[[groups:event.updated]]")}).catch(a.error)}},n.deleteGroup=function(){i.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(l),function(b){b&&i.prompt("Please enter the name of this group in order to delete it:",function(C){C===l&&e.del(`/groups/${ajaxify.data.group.slug}`,{}).then(()=>{a.success("[[groups:event.deleted, "+utils.escapeHTML(l)+"]]"),ajaxify.go("groups")}).catch(a.error)})})};function p(){$('[component="groups/pending/alert"]').toggleClass("hidden",$('[component="groups/pending"] tbody tr').length>0)}function x(){$('[component="groups/invited/alert"]').toggleClass("hidden",$('[component="groups/invited"] tbody tr').length>0)}function I(){if(!ajaxify.data.group.isOwner)return;async function b(){const f=await e.get(`/api/groups/${ajaxify.data.group.slug}`),w=await app.parseAndTranslate("groups/details","group.invited",{group:f.group});$('[component="groups/invited"] tbody').html(w),x(),h.refresh()}const C=$('[component="groups/members/invite"]');d.e(34405).then(function(){var f=[d(34405)];(function(w){w.user(C,function(v,A){e.post(`/groups/${ajaxify.data.group.slug}/invites/${A.item.user.uid}`).then(()=>b()).catch(a.error)})}).apply(null,f)}).catch(d.oe),$('[component="groups/members/bulk-invite-button"]').on("click",async()=>{let f=$('[component="groups/members/bulk-invite"]').val();if(!f)return!1;f=f.split(",").map(v=>c(v)),f=await Promise.all(f.map(v=>e.head(`/users/bySlug/${v}`).then(()=>v).catch(()=>!1))),f=f.filter(Boolean);const w=await Promise.all(f.map(v=>e.get(`/users/bySlug/${v}`).then(({uid:A})=>A)));await Promise.all(w.map(async v=>e.post(`/groups/${ajaxify.data.group.slug}/invites/${v}`))).then(()=>{b()}).catch(a.error)})}function F(){i.confirm("[[groups:remove-group-cover-confirm]]",function(b){b&&socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(C){C?a.error(C):ajaxify.refresh()})})}return n}.apply(E,y),m!==void 0&&(D.exports=m)},96349:(D,E,d)=>{"use strict";var y,m;y=[d(29930),d(89336),d(49897)],m=function(h,t,u){const o={};return o.init=function(r,e){let c=null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let s=[];Array.isArray(e.localCategories)&&(s=e.localCategories.map(l=>({...l}))),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const i=r.find('[component="category-selector-search"]');if(!i.length)return;const a=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;r.on("show.bs.dropdown",function(){a&&(r.find(".dropdown-toggle").css({visibility:"hidden"}),i.removeClass("hidden"),i.css({"z-index":r.find(".dropdown-toggle").css("z-index")+1}));function l(){const p=i.find("input").val();p.length>1||!p&&!c?g(p,function(x){c=e.cacheList&&(c||x),n(x)}):!p&&c&&n(c)}i.on("click",function(p){p.preventDefault(),p.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(l,300)),l()}),r.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),r.on("hide.bs.dropdown",function(){a&&(r.find(".dropdown-toggle").css({visibility:"inherit"}),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")});function g(l,p){u.get("/search/categories",{search:l,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(x,{categories:I}){if(x)return h.error(x);p(s.concat(I))})}function n(l){const p=e.selectedCids.map(String);l.forEach(function(x){x.selected=p.includes(String(x.cid))}),app.parseAndTranslate(e.template,{categoryItems:l.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(x){r.find('[component="category/list"]').html(x.find('[component="category/list"]').html()),r.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!l.length);const I=t.Dropdown.getInstance(r.find(".dropdown-toggle").get(0));I&&I.update()})}},o}.apply(E,y),m!==void 0&&(D.exports=m)},65348:(D,E,d)=>{"use strict";var y,m;y=[d(96349),d(40027),d(91749),d(17459)],m=function(h,t,u,o){const r={};return r.init=function(e,c){if(!e||!e.length)return;c=c||{};const s=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",u.fire("action:category.selector.options",{el:e,options:c}),h.init(e,c);const i={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const g=$(this);return g.hasClass("disabled")?!1:(i.selectCategory(g.attr("data-cid")),s(i.selectedCategory))});let a=i.el.find('[component="category-selector-selected"]').html();return o.translate(a,g=>{a=g}),i.selectCategory=function(g){const n=i.el.find('[data-cid="'+g+'"]');i.selectedCategory={cid:g,name:n.attr("data-name")},n.length?i.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(a)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(g){i.el.find('[component="category-selector-selected"]').html(g.find('[component="category-selector-selected"]').html())}),i},r.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(c){const s=t.dialog({title:e.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:a}}}),i=r.init(s.find('[component="category-selector"]'),e);function a(g){return g.preventDefault(),i.selectedCategory&&(e.onSubmit(i.selectedCategory),s.modal("hide")),!1}e.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",a)})},r}.apply(E,y),m!==void 0&&(D.exports=m)},36684:(D,E,d)=>{"use strict";var y,m;y=[d(29930),d(18675)],m=function(h){const t={coverEl:null,saveFn:null};t.init=function(o,r,e,c){t.coverEl=o,t.saveFn=r,o.find(".upload").on("click",e),o.find(".resize").on("click",function(){u(o)}),o.find(".remove").on("click",c),o.on("dragover",t.onDragOver).on("drop",t.onDrop),o.find(".save").on("click",t.save),o.addClass("initialised")},t.onDragOver=function(o){o.stopPropagation(),o.preventDefault(),o.originalEvent.dataTransfer.dropEffect="copy"},t.onDrop=function(o){o.stopPropagation(),o.preventDefault();const r=o.originalEvent.dataTransfer.files,e=new FileReader;r.length&&r[0].type.match("image.*")&&(e.onload=function(c){t.coverEl.css("background-image","url("+c.target.result+")"),t.newCover=c.target.result},e.readAsDataURL(r[0]),u(t.coverEl))};function u(o){o.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),h.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return t.save=function(){t.coverEl.addClass("saving"),t.saveFn(t.newCover||void 0,t.coverEl.css("background-position"),function(o){o?h.error(o):(t.coverEl.toggleClass("active",0),t.coverEl.backgroundDraggable("disable"),t.coverEl.off("dragover",t.onDragOver),t.coverEl.off("drop",t.onDrop),h.success("[[modules:cover.saved]]")),t.coverEl.removeClass("saving")})},t}.apply(E,y),m!==void 0&&(D.exports=m)},72254:(D,E,d)=>{"use strict";var y,m;y=[d(29930)],m=function(h){const t={};t.show=function(e,c){const s=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:s,title:e.title||"[[global:upload-file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(i){i.modal("show"),i.on("hidden.bs.modal",function(){i.remove()});const a=i.find("#uploadForm");e.route&&a.attr("action",e.route),i.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),e.uploadModal=i,r(e,c),!1})})},t.handleImageCrop=function(e,c){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(e.url)},async function(s){s.modal({backdrop:"static"}).modal("show");const i=parseInt($(window).height()/2,10),a=document.getElementById("cropped-image");$(a).css("max-height",i);const g=(await d.e(60239).then(d.t.bind(d,65643,23))).default;let n=new g(a,{aspectRatio:e.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){e.restrictImageDimension&&(n.cropBoxData.width>e.imageDimension&&n.setCropBoxData({width:e.imageDimension}),n.cropBoxData.height>e.imageDimension&&n.setCropBoxData({height:e.imageDimension}))},ready:function(){if(!o(n,e))return s.modal("hide");if(e.restrictImageDimension){const l=a.width<a.height?a.width:a.height,p=l>e.imageDimension?e.imageDimension:l;n.setCropBoxData({width:p,height:p})}s.find(".rotate").on("click",function(){const l=this.getAttribute("data-degrees");n.rotate(l)}),s.find(".flip").on("click",function(){const l=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?n.scaleX(l):n.scaleY(l),this.setAttribute("data-option",l*-1)}),s.find(".reset").on("click",function(){n.reset()}),s.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const l=o(n,e);l&&(s.find("#upload-progress-bar").css("width","0%"),s.find("#upload-progress-box").show().removeClass("hide"),u({data:e,imageData:l,progressBarEl:s.find("#upload-progress-bar")},function(p,x){if(p)return s.find("#upload-progress-box").hide(),s.find(".upload-btn").removeClass("disabled"),s.find(".crop-btn").removeClass("disabled"),h.error(p);c(x.url),s.modal("hide")}))}),s.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),n.destroy();const l=(await d.e(60239).then(d.t.bind(d,65643,23))).default;n=new l(a,{viewMode:1,autoCropArea:1,ready:function(){s.find(".crop-btn").trigger("click")}})})}})})};function u(e,c){const s={};s[e.data.paramName]=e.data.paramValue,s.method=e.data.socketMethod,s.size=e.imageData.length,s.progress=0;const i=1e5;function a(){const g=e.imageData.slice(s.progress,s.progress+i);socket.emit("uploads.upload",{chunk:g,params:s},function(n,l){if(n)return h.error(n);if(s.progress+i<s.size)return s.progress+=g.length,e.progressBarEl.css("width",(s.progress/s.size*100).toFixed(2)+"%"),setTimeout(a,100);e.progressBarEl.css("width","100%"),c(null,l)})}a()}function o(e,c){let s;try{s=c.imageType?e.getCroppedCanvas().toDataURL(c.imageType):e.getCroppedCanvas().toDataURL()}catch(i){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(i.message)!==-1?h.error("[[error:cors-error]]"):h.error(i.message);return}return s}function r(e,c){function s(l,p){l==="error"&&e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),e.uploadModal.find("#alert-"+l).translateText(p).removeClass("hide")}const i=e.uploadModal.find("#fileInput");if(!i.val())return s("error","[[uploads:select-file-to-upload]]");const a=i[0].files[0],g=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;if(g&&a.size>g*1024)return s("error","[[error:file-too-big, "+g+"]]");if(a.name.endsWith(".gif")){d.e(98463).then(function(){var l=[d(24187)];(function(p){p.ajaxSubmit(e.uploadModal,c)}).apply(null,l)}).catch(d.oe);return}const n=new FileReader;n.addEventListener("load",function(){const l=n.result;e.uploadModal.modal("hide"),t.handleImageCrop({url:l,imageType:a.type,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},c)},!1),a&&n.readAsDataURL(a)}return t}.apply(E,y),m!==void 0&&(D.exports=m)},13230:(D,E,d)=>{"use strict";var y,m,h;(function(t){m=[d(53050)],y=t,h=typeof y=="function"?y.apply(E,m):y,h!==void 0&&(D.exports=h)})(function(t){const u=t("[^\\p{L}\\s\\d\\-_]","g"),o=/[^\w\s\d\-_]/g,r=/^\s+|\s+$/g,e=/\s+/g,c=/-+/g,s=/-$/g,i=/^-/g,a=/^[\w\d\s.,\-@]+$/;return function(n,l){return n?(n=String(n).replace(r,""),a.test(n)?n=n.replace(o,"-"):n=t.replace(n,u,"-"),n=l?n:n.toLocaleLowerCase(),n=n.replace(e,"-"),n=n.replace(c,"-"),n=n.replace(s,""),n=n.replace(i,""),n):""}})},18675:()=>{(function(D){var E=D(window),d=function(t,u,o,r){if(arguments.length===3||r){if(o<t)return t;if(o>u)return u}return o},y=function(t){t.clientX=t.originalEvent.touches[0].clientX,t.clientY=t.originalEvent.touches[0].clientY},m=function(t){var u=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(u){var o={width:0,height:0},r=new Image;return r.onload=function(){if(t.css("background-size")=="cover"){var e=t.innerWidth(),c=t.innerHeight(),s=e/c;imageAspectRatio=r.width/r.height,scale=1,imageAspectRatio>=s?scale=c/r.height:scale=e/r.width,o.width=r.width*scale,o.height=r.height*scale}else o.width=r.width,o.height=r.height},r.src=u,o}};function h(t,u){this.element=t,this.options=u,this.init()}h.prototype.init=function(){var t=D(this.element),u=(t.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],o=this.options;if(u){var r={width:0,height:0};(o.bound||o.units=="percent")&&(r=m(t)),t.on("mousedown.dbg touchstart.dbg",function(e){if(e.target===t[0]){if(e.preventDefault(),e.originalEvent.touches)y(e);else if(e.which!==1)return;var c=e.clientX,s=e.clientY,i=t.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],a=parseInt(i[1])||0,g=parseInt(i[2])||0;o.units=="percent"&&(a=Math.round(a/-200*r.width),g=Math.round(g/-200*r.height)),E.on("mousemove.dbg touchmove.dbg",function(n){n.preventDefault(),n.originalEvent.touches&&y(n);var l=n.clientX,p=n.clientY;o.units=="percent"?(a=o.axis==="y"?a:d(-r.width/2,0,a+l-c,o.bound),g=o.axis==="x"?g:d(-r.height/2,0,g+p-s,o.bound),t.css("background-position",a/r.width*-200+"% "+g/r.height*-200+"%")):(a=o.axis==="y"?a:d(t.innerWidth()-r.width,0,a+l-c,o.bound),g=o.axis==="x"?g:d(t.innerHeight()-r.height,0,g+p-s,o.bound),t.css("background-position",a+"px "+g+"px")),c=l,s=p}),E.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){o.done&&o.done(),E.off("mousemove.dbg touchmove.dbg"),E.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},h.prototype.disable=function(){var t=D(this.element);t.off("mousedown.dbg touchstart.dbg"),E.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},D.fn.backgroundDraggable=function(u){var u=u,o=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=D(this);if(typeof u>"u"||typeof u=="object"){u=D.extend({},D.fn.backgroundDraggable.defaults,u);var e=new h(this,u);r.data("dbg",e)}else if(typeof u=="string"&&r.data("dbg")){var e=r.data("dbg");h.prototype[u].apply(e,o)}})},D.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)}}]);
