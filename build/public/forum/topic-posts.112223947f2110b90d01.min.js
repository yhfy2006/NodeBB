"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[75264,22765],{22410:(b,R,a)=>{var E,h;E=[a(91749),a(29930),a(49897)],h=function(N,P,x){const S={};let w,l=0,g=!1,j,B=0;S.init=function(r,T){const c=$("body");typeof r=="function"?(w=r,j=c):(w=T,j=r||c),l=$(window).scrollTop(),$(window).off("scroll",i).on("scroll",i),c.height()<=$(window).height()&&w(1)};function i(){B&&clearTimeout(B),B=setTimeout(function(){B=0,_()},60)}function _(){const r=utils.findBootstrapEnvironment(),T=(r==="xs"||r==="sm")&&$("html").hasClass("composing");if(g||T||app.flags._glance)return;const c=$(window).scrollTop(),d=$(window).height(),m=j.height()-d,M=j.offset()?j.offset().top:0,A=100*(c-M)/(m<=0?d:m),O=15,L=85,D=c>l?1:-1;(A<O&&c<l||A>L&&c>l||A<0&&D>0&&m<0)&&w(D),l=c}return S.loadMore=function(r,T,c){if(g)return;g=!0;const d={method:r,data:T};N.fire("action:infinitescroll.loadmore",d),(d.method.startsWith("/")?x.get:socket.emit)(d.method,d.data,function(M,A){if(M)return g=!1,P.error(M);c(A,function(){g=!1})})},S.loadMoreXhr=function(r,T){if(g)return;g=!0;const c=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),d={url:c,data:r};N.fire("action:infinitescroll.loadmore.xhr",d),$.get(c,r,function(m){T(m,function(){g=!1})}).fail(function(m){g=!1,P.error(String(m.responseJSON||"[[error:no-connection]]"))})},S.removeExtra=function(r,T,c){let d=$();if(r.length<=c)return d;const m=r.length-c;if(T>0){const M=$(document).height(),A=$(window).scrollTop();d=r.slice(0,m).remove(),$(window).scrollTop(A+($(document).height()-M))}else d=r.slice(r.length-m).remove();return d},S}.apply(R,E),h!==void 0&&(b.exports=h)},2269:(b,R)=>{var a,E;a=[],E=function(){const h={},N=/-resized(\.[\w]+)?$/;return h.wrapImagesInLinks=function(P){P.find('[component="post/content"] img:not(.emoji)').each(function(){h.wrapImageInLink($(this))})},h.wrapImageInLink=function(P){let x=P.attr("src")||"";if(x!=="about:blank"&&!P.parent().is("a")){utils.isRelativeUrl(x)&&N.test(x)&&(x=x.replace(N,"$1"));const S=P.attr("alt")||"",w=x.split(".").slice(1).pop(),l=S.split("/").pop(),g=l.split(".").slice(1).pop();P.wrap('<a href="'+x+'" '+(!w&&g?' download="'+utils.escapeHTML(l)+'" ':"")+' target="_blank" rel="noopener">')}},h}.apply(R,a),E!==void 0&&(b.exports=E)},47536:(b,R,a)=>{var E,h;E=[a(25967),a(22410),a(8454),a(2269),a(96352),a(52473),a(17459),a(91749),a(30076)],h=function(N,P,x,S,w,l,g,j,B){const i={};i.signaturesShown={};const _=$(window);i.onNewPost=function(t){!t||!t.posts||!t.posts.length||parseInt(t.posts[0].tid,10)!==parseInt(ajaxify.data.tid,10)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),i.modifyPostsByPrivileges(t.posts),T(t.posts),r(t.posts[0]),c(t.posts),ajaxify.data.postcount+=1,x.updatePostCount(ajaxify.data.postcount),config.usePagination?d(t):M(t),a.e(18631).then(function(){var o=[a(18631)];(function(e){e.onNewPost(t)}).apply(null,o)}).catch(a.oe))};function r(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}i.modifyPostsByPrivileges=function(t){t.forEach(function(o){o.selfPost=!!app.user.uid&&parseInt(o.uid,10)===parseInt(app.user.uid,10),o.topicOwnerPost=parseInt(o.uid,10)===parseInt(ajaxify.data.uid,10),o.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&o.selfPost||ajaxify.data.privileges.isAdminOrMod,o.display_moderator_tools=o.display_edit_tools||o.display_delete_tools,o.display_move_tools=ajaxify.data.privileges.isAdminOrMod,o.display_post_menu=ajaxify.data.privileges.isAdminOrMod||o.selfPost&&!ajaxify.data.locked&&!o.deleted||o.selfPost&&o.deleted&&parseInt(o.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!o.deleted})};function T(t){for(let o=0;o<t.length;o+=1){const e=l.get("user/postcount",t[o].uid);e.html(B.formattedNumber(parseInt(e.attr("data-postcount"),10)+1))}}function c(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,l.get("post").not("[data-index=0]").each(function(){const o=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",o)}))}function d(t){function o(){A(t.posts[0])}const e=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(e[0].topic.postcount/config.postsPerPage));const n=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&n===1||ajaxify.data.pagination.currentPage===1&&n===-1){const v=$('[component="post"]:not([data-index=0]), [component="topic/event"]');O(t,v,n,!1,o)}else ajaxify.data.scrollToMyPost&&parseInt(e[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){N.loadPage(ajaxify.data.pagination.pageCount,o)},250):m()}function m(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(o){$('[component="pagination"]').after(o).remove()})})}function M(t){const o=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,e=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!e&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!e&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const n=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');O(t,n,o,!1,function(s){s&&s.addClass("new"),A(t.posts[0])})}function A(t){t.selfPost&&ajaxify.data.scrollToMyPost&&w.scrollBottom(t.index)}function O(t,o,e,n,s){if(s=s||function(){},!t||t.posts&&!t.posts.length)return s();function v(){const u=$('[component="post"].new');if(u.length===t.posts.length){let y=!0;if(u.each(function(f,C){parseInt($(C).attr("data-pid"),10)!==parseInt(t.posts[f].pid,10)&&(y=!1)}),y){u.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}u.length&&t.posts.length>1&&t.posts.forEach(function(y){const f=l.get("post","pid",y.pid);f.hasClass("new")&&f.remove()}),t.posts=t.posts.filter(function(y){return y.allowDupe||$('[component="post"][data-pid="'+y.pid+'"]').length===0})}if(v(),!t.posts.length)return s();let p,I;e>0&&o.length?p=o.last():e<0&&o.length&&(I=o.first()),j.fire("action:posts.loading",{posts:t.posts,after:p,before:I}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(u){u=u.filter(function(){const f=$(this),C=f.attr("data-pid"),k=f.attr("data-allow-dupe");return!f.is('[component="post"]')||k||C&&$('[component="post"][data-pid="'+C+'"]').length===0});const y=P.removeExtra($('[component="post"]'),e,Math.max(20,config.postsPerPage*2));if(p)u.insertAfter(p);else if(I){const f=$(document).height(),C=_.scrollTop();u.insertBefore(I),(n||C>0)&&_.scrollTop(C+($(document).height()-f))}else l.get("topic").append(u);await i.onNewPostsAddedToDom(u),W(y),j.fire("action:posts.loaded",{posts:t.posts}),s(u)})}i.loadMorePosts=function(t){if(!l.get("topic").length||w.scrollActive)return;const o=l.get("topic").find(l.get("post").not("[data-index=0]").not(".new")),e=t>0?o.last():o.first(),n=parseInt(e.attr("data-index"),10)||0,s=ajaxify.data.tid;if(!utils.isNumber(s)||!utils.isNumber(n)||t<0&&l.get("post","index",0).length)return;const v=$(".loading-indicator");v.is(":animated")||v.fadeIn(),P.loadMore("topics.loadMore",{tid:s,after:n+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(p,I){if(v.fadeOut(),p&&p.posts&&p.posts.length){const u=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');O(p,u,t,!0,I)}else w.update(),I()})},i.onTopicPageLoad=async function(t){F(t),S.wrapImagesInLinks(t),D(t),i.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),i.addBlockquoteEllipses(t),U(t),await L()},i.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const o=await Promise.all(t.map(e=>app.parseAndTranslate("partials/topic/event",{...e,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(o);else if(config.topicPostSort==="newest_to_oldest"){const e=$('[component="topic"] [component="post"][data-index="0"]');e.length?e.after(o.reverse()):$('[component="topic"]').prepend(o.reverse())}$('[component="topic/event"] .timeago').timeago()};async function L(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const o=_.scrollTop(),e=$('[component="post"]').toArray();await Promise.all(e.map(async function(n){n=$(n);const s=n.prev('[component="post"]');if(n.is(":has(.necro-post)")||!s.length||config.topicPostSort==="newest_to_oldest"&&parseInt(s.attr("data-index"),10)===0)return;const v=n.attr("data-timestamp")-s.attr("data-timestamp");if(Math.abs(v)>=t){const p=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],I={};p.forEach(f=>{I[f]=$.timeago.settings.strings[f],$.timeago.settings.strings[f]=""});const u=(v>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(v)+"]]";p.forEach(f=>{$.timeago.settings.strings[f]=I[f]});const y=await app.parseAndTranslate("partials/topic/necro-post",{text:u});y.attr("data-necro-post-index",s.attr("data-index")),y.insertBefore(n)}})),o>0&&_.scrollTop()<o&&_.scrollTop(o)}function D(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((o,e)=>{const n=$(e).find('[component="post/signature"]'),s=n.attr("data-uid");i.signaturesShown[s]?n.addClass("hidden"):i.signaturesShown[s]=!0})}function W(t){t.each((o,e)=>{$(`[data-necro-post-index="${$(e).attr("data-index")}"]`).remove()})}function F(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const o=document.createElement("a");o.className="login-required",o.href=config.relative_path+"/login",g.translate("[[topic:login-to-view]]",function(e){o.appendChild(document.createTextNode(e)),t.each(function(n,s){$(s).find('[component="post/content"] img').each(function(v,p){p=$(p),p.attr("src").startsWith(config.relative_path+config.upload_url)&&p.replaceWith(o.cloneNode(!0))})})})}i.onNewPostsAddedToDom=async function(t){await i.onTopicPageLoad(t),t.find(".timeago").timeago()},i.showBottomPostBar=function(){const t=l.get("post","index",0),o=$(".post-bar-placeholder"),e=$('[component="post"]');t.length&&e.length>1&&$(".post-bar").length<2&&o.length?($(".post-bar").clone().insertAfter(o),o.remove()):t.length&&e.length<2&&t.find(".post-bar").remove()};function U(t){t.each(function(){$(this).hasClass("deleted")&&x.toggle($(this).attr("data-pid"),!0)})}return i.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((n,s)=>!$(s).parent().is("blockquote")).find(">blockquote").each(function(){const n=$(this);n.find(":hidden:not(br)").length&&!n.find(".toggle").length&&n.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},i}.apply(R,E),h!==void 0&&(b.exports=h)}}]);
