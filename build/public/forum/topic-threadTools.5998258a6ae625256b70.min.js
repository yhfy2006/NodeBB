"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[85940,22765,75264,37418],{22410:(b,L,s)=>{var C,x;C=[s(91749),s(29930),s(49897)],x=function(p,u,T){const S={};let f,h=0,P=!1,v,A=0;S.init=function(l,k){const o=$("body");typeof l=="function"?(f=l,v=o):(f=k,v=l||o),h=$(window).scrollTop(),$(window).off("scroll",c).on("scroll",c),o.height()<=$(window).height()&&f(1)};function c(){A&&clearTimeout(A),A=setTimeout(function(){A=0,m()},60)}function m(){const l=utils.findBootstrapEnvironment(),k=(l==="xs"||l==="sm")&&$("html").hasClass("composing");if(P||k||app.flags._glance)return;const o=$(window).scrollTop(),n=$(window).height(),a=v.height()-n,i=v.offset()?v.offset().top:0,r=100*(o-i)/(a<=0?n:a),j=15,E=85,M=o>h?1:-1;(r<j&&o<h||r>E&&o>h||r<0&&M>0&&a<0)&&f(M),h=o}return S.loadMore=function(l,k,o){if(P)return;P=!0;const n={method:l,data:k};p.fire("action:infinitescroll.loadmore",n),(n.method.startsWith("/")?T.get:socket.emit)(n.method,n.data,function(i,r){if(i)return P=!1,u.error(i);o(r,function(){P=!1})})},S.loadMoreXhr=function(l,k){if(P)return;P=!0;const o=config.relative_path+"/api"+location.pathname.replace(new RegExp("^"+config.relative_path),""),n={url:o,data:l};p.fire("action:infinitescroll.loadmore.xhr",n),$.get(o,l,function(a){k(a,function(){P=!1})}).fail(function(a){P=!1,u.error(String(a.responseJSON||"[[error:no-connection]]"))})},S.removeExtra=function(l,k,o){let n=$();if(l.length<=o)return n;const a=l.length-o;if(k>0){const i=$(document).height(),r=$(window).scrollTop();n=l.slice(0,a).remove(),$(window).scrollTop(r+($(document).height()-i))}else n=l.slice(l.length-a).remove();return n},S}.apply(L,C),x!==void 0&&(b.exports=x)},2269:(b,L)=>{var s,C;s=[],C=function(){const x={},p=/-resized(\.[\w]+)?$/;return x.wrapImagesInLinks=function(u){u.find('[component="post/content"] img:not(.emoji)').each(function(){x.wrapImageInLink($(this))})},x.wrapImageInLink=function(u){let T=u.attr("src")||"";if(T!=="about:blank"&&!u.parent().is("a")){utils.isRelativeUrl(T)&&p.test(T)&&(T=T.replace(p,"$1"));const S=u.attr("alt")||"",f=T.split(".").slice(1).pop(),h=S.split("/").pop(),P=h.split(".").slice(1).pop();u.wrap('<a href="'+T+'" '+(!f&&P?' download="'+utils.escapeHTML(h)+'" ':"")+' target="_blank" rel="noopener">')}},x}.apply(L,s),C!==void 0&&(b.exports=C)},47536:(b,L,s)=>{var C,x;C=[s(25967),s(22410),s(8454),s(2269),s(96352),s(52473),s(17459),s(91749),s(30076)],x=function(p,u,T,S,f,h,P,v,A){const c={};c.signaturesShown={};const m=$(window);c.onNewPost=function(t){!t||!t.posts||!t.posts.length||parseInt(t.posts[0].tid,10)!==parseInt(ajaxify.data.tid,10)||(t.loggedIn=!!app.user.uid,t.privileges=ajaxify.data.privileges,t.posts[0].timestamp=t.posts[0].topic.scheduled?t.posts[0].timestamp:Date.now()-1e3,t.posts[0].timestampISO=utils.toISOString(t.posts[0].timestamp),c.modifyPostsByPrivileges(t.posts),k(t.posts),l(t.posts[0]),o(t.posts),ajaxify.data.postcount+=1,T.updatePostCount(ajaxify.data.postcount),config.usePagination?n(t):i(t),s.e(18631).then(function(){var e=[s(18631)];(function(d){d.onNewPost(t)}).apply(null,e)}).catch(s.oe))};function l(t){$(".pagination-block .pagebottom .timeago").timeago("update",t.timestampISO)}c.modifyPostsByPrivileges=function(t){t.forEach(function(e){e.selfPost=!!app.user.uid&&parseInt(e.uid,10)===parseInt(app.user.uid,10),e.topicOwnerPost=parseInt(e.uid,10)===parseInt(ajaxify.data.uid,10),e.display_edit_tools=ajaxify.data.privileges["posts:edit"]&&e.selfPost||ajaxify.data.privileges.isAdminOrMod,e.display_delete_tools=ajaxify.data.privileges["posts:delete"]&&e.selfPost||ajaxify.data.privileges.isAdminOrMod,e.display_moderator_tools=e.display_edit_tools||e.display_delete_tools,e.display_move_tools=ajaxify.data.privileges.isAdminOrMod,e.display_post_menu=ajaxify.data.privileges.isAdminOrMod||e.selfPost&&!ajaxify.data.locked&&!e.deleted||e.selfPost&&e.deleted&&parseInt(e.deleterUid,10)===parseInt(app.user.uid,10)||(app.user.uid||ajaxify.data.postSharing.length)&&!e.deleted})};function k(t){for(let e=0;e<t.length;e+=1){const d=h.get("user/postcount",t[e].uid);d.html(A.formattedNumber(parseInt(d.attr("data-postcount"),10)+1))}}function o(t){config.topicPostSort==="newest_to_oldest"&&(t[0].index=1,h.get("post").not("[data-index=0]").each(function(){const e=parseInt($(this).attr("data-index"),10)+1;$(this).attr("data-index",e)}))}function n(t){function e(){r(t.posts[0])}const d=t.posts;ajaxify.data.pagination.pageCount=Math.max(1,Math.ceil(d[0].topic.postcount/config.postsPerPage));const g=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1;if(ajaxify.data.pagination.currentPage===ajaxify.data.pagination.pageCount&&g===1||ajaxify.data.pagination.currentPage===1&&g===-1){const R=$('[component="post"]:not([data-index=0]), [component="topic/event"]');j(t,R,g,!1,e)}else ajaxify.data.scrollToMyPost&&parseInt(d[0].uid,10)===parseInt(app.user.uid,10)?setTimeout(function(){p.loadPage(ajaxify.data.pagination.pageCount,e)},250):a()}function a(){$.get(config.relative_path+"/api/topic/pagination/"+ajaxify.data.tid,{page:ajaxify.data.pagination.currentPage},function(t){app.parseAndTranslate("partials/paginator",t,function(e){$('[component="pagination"]').after(e).remove()})})}function i(t){const e=config.topicPostSort==="oldest_to_newest"||config.topicPostSort==="most_votes"?1:-1,d=$('[component="post"][data-index="'+(t.posts[0].index-1)+'"]').length;if(!d&&(!t.posts[0].selfPost||!ajaxify.data.scrollToMyPost))return;if(!d&&t.posts[0].selfPost)return ajaxify.go("post/"+t.posts[0].pid);const g=$('[component="topic"]>[component="post"]:not([data-index=0]), [component="topic"]>[component="topic/event"]');j(t,g,e,!1,function(y){y&&y.addClass("new"),r(t.posts[0])})}function r(t){t.selfPost&&ajaxify.data.scrollToMyPost&&f.scrollBottom(t.index)}function j(t,e,d,g,y){if(y=y||function(){},!t||t.posts&&!t.posts.length)return y();function R(){const D=$('[component="post"].new');if(D.length===t.posts.length){let B=!0;if(D.each(function(I,W){parseInt($(W).attr("data-pid"),10)!==parseInt(t.posts[I].pid,10)&&(B=!1)}),B){D.each(function(){$(this).removeClass("new")}),t.posts.length=0;return}}D.length&&t.posts.length>1&&t.posts.forEach(function(B){const I=h.get("post","pid",B.pid);I.hasClass("new")&&I.remove()}),t.posts=t.posts.filter(function(B){return B.allowDupe||$('[component="post"][data-pid="'+B.pid+'"]').length===0})}if(R(),!t.posts.length)return y();let w,N;d>0&&e.length?w=e.last():d<0&&e.length&&(N=e.first()),v.fire("action:posts.loading",{posts:t.posts,after:w,before:N}),app.parseAndTranslate("topic","posts",Object.assign({},ajaxify.data,t),async function(D){D=D.filter(function(){const I=$(this),W=I.attr("data-pid"),F=I.attr("data-allow-dupe");return!I.is('[component="post"]')||F||W&&$('[component="post"][data-pid="'+W+'"]').length===0});const B=u.removeExtra($('[component="post"]'),d,Math.max(20,config.postsPerPage*2));if(w)D.insertAfter(w);else if(N){const I=$(document).height(),W=m.scrollTop();D.insertBefore(N),(g||W>0)&&m.scrollTop(W+($(document).height()-I))}else h.get("topic").append(D);await c.onNewPostsAddedToDom(D),O(B),v.fire("action:posts.loaded",{posts:t.posts}),y(D)})}c.loadMorePosts=function(t){if(!h.get("topic").length||f.scrollActive)return;const e=h.get("topic").find(h.get("post").not("[data-index=0]").not(".new")),d=t>0?e.last():e.first(),g=parseInt(d.attr("data-index"),10)||0,y=ajaxify.data.tid;if(!utils.isNumber(y)||!utils.isNumber(g)||t<0&&h.get("post","index",0).length)return;const R=$(".loading-indicator");R.is(":animated")||R.fadeIn(),u.loadMore("topics.loadMore",{tid:y,after:g+(t>0?1:0),count:config.postsPerPage,direction:t,topicPostSort:utils.params().sort||config.topicPostSort},function(w,N){if(R.fadeOut(),w&&w.posts&&w.posts.length){const D=$('[component="post"]:not([data-index=0]):not(.new), [component="topic/event"]');j(w,D,t,!0,N)}else f.update(),N()})},c.onTopicPageLoad=async function(t){U(t),S.wrapImagesInLinks(t),M(t),c.showBottomPostBar(),t.find('[component="post/content"] img:not(.not-responsive)').addClass("img-fluid"),c.addBlockquoteEllipses(t),K(t),await E()},c.addTopicEvents=async function(t){if(config.topicPostSort==="most_votes")return;const e=await Promise.all(t.map(d=>app.parseAndTranslate("partials/topic/event",{...d,privileges:ajaxify.data.privileges})));if(config.topicPostSort==="oldest_to_newest")$('[component="topic"]').append(e);else if(config.topicPostSort==="newest_to_oldest"){const d=$('[component="topic"] [component="post"][data-index="0"]');d.length?d.after(e.reverse()):$('[component="topic"]').prepend(e.reverse())}$('[component="topic/event"] .timeago').timeago()};async function E(){const t=ajaxify.data.necroThreshold*24*60*60*1e3;if(!t||config.topicPostSort!=="newest_to_oldest"&&config.topicPostSort!=="oldest_to_newest")return;const e=m.scrollTop(),d=$('[component="post"]').toArray();await Promise.all(d.map(async function(g){g=$(g);const y=g.prev('[component="post"]');if(g.is(":has(.necro-post)")||!y.length||config.topicPostSort==="newest_to_oldest"&&parseInt(y.attr("data-index"),10)===0)return;const R=g.attr("data-timestamp")-y.attr("data-timestamp");if(Math.abs(R)>=t){const w=["suffixAgo","prefixAgo","suffixFromNow","prefixFromNow"],N={};w.forEach(I=>{N[I]=$.timeago.settings.strings[I],$.timeago.settings.strings[I]=""});const D=(R>0?"[[topic:timeago-later,":"[[topic:timeago-earlier,")+$.timeago.inWords(R)+"]]";w.forEach(I=>{$.timeago.settings.strings[I]=N[I]});const B=await app.parseAndTranslate("partials/topic/necro-post",{text:D});B.attr("data-necro-post-index",y.attr("data-index")),B.insertBefore(g)}})),e>0&&m.scrollTop()<e&&m.scrollTop(e)}function M(t){ajaxify.data["signatures:hideDuplicates"]&&t.each((e,d)=>{const g=$(d).find('[component="post/signature"]'),y=g.attr("data-uid");c.signaturesShown[y]?g.addClass("hidden"):c.signaturesShown[y]=!0})}function O(t){t.each((e,d)=>{$(`[data-necro-post-index="${$(d).attr("data-index")}"]`).remove()})}function U(t){if(app.user.uid||!ajaxify.data.privateUploads)return;const e=document.createElement("a");e.className="login-required",e.href=config.relative_path+"/login",P.translate("[[topic:login-to-view]]",function(d){e.appendChild(document.createTextNode(d)),t.each(function(g,y){$(y).find('[component="post/content"] img').each(function(R,w){w=$(w),w.attr("src").startsWith(config.relative_path+config.upload_url)&&w.replaceWith(e.cloneNode(!0))})})})}c.onNewPostsAddedToDom=async function(t){await c.onTopicPageLoad(t),t.find(".timeago").timeago()},c.showBottomPostBar=function(){const t=h.get("post","index",0),e=$(".post-bar-placeholder"),d=$('[component="post"]');t.length&&d.length>1&&$(".post-bar").length<2&&e.length?($(".post-bar").clone().insertAfter(e),e.remove()):t.length&&d.length<2&&t.find(".post-bar").remove()};function K(t){t.each(function(){$(this).hasClass("deleted")&&T.toggle($(this).attr("data-pid"),!0)})}return c.addBlockquoteEllipses=function(t){t.find('[component="post/content"] blockquote').filter((g,y)=>!$(y).parent().is("blockquote")).find(">blockquote").each(function(){const g=$(this);g.find(":hidden:not(br)").length&&!g.find(".toggle").length&&g.append('<i class="d-inline-block fa fa-angle-down pointer toggle py-1 px-3 border text-bg-light"></i>')})},c}.apply(L,C),x!==void 0&&(b.exports=x)},60984:(b,L,s)=>{var C,x;C=[s(52473),s(17459),s(60644),s(47536),s(49897),s(91749),s(40027),s(29930),s(89336)],x=function(p,u,T,S,f,h,P,v,A){const c={};c.init=function(o,n){m(n),$(".topic-main-buttons [title]").tooltip({container:"#content",animation:!1}),c.observeTopicLabels($('[component="topic/labels"]')),n.on("click",'[component="topic/delete"]',function(){return l("del","/state","delete"),!1}),n.on("click",'[component="topic/restore"]',function(){return l("put","/state","restore"),!1}),n.on("click",'[component="topic/purge"]',function(){return l("del","","purge"),!1}),n.on("click",'[component="topic/lock"]',function(){return l("put","/lock","lock"),!1}),n.on("click",'[component="topic/unlock"]',function(){return l("del","/lock","unlock"),!1}),n.on("click",'[component="topic/pin"]',function(){return l("put","/pin","pin"),!1}),n.on("click",'[component="topic/unpin"]',function(){return l("del","/pin","unpin"),!1}),n.on("click",'[component="topic/mark-unread"]',function(){l("del","/read",void 0,()=>{app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,function(){T.onBackClicked(!0)}):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,T.onBackClicked),v.success("[[topic:mark-unread.success]]")})}),n.on("click",'[component="topic/mark-unread-for-all"]',function(){const i=$(this);l("put","/bump",void 0,()=>{v.success("[[topic:markAsUnreadForAll.success]]"),i.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")})}),n.on("click",'[component="topic/event/delete"]',function(){const i=$(this).attr("data-topic-event-id"),r=$(this).parents('[component="topic/event"]');P.confirm("[[topic:delete-event-confirm]]",j=>{j&&f.del(`/topics/${o}/events/${i}`,{}).then(function(){r.remove()}).catch(v.error)})}),n.on("click",'[component="topic/move"]',function(){return s.e(28310).then(function(){var i=[s(28310)];(function(r){r.init([o],ajaxify.data.cid)}).apply(null,i)}).catch(s.oe),!1}),n.on("click",'[component="topic/delete/posts"]',function(){s.e(36422).then(function(){var i=[s(36422)];(function(r){r.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/fork"]',function(){s.e(49771).then(function(){var i=[s(49771)];(function(r){r.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/merge"]',function(){s.e(2403).then(function(){var i=[s(2403)];(function(r){r.init(function(){r.addTopic(ajaxify.data.tid)})}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/tag"]',function(){s.e(63).then(function(){var i=[s(63)];(function(r){r.init([ajaxify.data],ajaxify.data.tagWhitelist)}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/move-posts"]',function(){s.e(90677).then(function(){var i=[s(90677)];(function(r){r.init()}).apply(null,i)}).catch(s.oe)}),n.on("click",'[component="topic/following"]',function(){a("follow")}),n.on("click",'[component="topic/not-following"]',function(){a("follow",0)}),n.on("click",'[component="topic/ignoring"]',function(){a("ignore")});function a(i,r=1){return f[r?"put":"del"](`/topics/${o}/${i}`,{},()=>{let E="";i==="follow"?E=r?"[[topic:following-topic.message]]":"[[topic:not-following-topic.message]]":i==="ignore"&&(E=r?"[[topic:ignoring-topic.message]]":"[[topic:not-following-topic.message]]"),r||(i="unfollow"),k(i),v.alert({alert_id:"follow_thread",message:E,type:"success",timeout:5e3}),h.fire("action:topics.changeWatching",{tid:o,type:i})},()=>{v.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please-log-in]]",message:"[[topic:login-to-subscribe]]",timeout:5e3})}),!1}},c.observeTopicLabels=function(o){const n=new MutationObserver(function(a){const i=a[0];if(i&&i.attributeName==="class"){const r=o.children().filter((j,E)=>!$(E).hasClass("hidden"));o.toggleClass("hidden",!r.length)}});o.children().each((a,i)=>{n.observe(i,{attributes:!0})})};function m(o){o&&o.on("show.bs.dropdown",".thread-tools",async function(){const n=$(this),a=n.find(".dropdown-menu"),{top:i}=this.getBoundingClientRect();if(n.toggleClass("dropup",i>window.innerHeight/2),a.attr("data-loaded"))return;const r=await socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid}),j=await app.parseAndTranslate("partials/topic/topic-menu-list",r);$(a).attr("data-loaded","true").html(j),h.fire("action:topic.tools.load",{element:$(a)})})}function l(o,n,a,i){i||(i=function(){});const r=ajaxify.data.tid,j={},E=function(M){M&&f[o](`/topics/${r}${n}`,j).then(i).catch(v.error)};switch(a){case"delete":case"restore":case"purge":P.confirm(`[[topic:thread-tools.${a}-confirm]]`,E);break;case"pin":c.requestPinExpiry(j,E.bind(null,!0));break;default:E(!0);break}}c.requestPinExpiry=function(o,n){app.parseAndTranslate("modals/set-pin-expiry",{},function(a){const i=P.dialog({title:"[[topic:thread-tools.pin]]",message:a,onEscape:!0,buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){const r=i.get(0).querySelector("#expiry-date"),j=i.get(0).querySelector("#expiry-time");let E=r.value,M=j.value;if(E===""&&M==="")return n();E=E||new Date().toDateString(),M=M||new Date().toTimeString();const O=new Date(`${E} ${M}`);O.getTime()>Date.now()?(o.expiry=O.getTime(),n()):v.error("[[error:invalid-date]]")}}}})})},c.setLockedState=function(o){const n=p.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;const a=o.isLocked&&!ajaxify.data.privileges.isAdminOrMod;p.get("topic/lock").toggleClass("hidden",o.isLocked).parent().attr("hidden",o.isLocked?"":null),p.get("topic/unlock").toggleClass("hidden",!o.isLocked).parent().attr("hidden",o.isLocked?null:"");const i=!!((o.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod);p.get("topic/reply/container").toggleClass("hidden",i),p.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!o.isLocked||ajaxify.data.deleted),n.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",i),n.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",a),n.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",a),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!o.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=o.isLocked,S.addTopicEvents(o.events)},c.setDeleteState=function(o){const n=p.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;p.get("topic/delete").toggleClass("hidden",o.isDelete).parent().attr("hidden",o.isDelete?"":null),p.get("topic/restore").toggleClass("hidden",!o.isDelete).parent().attr("hidden",o.isDelete?null:""),p.get("topic/purge").toggleClass("hidden",!o.isDelete).parent().attr("hidden",o.isDelete?null:""),p.get("topic/deleted/message").toggleClass("hidden",!o.isDelete),o.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:o.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},function(i){p.get("topic/deleted/message").replaceWith(i),i.find(".timeago").timeago()});const a=o.isDelete&&!ajaxify.data.privileges.isAdminOrMod;p.get("topic/reply/container").toggleClass("hidden",a),p.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||o.isDelete),n.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",a),n.toggleClass("deleted",o.isDelete),ajaxify.data.deleted=o.isDelete?1:0,S.addTopicEvents(o.events)},c.setPinnedState=function(o){const n=p.get("topic");if(parseInt(o.tid,10)!==parseInt(n.attr("data-tid"),10))return;p.get("topic/pin").toggleClass("hidden",o.pinned).parent().attr("hidden",o.pinned?"":null),p.get("topic/unpin").toggleClass("hidden",!o.pinned).parent().attr("hidden",o.pinned?null:"");const a=$('[component="topic/labels"] [component="topic/pinned"]');a.toggleClass("hidden",!o.pinned),o.pinned&&a.translateAttr("title",o.pinExpiry&&o.pinExpiryISO?"[[topic:pinned-with-expiry, "+o.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=o.pinned,S.addTopicEvents(o.events)};function k(o){const n={follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"};u.translate(n[o],function(i){const r=A.Tooltip.getInstance('[component="topic/watch"]');r&&r.setContent({".tooltip-inner":i})});let a=p.get("topic/following/menu");a.toggleClass("hidden",o!=="follow"),p.get("topic/following/check").toggleClass("fa-check",o==="follow"),a=p.get("topic/not-following/menu"),a.toggleClass("hidden",o!=="unfollow"),p.get("topic/not-following/check").toggleClass("fa-check",o==="unfollow"),a=p.get("topic/ignoring/menu"),a.toggleClass("hidden",o!=="ignore"),p.get("topic/ignoring/check").toggleClass("fa-check",o==="ignore")}return c}.apply(L,C),x!==void 0&&(b.exports=x)},60644:(b,L,s)=>{var C,x;C=[s(52473),s(68636),s(96352),s(25967)],x=function(p,u,T,S){const f={};let h;f.init=function(A){h=A,P(),$(window).off("action:popstate",v).on("action:popstate",v)},f.onBackClicked=v;function P(){$('[component="category"]').on("click",'[component="topic/header"]',function(){const A=$(this).parents("[data-index]").attr("data-index"),c=$(window).scrollTop();$('[component="category/topic"]').each(function(m,l){if($(l).offset().top-c>0)return u.setItem("category:bookmark",$(l).attr("data-index")),u.setItem("category:bookmark:clicked",A),u.setItem("category:bookmark:offset",$(l).offset().top-c),!1})})}function v(A){const c=A&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||c){let m=u.getItem("category:bookmark"),l=u.getItem("category:bookmark:clicked");if(u.removeItem("category:bookmark"),u.removeItem("category:bookmark:clicked"),!utils.isNumber(m))return;if(m=Math.max(0,parseInt(m,10)||0),l=Math.max(0,parseInt(l,10)||0),config.usePagination){const k=Math.ceil((parseInt(m,10)+1)/config.topicsPerPage);parseInt(k,10)!==ajaxify.data.pagination.currentPage?S.loadPage(k,function(){f.scrollToTopic(m,l)}):f.scrollToTopic(m,l)}else{if(m===0){f.scrollToTopic(m,l);return}$('[component="category"]').empty(),h(Math.max(0,m-1)+1,function(){f.scrollToTopic(m,l)})}}}return f.highlightTopic=function(A){const c=p.get("category/topic","index",A);c.length&&!c.hasClass("highlight")&&(c.addClass("highlight"),setTimeout(function(){c.removeClass("highlight")},5e3))},f.scrollToTopic=function(A,c){if(!utils.isNumber(A))return;const m=p.get("category/topic","index",A);if(m.length){const l=u.getItem("category:bookmark:offset");u.removeItem("category:bookmark:offset"),$(window).scrollTop(m.offset().top-l),f.highlightTopic(c),T.update()}},f}.apply(L,C),x!==void 0&&(b.exports=x)}}]);
