"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[77200,68326],{19046:(C,h,r)=>{var u,l;u=[r(91749)],l=function(y){const f={},p={ignoring:1,notwatching:2,watching:3};f.initUnreadTopics=function(){const e=app.user.unreadData;function t(c){if(c&&c.posts&&c.posts.length&&e){const o=c.posts[0];if(parseInt(o.uid,10)===parseInt(app.user.uid,10)||!o.topic.isFollowing&&o.categoryWatchState!==p.watching)return;const n=o.topic.tid;(!e[""][n]||!e.new[n]||!e.watched[n]||!e.unreplied[n])&&a(n),e[""][n]||(i(""),e[""][n]=!0),o.isMain&&parseInt(o.uid,10)!==parseInt(app.user.uid,10)&&!e.new[n]&&(i("new"),e.new[n]=!0),parseInt(o.topic.postcount,10)<=1&&!e.unreplied[n]&&(i("unreplied"),e.unreplied[n]=!0),o.topic.isFollowing&&!e.watched[n]&&(i("watched"),e.watched[n]=!0)}}function i(c){const o="/unread"+(c?"?filter="+c:""),n=1+parseInt($('a[href="'+config.relative_path+o+'"].navigation-link i').attr("data-content"),10);s(o,n)}function a(c){$('[data-tid="'+c+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(c){delete e[c][ajaxify.data.tid]})}),socket.removeListener("event:new_post",t),socket.on("event:new_post",t),socket.removeListener("event:unread.updateCount",g),socket.on("event:unread.updateCount",g)};function g(e){s("/unread",e.unreadTopicCount),s("/unread?filter=new",e.unreadNewTopicCount),s("/unread?filter=watched",e.unreadWatchedTopicCount),s("/unread?filter=unreplied",e.unreadUnrepliedTopicCount)}function s(e,t){if(!utils.isNumber(t))return;t=Math.max(0,t);const i=t>99?"99+":t,a=$('a[href="'+config.relative_path+e+'"].navigation-link');a.find("i").toggleClass("unread-count",t>0).attr("data-content",i),a.find('[component="navigation/count"]').toggleClass("hidden",t<=0).text(t),$('#mobile-menu [data-unread-url="'+e+'"]').attr("data-content",i),$('[component="unread/count"][data-unread-url="'+e+'"]').toggleClass("hidden",t<=0).text(i),y.fire("action:unread.updateCount",{url:e,count:t})}return f.updateUnreadTopicCount=s,f}.apply(h,u),l!==void 0&&(C.exports=l)},45876:(C,h,r)=>{var u,l;u=[r(19046),r(70550),r(52473),r(47682),r(65348),r(29930),r(49897)],l=function(y,f,p,g,s,e,t){const i={};i.init=function(){app.enterRoom("unread_topics"),a(),g.init("unread"),y.updateUnreadTopicCount("/"+ajaxify.data.selectedFilter.url,ajaxify.data.topicCount)};function a(){function n(){socket.emit("topics.markAllRead",function(d){if(d)return e.error(d);e.success("[[unread:topics-marked-as-read.success]]"),$('[component="category"]').empty(),$('[component="pagination"]').addClass("hidden"),$("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden")})}function m(){const d=f.getSelectedTids();d.length&&Promise.all(d.map(async E=>t.put(`/topics/${E}/read`))).then(()=>{c(d)})}function T(d){function E(w){const v=[];return p.get("category/topic","cid",w).each(function(){v.push($(this).attr("data-tid"))}),v}const k=E(d);socket.emit("topics.markCategoryTopicsRead",d,function(w){if(w)return e.error(w);c(k)})}const A=s.init($('[component="category-selector"]'),{onSelect:function(d){A.selectCategory(0),d.cid==="all"?n():d.cid==="selected"?m():parseInt(d.cid,10)>0&&T(d.cid)},selectCategoryLabel:ajaxify.data.selectCategoryLabel||"[[unread:mark-as-read]]",localCategories:[{cid:"selected",name:"[[unread:selected]]",icon:""},{cid:"all",name:"[[unread:all]]",icon:""}]})}function c(n){o(n),e.success("[[unread:topics-marked-as-read.success]]"),$('[component="category"]').children().length||($("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden"))}function o(n){for(let m=0;m<n.length;m+=1)p.get("category/topic","tid",n[m]).remove()}return i}.apply(h,u),l!==void 0&&(C.exports=l)},65348:(C,h,r)=>{var u,l;u=[r(96349),r(40027),r(91749),r(17459)],l=function(y,f,p,g){const s={};return s.init=function(e,t){if(!e||!e.length)return;t=t||{};const i=t.onSelect||function(){};t.states=t.states||["watching","tracking","notwatching","ignoring"],t.template=t.template||"partials/category/selector-dropdown-left",p.fire("action:category.selector.options",{el:e,options:t}),y.init(e,t);const a={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const o=$(this);return o.hasClass("disabled")?!1:(a.selectCategory(o.attr("data-cid")),i(a.selectedCategory))});let c=a.el.find('[component="category-selector-selected"]').html();return g.translate(c,o=>{c=o}),a.selectCategory=function(o){const n=a.el.find('[data-cid="'+o+'"]');a.selectedCategory={cid:o,name:n.attr("data-name")},n.length?a.el.find('[component="category-selector-selected"]').html(n.find('[component="category-markup"]').html()):a.el.find('[component="category-selector-selected"]').html(c)},a.getSelectedCategory=function(){return a.selectedCategory},a.getSelectedCid=function(){return a.selectedCategory?a.selectedCategory.cid:0},t.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(t.template,{selectedCategory:t.selectedCategory},function(o){a.el.find('[component="category-selector-selected"]').html(o.find('[component="category-selector-selected"]').html())}),a},s.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(t){const i=f.dialog({title:e.title||"[[modules:composer.select-category]]",message:t,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:c}}}),a=s.init(i.find('[component="category-selector"]'),e);function c(o){return o.preventDefault(),a.selectedCategory&&(e.onSubmit(a.selectedCategory),i.modal("hide")),!1}e.openOnLoad&&i.on("shown.bs.modal",function(){i.find(".dropdown-toggle").dropdown("toggle")}),i.find("form").on("submit",c)})},s}.apply(h,u),l!==void 0&&(C.exports=l)}}]);
