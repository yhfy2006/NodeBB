"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[98088],{57642:(C,E,n)=>{var v,l;v=[n(8454),n(60984),n(47536),n(2269),n(52473),n(17459),n(91749),n(30076)],l=function(f,a,g,A,p,I,k,S){const u={},r={"event:user_status_change":j,"event:voted":R,"event:bookmarked":B,"event:topic_deleted":a.setDeleteState,"event:topic_restored":a.setDeleteState,"event:topic_purged":b,"event:topic_locked":a.setLockedState,"event:topic_unlocked":a.setLockedState,"event:topic_pinned":a.setPinnedState,"event:topic_unpinned":a.setPinnedState,"event:topic_moved":O,"event:post_edited":w,"event:post_purged":L,"event:post_deleted":h,"event:post_restored":h,"posts.bookmark":y,"posts.unbookmark":y,"posts.upvote":m,"posts.downvote":m,"posts.unvote":m,"event:new_notification":D,"event:new_post":g.onNewPost};u.init=function(){u.removeListeners();for(const t in r)r.hasOwnProperty(t)&&socket.on(t,r[t])},u.removeListeners=function(){for(const t in r)r.hasOwnProperty(t)&&socket.removeListener(t,r[t])};function j(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function R(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(s,c){return parseInt($(c).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),o=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes),o.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function B(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function b(t){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function O(t){t&&t.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+t.slug,null,!0)}function w(t){if(!t||!t.post||parseInt(t.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const e=p.get("post/content",t.post.pid).filter(function(i,d){return parseInt($(d).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),o=$(`[data-pid="${t.post.pid}"]`),s=o.find('[component="post/editor"]').filter(function(i,d){return parseInt($(d).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),c=p.get("topic/title"),x=p.get("navbar/title").find("span"),P=p.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(c.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const i="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:i},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+i),c.fadeOut(250,function(){c.html(t.topic.title).fadeIn(250)}),P.fadeOut(250,function(){P.html(t.topic.title).fadeIn(250)}),x.fadeOut(250,function(){x.html(t.topic.title).fadeIn(250)})}t.post.changed?e.fadeOut(250,function(){if(e.html(I.unescape(t.post.content)),e.find("img:not(.not-responsive)").addClass("img-fluid"),A.wrapImagesInLinks(e.parent()),g.addBlockquoteEllipses(e.parent()),e.fadeIn(250),t.post.edited){const i={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",i,function(d){s.replaceWith(d),o.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${S.isoTimeToLocaleString(i.editedISO,config.userLang)}]]`),o.find('[component="post/editor"] .timeago').timeago(),k.fire("action:posts.edited",t)})}}):k.fire("action:posts.edited",t),t.topic.tags&&t.topic.tagsupdated&&n.e(63).then(function(){var i=[n(63)];(function(d){d.updateTopicTags([t.topic])}).apply(null,i)}).catch(n.oe),f.removeMenu(p.get("post","pid",t.post.pid))}function L(t){!t||parseInt(t.tid,10)!==parseInt(ajaxify.data.tid,10)||(p.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),g.showBottomPostBar()}),ajaxify.data.postcount-=1,f.updatePostCount(ajaxify.data.postcount),n.e(18631).then(function(){var e=[n(18631)];(function(o){o.onPostPurged(t)}).apply(null,e)}).catch(n.oe))}function h(t){const e=p.get("post","pid",t.pid);if(!e.length)return;e.toggleClass("deleted");const o=e.hasClass("deleted");f.toggle(t.pid,o),!ajaxify.data.privileges.isAdminOrMod&&parseInt(t.uid,10)!==parseInt(app.user.uid,10)&&(e.find('[component="post/tools"]').toggleClass("hidden",o),o?e.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):e.find('[component="post/content"]').html(I.unescape(t.content)))}function y(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(o,s){return parseInt($(s).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});e.length&&(e.attr("data-bookmarked",t.isBookmarked),e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function m(t){const e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter(function(o,s){return parseInt($(s).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("upvoted",t.upvote),e.find('[component="post/downvote"]').filter(function(o,s){return parseInt($(s).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("downvoted",t.downvote)}function D(t){const e=ajaxify.data.tid;t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)&&socket.emit("topics.markTopicNotificationsRead",[e])}return u}.apply(E,v),l!==void 0&&(C.exports=l)}}]);
