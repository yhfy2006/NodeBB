"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[37019,99127,34271,13417,51831,69185,1091,26174,26874,49897,34405],{33491:(k,x,l)=>{l.r(x),l.d(x,{enableCheckboxes:()=>i,enableFilterForm:()=>e,getSelected:()=>A,handleBulkActions:()=>g,handleGraphs:()=>b,init:()=>u});var f=l(92262),p=l(39259),v=l.n(p),C=l(64308),E=l.n(C),m=l(34405),h=l.n(m),a=l(49897),n=l(29930),s=l(52473),o=l.n(s);f.t1.register(f.ZT,f.PP,f.kc,f.No,f.FN,f.m_,f.dN);const c=new Map([["cids",[]],["assignee",[]],["targetUid",[]],["reporterId",[]]]);function u(){e(),i(),g(),ajaxify.data.filters.hasOwnProperty("cid")&&c.set("cids",Array.isArray(ajaxify.data.filters.cid)?ajaxify.data.filters.cid:[ajaxify.data.filters.cid]),p.init($('[component="category/dropdown"]'),{privilege:"moderate",selectedCids:c.get("cids"),updateButton:function({selectedCids:r}){c.set("cids",r),t()}}),["assignee","targetUid","reporterId"].forEach(r=>{ajaxify.data.filters.hasOwnProperty("filter")&&c.set(r,ajaxify.data.selected[r]);const d=$(`[component="flags/filter/${r}"]`);C.init(d,{selectedUsers:c.get(r),template:"partials/flags/filters",selectedBlock:`selected.${r}`,onSelect:function(_){c.set(r,_)},onHidden:function(){t()}})}),s.get("flags/list").on("click","[data-flag-id]",function(r){if(["BUTTON","A"].includes(r.target.nodeName))return;const d=this.getAttribute("data-flag-id");ajaxify.go("flags/"+d)}),$("#flags-daily-wrapper").one("shown.bs.collapse",function(){b()}),m.user($("#filter-assignee, #filter-targetUid, #filter-reporterId"),(r,d)=>{setTimeout(()=>{r.target.value=d.item.user.uid})})}function e(){const r=s.get("flags/filters");if(r&&r.get(0).nodeName!=="FORM"){const d=r.get(0),_=d.querySelector("form");d.addEventListener("click",O=>{const y=O.target.closest("[data-value]");if(!y)return;const D=y.getAttribute("data-name"),P=y.getAttribute("data-value");_[D].value=P,t()})}else{for(const d in ajaxify.data.filters)ajaxify.data.filters.hasOwnProperty(d)&&r.find('[name="'+d+'"]').val(ajaxify.data.filters[d]);r.find('[name="sort"]').val(ajaxify.data.sort),document.getElementById("apply-filters").addEventListener("click",function(){t()}),r.find('button[data-target="#more-filters"]').click(d=>{const _=d.target.getAttribute("data-text-variant");_&&(d.target.setAttribute("data-text-variant",d.target.textContent),d.target.firstChild.textContent=_)})}}function t(){let r=s.get("flags/filters").get(0);if(!r)return;r.nodeName!=="FORM"&&(r=r.querySelector("form"));const d=new FormData(r);c.get("cids").forEach(function(y){d.append("cid",y)}),["assignee","targetUid","reporterId"].forEach(y=>{c.get(y).forEach(({uid:D})=>{d.append(y,D)})});const _=Array.from(d.values()).filter(Boolean),O=new URLSearchParams(d).toString();ajaxify.go("flags?"+(_?O:"reset=1"))}function i(){const r=document.querySelector('[component="flags/list"]'),d=r.querySelectorAll('[data-flag-id] input[type="checkbox"]'),_=document.querySelector('[component="flags/bulk-actions"] button');let O;document.querySelector('[data-action="toggle-all"]').addEventListener("click",function(){const y=this.checked;d.forEach(function(D){D.checked=y}),_.disabled=!y}),r.addEventListener("click",function(y){const D=y.target.closest('input[type="checkbox"]');if(D){if(y.stopImmediatePropagation(),O&&y.shiftKey&&O!==D){const P=D.checked;let M=!1;d.forEach(function(B){[D,O].some(function(I){return I===B})&&(M=!M),M&&(B.checked=P)})}_.disabled=!Array.prototype.some.call(d,function(P){return P.checked}),O=D}y.target.querySelector('input[type="checkbox"]')&&y.stopImmediatePropagation()})}function g(){document.querySelector('[component="flags/bulk-actions"]').addEventListener("click",function(r){const d=r.target.closest("[data-action]");if(d){const _=d.getAttribute("data-action"),y=A().map(D=>{const P={};return _==="bulk-assign"?P.assignee=app.user.uid:_==="bulk-mark-resolved"&&(P.state="resolved"),a.put(`/flags/${D}`,P)});Promise.allSettled(y).then(function(D){const P=D.filter(function(B){return B.status==="fulfilled"}).length,M=D.filter(function(B){return B.status==="rejected"});P&&(n.success("[[flags:bulk-success, "+P+"]]"),ajaxify.refresh()),M.forEach(function(B){n.error(B.reason)})})}})}function A(){const r=document.querySelectorAll('[component="flags/list"] [data-flag-id] input[type="checkbox"]'),d=[];return r.forEach(function(_){_.checked&&d.push(_.closest("[data-flag-id]").getAttribute("data-flag-id"))}),d}function b(){const r=document.getElementById("flags:daily"),d=utils.getDaysArray().map(function(O,y){return y%3?"":O});utils.isMobile()&&(f.t1.defaults.plugins.tooltip.enabled=!1);const _={"flags:daily":{labels:d,datasets:[{label:"",backgroundColor:"rgba(151,187,205,0.2)",borderColor:"rgba(151,187,205,1)",pointBackgroundColor:"rgba(151,187,205,1)",pointHoverBackgroundColor:"#fff",pointBorderColor:"#fff",pointHoverBorderColor:"rgba(151,187,205,1)",data:ajaxify.data.analytics}]}};r.width=$(r).parent().width(),new f.t1(r.getContext("2d"),{type:"line",data:_["flags:daily"],options:{responsive:!0,animation:!1,scales:{y:{beginAtZero:!0}}}})}},49897:(k,x,l)=>{l.r(x),l.d(x,{del:()=>u,get:()=>a,head:()=>n,patch:()=>o,post:()=>s,put:()=>c});var f=l(91749),p=l.n(f),v=l(40027),C=l.n(v);const E=config.relative_path+"/api/v3";async function m(e,t){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:E+e.url,typeof t=="function"){h(e).then(i=>t(null,i),i=>t(i));return}try{return await h(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again.")return(0,v.confirm)("[[error:api.reauth-required]]",g=>{g&&ajaxify.go("login")});throw i}}async function h(e){const{url:t}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,f.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(t,e),{headers:g}=i,A=g.get("content-type"),b=A&&A.startsWith("application/json");let r;if(e.method!=="head"&&(b?r=await i.json():r=await i.text()),!i.ok)throw r?new Error(b?r.status.message:r):new Error(i.statusText);return b&&r&&r.hasOwnProperty("status")&&r.hasOwnProperty("response")?r.response:r}function a(e,t,i){return m({url:e+(t&&Object.keys(t).length?"?"+$.param(t):"")},i)}function n(e,t,i){return m({url:e+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},i)}function s(e,t,i){return m({url:e,method:"post",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function o(e,t,i){return m({url:e,method:"patch",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function c(e,t,i){return m({url:e,method:"put",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}function u(e,t,i){return m({url:e,method:"delete",data:t,headers:{"x-csrf-token":config.csrf_token}},i)}},34405:(k,x,l)=>{var f,p;f=[l(49897),l(29930)],p=function(v,C){const E={},m={delay:200,appendTo:null};E.init=a=>{const n={...m,...a},{input:s,onSelect:o}=n;app.loadJQueryUI(function(){s.autocomplete({...n,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,u){h(s,o,c,u)}})})},E.user=function(a,n,s){typeof n=="function"&&(s=n,n={}),n=n||{},E.init({input:a,onSelect:s,source:(o,c)=>{n.query=o.term,v.get("/api/users",n,function(u,e){if(u)return C.error(u);if(e&&e.users){const t=e.users.map(function(i){const g=$("<div></div>").html(i.username).text();return i&&{label:g,value:g,user:{uid:i.uid,name:i.username,slug:i.userslug,username:i.username,userslug:i.userslug,picture:i.picture,banned:i.banned,"icon:text":i["icon:text"],"icon:bgColor":i["icon:bgColor"]}}});c(t)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},E.group=function(a,n){E.init({input:a,onSelect:n,source:(s,o)=>{socket.emit("groups.search",{query:s.term},function(c,u){if(c)return C.error(c);if(u&&u.length){const e=u.map(function(t){return t&&{label:t.name,value:t.name,group:t}});o(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},E.tag=function(a,n){E.init({input:a,onSelect:n,delay:100,source:(s,o)=>{socket.emit("topics.autocompleteTags",{query:s.term,cid:ajaxify.data.cid||0},function(c,u){if(c)return C.error(c);u&&o(u),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function h(a,n,s,o){n=n||function(){};const c=jQuery.Event("keypress");c.which=13,c.keyCode=13,setTimeout(function(){a.trigger(c)},100),n(s,o)}return E}.apply(x,f),p!==void 0&&(k.exports=p)},39259:(k,x,l)=>{var f,p;f=[l(96349),l(49897),l(91749)],p=function(v,C,E){const m={};m.init=function(a,n){if(!a||!a.length)return;n=n||{},n.states=n.states||["watching","tracking","notwatching","ignoring"],n.template=n.template||"partials/category/filter-dropdown-left",E.fire("action:category.filter.options",{el:a,options:n}),v.init(a,n);let s=[],o=[];Array.isArray(n.selectedCids)?s=n.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(s=ajaxify.data.selectedCids.map(String)),o=s.slice(),a.on("hidden.bs.dropdown",function(){let c=o.length!==s.length;if(o.forEach(function(u,e){u!==s[e]&&(c=!0)}),o=s.slice(),c&&(n.updateButton?n.updateButton({el:a,changed:c,selectedCids:s.slice()}):n.updateButton!==!1&&h(a,s)),n.onHidden){n.onHidden({changed:c,selectedCids:s.slice()});return}if(c){let u=window.location.pathname;const e=utils.params();s.length?e.cid=s:delete e.cid,delete e.page,Object.keys(e).length&&(u+="?"+decodeURIComponent($.param(e))),ajaxify.go(u)}}),a.on("click",'[component="category/list"] [data-cid]',function(){const c=a.find('[component="category/list"]'),u=$(this),e=u.find("a").attr("href");if(e&&e!=="#"&&e.length)return;const t=u.attr("data-cid"),i=u.find('[component="category/select/icon"]');return t!=="all"?(s.includes(t)?s.splice(s.indexOf(t),1):s.push(t),s.sort(function(g,A){return g-A}),i.toggleClass("invisible"),c.find('[data-cid="all"] i').toggleClass("invisible",!!s.length)):(a.find('[component="category/select/icon"]').addClass("invisible"),c.find('[data-cid="all"] i').removeClass("invisible"),s=[]),n.selectedCids=s,n.onSelect&&n.onSelect({cid:t,selectedCids:s.slice()}),!1})};function h(a,n){n.length>1?s({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?C.get(`/categories/${n[0]}`,{}).then(s):s();function s(o){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:o},function(c){a.find("button").replaceWith($("<div/>").html(c).find("button"))})}}return m}.apply(x,f),p!==void 0&&(k.exports=p)},96349:(k,x,l)=>{var f,p;f=[l(29930),l(89336),l(49897)],p=function(v,C,E){const m={};return m.init=function(h,a){let n=null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let s=[];Array.isArray(a.localCategories)&&(s=a.localCategories.map(t=>({...t}))),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const o=h.find('[component="category-selector-search"]');if(!o.length)return;const c=o.parent('[component="category/dropdown"]').length>0||o.parent('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){c&&(h.find(".dropdown-toggle").css({visibility:"hidden"}),o.removeClass("hidden"),o.css({"z-index":h.find(".dropdown-toggle").css("z-index")+1}));function t(){const i=o.find("input").val();i.length>1||!i&&!n?u(i,function(g){n=a.cacheList&&(n||g),e(g)}):!i&&n&&e(n)}o.on("click",function(i){i.preventDefault(),i.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(t,300)),t()}),h.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),h.on("hide.bs.dropdown",function(){c&&(h.find(".dropdown-toggle").css({visibility:"inherit"}),o.addClass("hidden")),o.off("click"),o.find("input").off("keyup")});function u(t,i){E.get("/search/categories",{search:t,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(g,{categories:A}){if(g)return v.error(g);i(s.concat(A))})}function e(t){const i=a.selectedCids.map(String);t.forEach(function(g){g.selected=i.includes(String(g.cid))}),app.parseAndTranslate(a.template,{categoryItems:t.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(g){h.find('[component="category/list"]').html(g.find('[component="category/list"]').html()),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!t.length);const A=C.Dropdown.getInstance(h.find(".dropdown-toggle").get(0));A&&A.update()})}},m}.apply(x,f),p!==void 0&&(k.exports=p)},13230:(k,x,l)=>{var f,p,v;(function(C){p=[l(53050)],f=C,v=typeof f=="function"?f.apply(x,p):f,v!==void 0&&(k.exports=v)})(function(C){const E=C("[^\\p{L}\\s\\d\\-_]","g"),m=/[^\w\s\d\-_]/g,h=/^\s+|\s+$/g,a=/\s+/g,n=/-+/g,s=/-$/g,o=/^-/g,c=/^[\w\d\s.,\-@]+$/;return function(e,t){return e?(e=String(e).replace(h,""),c.test(e)?e=e.replace(m,"-"):e=C.replace(e,E,"-"),e=t?e:e.toLocaleLowerCase(),e=e.replace(a,"-"),e=e.replace(n,"-"),e=e.replace(s,""),e=e.replace(o,""),e):""}})},64308:(k,x,l)=>{var f,p;f=[l(49897),l(91749),l(13230),l(81335)],p=function(v,C,E,m){const h={};return h.init=function(a,n){if(!a||!a.length)return;n=n||{};let s,o=[];n.selectedUsers&&(o=n.selectedUsers.map(t=>({...t}))),C.fire("action:user.filter.options",{el:a,options:n});async function c(){const t=n.selectedBlock||"userFilterSelected",i={};if(t.indexOf(".")!==-1){const A=t.split(".");i[A[0]]={},i[A[0]][A[1]]=o}else i[t]=o;const g=await app.parseAndTranslate(n.template,t,i);a.find('[component="user/filter/selected"]').html(g)}async function u(){await c(),n.onSelect&&n.onSelect(o)}async function e(){let t={users:[]};const i=a.find('[component="user/filter/search"]').val();if(i&&i.length>1)if(app.user.privileges["search:users"])t=await v.get("/api/users",{query:i});else try{const b=await v.get(`/api/user/${E(i)}`);t.users.push(b)}catch{}if(!t.users.length){a.find('[component="user/filter/results"]').translateHtml("[[users:no-users-found]]");return}t.users=t.users.slice(0,20);const g={};t.users.forEach(b=>{g[b.uid]=b});const A=await app.parseAndTranslate(n.template,"userFilterResults",{userFilterResults:t.users});a.find('[component="user/filter/results"]').html(A),a.find('[component="user/filter/results"] [data-uid]').on("click",async function(){const b=parseInt($(this).attr("data-uid"),10);o.find(r=>r.uid===b)||(o.push(g[b]),await u())})}a.find('[component="user/filter/search"]').on("keyup",()=>{a.find('[component="user/filter/results"]').html(s)}),a.find('[component="user/filter/search"]').on("keyup",utils.debounce(function(){app.user.privileges["search:users"]&&e()},1e3)),a.on("click",'[component="user/filter/delete"]',async function(){const t=$(this).attr("data-uid");o=o.filter(i=>parseInt(i.uid,10)!==parseInt(t,10)),await u()}),a.find('[component="user/filter/search"]').on("keyup",t=>{t.key==="Enter"&&!app.user.privileges["search:users"]&&e()}),a.on("shown.bs.dropdown",function(){a.find('[component="user/filter/search"]').trigger("focus")}),a.on("hidden.bs.dropdown",function(){n.onHidden&&n.onHidden(o)}),m.render(n.placeholderTemplate||"partials/userFilter-placeholders").then(t=>{s=t})},h}.apply(x,f),p!==void 0&&(k.exports=p)}}]);
