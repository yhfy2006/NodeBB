(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4884,99127,5719,42289,43400,34271,1091,97082,16852,49897],{67910:(y,b,s)=>{"use strict";var v,h;v=[s(36684),s(72254),s(52473),s(17459),s(47283),s(28061),s(7524),s(49897),s(40027),s(29930)],h=function(p,i,c,a,r,e,g,n,d,l){const o={};let t;o.init=function(){t=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,u(),f(),t&&A(),c.get("account/follow").on("click",()=>x("follow")),c.get("account/unfollow").on("click",()=>x("unfollow")),c.get("account/chat").on("click",async function(){const{roomId:m}=await n.get(`/users/${ajaxify.data.uid}/chat`),C=await app.require("chat");m?C.openChat(m):C.newChat(ajaxify.data.uid)}),c.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){c.get("account/chat").parent().removeClass("hidden")})}),c.get("account/ban").on("click",()=>e.banAccount(ajaxify.data.theirid)),c.get("account/mute").on("click",()=>e.muteAccount(ajaxify.data.theirid)),c.get("account/unban").on("click",()=>e.unbanAccount(ajaxify.data.theirid)),c.get("account/unmute").on("click",()=>e.unmuteAccount(ajaxify.data.theirid)),c.get("account/delete-account").on("click",()=>r.account(ajaxify.data.theirid)),c.get("account/delete-content").on("click",()=>r.content(ajaxify.data.theirid)),c.get("account/delete-all").on("click",()=>r.purge(ajaxify.data.theirid)),c.get("account/flag").on("click",E),c.get("account/block").on("click",D),c.get("account/unblock").on("click",D)};function u(){$(".account-sub-links li a").removeClass("active").each(function(){const m=$(this).attr("href");if(decodeURIComponent(m)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function f(){$('[component="profile/change/picture"]').on("click",function(){return g.openChangeModal(),!1})}function A(){p.init(c.get("account/cover"),function(m,C,w){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:m,position:C},w)},function(){i.show({title:"[[user:upload-cover-picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(m){m=(m.startsWith("http")?"":config.relative_path)+m+"?"+Date.now(),c.get("account/cover").css("background-image","url("+m+")")})},k)}function x(m){return n[m==="follow"?"put":"del"]("/users/"+ajaxify.data.uid+"/follow",void 0,function(C){if(C)return l.error(C);c.get("account/follow").toggleClass("hide",m==="follow"),c.get("account/unfollow").toggleClass("hide",m==="unfollow"),l.success("[[global:alert."+m+", "+ajaxify.data.username+"]]")}),!1}function E(){s.e(6574).then(function(){var m=[s(6574)];(function(C){C.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,m)}).catch(s.oe)}function D(){return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid},function(m,C){if(m)return l.error(m);c.get("account/block").toggleClass("hidden",C),c.get("account/unblock").toggleClass("hidden",!C)}),!1}function k(){a.translate("[[user:remove-cover-picture-confirm]]",function(m){d.confirm(m,function(C){C&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(w){w?l.error(w):ajaxify.refresh()})})})}return o}.apply(b,v),h!==void 0&&(y.exports=h)},47283:(y,b,s)=>{"use strict";var v,h;v=[s(49897),s(40027),s(29930)],h=function(p,i,c){const a={};a.account=function(e,g){r(e,"[[user:delete-this-account-confirm]]","/account","[[user:account-deleted]]",g)},a.content=function(e,g){r(e,"[[user:delete-account-content-confirm]]","/content","[[user:account-content-deleted]]",g)},a.purge=function(e,g){r(e,"[[user:delete-all-confirm]]","","[[user:account-deleted]]",g)};function r(e,g,n,d,l){i.confirm(g,function(o){o&&p.del(`/users/${e}${n}`,{}).then(()=>{if(c.success(d),typeof l=="function")return l()}).catch(c.error)})}return a}.apply(b,v),h!==void 0&&(y.exports=h)},28061:(y,b,s)=>{"use strict";var v,h;v=[s(81335),s(49897),s(40027),s(29930)],h=function(p,i,c,a){const r={};return r.banAccount=function(e,g){e=e||ajaxify.data.theirid,p.render("modals/temporary-ban",{}).then(function(n){c.dialog({className:"ban-modal",title:"[[user:ban-account]]",message:n,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban-account]]",callback:function(){const d=$(".ban-modal form").serializeArray().reduce(function(o,t){return o[t.name]=t.value,o},{}),l=d.length>0?Date.now()+d.length*1e3*60*60*(parseInt(d.unit,10)?24:1):0;i.put("/users/"+e+"/ban",{until:l,reason:d.reason||""}).then(()=>{if(typeof g=="function")return g();ajaxify.refresh()}).catch(a.error)}}}})})},r.unbanAccount=function(e){i.del("/users/"+e+"/ban").then(()=>{ajaxify.refresh()}).catch(a.error)},r.muteAccount=function(e,g){e=e||ajaxify.data.theirid,p.render("modals/temporary-mute",{}).then(function(n){c.dialog({className:"mute-modal",title:"[[user:mute-account]]",message:n,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute-account]]",callback:function(){const d=$(".mute-modal form").serializeArray().reduce(function(o,t){return o[t.name]=t.value,o},{}),l=d.length>0?Date.now()+d.length*1e3*60*60*(parseInt(d.unit,10)?24:1):0;i.put("/users/"+e+"/mute",{until:l,reason:d.reason||""}).then(()=>{if(typeof g=="function")return g();ajaxify.refresh()}).catch(a.error)}}}})})},r.unmuteAccount=function(e){i.del("/users/"+e+"/mute").then(()=>{ajaxify.refresh()}).catch(a.error)},r}.apply(b,v),h!==void 0&&(y.exports=h)},7524:(y,b,s)=>{"use strict";var v,h;v=[s(72254),s(49897),s(40027),s(29930)],h=((p,i,c,a)=>{const r={};r.openChangeModal=()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(n,d){if(n)return a.error(n);const l=d.reduce(function(o,t){return o||t.type==="uploaded"},!1);app.parseAndTranslate("modals/change-picture",{pictures:d,uploaded:l,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:config.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},function(o){const t=c.dialog({className:"picture-switcher",title:"[[user:change-picture]]",message:o,show:!0,size:"large",buttons:{close:{label:"[[global:close]]",callback:A,className:"btn-link"},update:{label:"[[global:save-changes]]",callback:f}}});t.on("shown.bs.modal",u),t.on("click",".list-group-item",function(){t.find(".list-group-item").removeClass("active"),$(this).addClass("active")}),t.on("change",'input[type="radio"][name="icon:bgColor"]',x=>{const E=x.target.value;t.find('[component="avatar/icon"]').css("background-color",E)}),e(t);function u(){ajaxify.data.picture?t.find(".list-group-item img").each(function(){this.getAttribute("src")===ajaxify.data.picture&&$(this).parents(".list-group-item").addClass("active")}):t.find('[data-type="default"]').addClass("active");const x=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);x?x.checked=!0:document.querySelector('.modal input[type="radio"]').checked=!0}function f(){const x=t.find(".list-group-item.active").attr("data-type"),E=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";g(x,E).then(()=>{r.updateHeader(x==="default"?"":t.find(".list-group-item.active img").attr("src"),E),ajaxify.refresh()}).catch(a.error)}function A(){t.modal("hide")}})})},r.updateHeader=(n,d)=>{if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10))return;!n&&ajaxify.data.defaultAvatar&&(n=ajaxify.data.defaultAvatar);const l=$('[component="header/avatar"] [component="avatar/picture"]'),o=$('[component="header/avatar"] [component="avatar/icon"]');if(n){if(!l.length&&o.length){const t=$("<img/>");$(o[0].attributes).each(function(){t.attr(this.nodeName,this.nodeValue)}),t.attr("component","avatar/picture").attr("src",n).insertBefore(o)}}else l.remove();d&&o.css({"background-color":d})};function e(n){function d(o){o=(o.startsWith("http")?"":config.relative_path)+o+"?"+Date.now(),r.updateHeader(o),ajaxify.data.picture&&ajaxify.data.picture.length?($("#user-current-picture, img.avatar").attr("src",o),ajaxify.data.uploadedpicture=o):ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",o)})}function l(){ajaxify.data.uploadedpicture===ajaxify.data.picture&&(ajaxify.refresh(),r.updateHeader())}n.find('[data-action="upload"]').on("click",function(){return n.modal("hide"),p.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:!1,title:"[[user:upload-picture]]",description:"[[user:upload-a-picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(o){d(o)}),!1}),n.find('[data-action="upload-url"]').on("click",function(){return n.modal("hide"),app.parseAndTranslate("modals/upload-picture-from-url",{},function(o){o.modal("show"),o.find(".upload-btn").on("click",function(){const t=o.find("#uploadFromUrl").val();return t&&(o.modal("hide"),p.handleImageCrop({url:t,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:!1,paramName:"uid",paramValue:ajaxify.data.theirid},d)),!1})}),!1}),n.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(o){if(n.modal("hide"),o)return a.error(o);l()})})}function g(n,d){return i.put(`/users/${ajaxify.data.theirid}/picture`,{type:n,bgColor:d})}return r}).apply(b,v),h!==void 0&&(y.exports=h)},49897:(y,b,s)=>{"use strict";s.r(b),s.d(b,{del:()=>o,get:()=>e,head:()=>g,patch:()=>d,post:()=>n,put:()=>l});var v=s(91749),h=s.n(v),p=s(40027),i=s.n(p);const c=config.relative_path+"/api/v3";async function a(t,u){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:c+t.url,typeof u=="function"){r(t).then(f=>u(null,f),f=>u(f));return}try{return await r(t)}catch(f){if(f.message==="A valid login session was not found. Please log in and try again.")return(0,p.confirm)("[[error:api.reauth-required]]",A=>{A&&ajaxify.go("login")});throw f}}async function r(t){const{url:u}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,v.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const f=await fetch(u,t),{headers:A}=f,x=A.get("content-type"),E=x&&x.startsWith("application/json");let D;if(t.method!=="head"&&(E?D=await f.json():D=await f.text()),!f.ok)throw D?new Error(E?D.status.message:D):new Error(f.statusText);return E&&D&&D.hasOwnProperty("status")&&D.hasOwnProperty("response")?D.response:D}function e(t,u,f){return a({url:t+(u&&Object.keys(u).length?"?"+$.param(u):"")},f)}function g(t,u,f){return a({url:t+(u&&Object.keys(u).length?"?"+$.param(u):""),method:"head"},f)}function n(t,u,f){return a({url:t,method:"post",data:u,headers:{"x-csrf-token":config.csrf_token}},f)}function d(t,u,f){return a({url:t,method:"patch",data:u,headers:{"x-csrf-token":config.csrf_token}},f)}function l(t,u,f){return a({url:t,method:"put",data:u,headers:{"x-csrf-token":config.csrf_token}},f)}function o(t,u,f){return a({url:t,method:"delete",data:u,headers:{"x-csrf-token":config.csrf_token}},f)}},36684:(y,b,s)=>{"use strict";var v,h;v=[s(29930),s(18675)],h=function(p){const i={coverEl:null,saveFn:null};i.init=function(a,r,e,g){i.coverEl=a,i.saveFn=r,a.find(".upload").on("click",e),a.find(".resize").on("click",function(){c(a)}),a.find(".remove").on("click",g),a.on("dragover",i.onDragOver).on("drop",i.onDrop),a.find(".save").on("click",i.save),a.addClass("initialised")},i.onDragOver=function(a){a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy"},i.onDrop=function(a){a.stopPropagation(),a.preventDefault();const r=a.originalEvent.dataTransfer.files,e=new FileReader;r.length&&r[0].type.match("image.*")&&(e.onload=function(g){i.coverEl.css("background-image","url("+g.target.result+")"),i.newCover=g.target.result},e.readAsDataURL(r[0]),c(i.coverEl))};function c(a){a.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),p.alert({alert_id:"drag_start",title:"[[modules:cover.dragging-title]]",message:"[[modules:cover.dragging-message]]",timeout:5e3})}return i.save=function(){i.coverEl.addClass("saving"),i.saveFn(i.newCover||void 0,i.coverEl.css("background-position"),function(a){a?p.error(a):(i.coverEl.toggleClass("active",0),i.coverEl.backgroundDraggable("disable"),i.coverEl.off("dragover",i.onDragOver),i.coverEl.off("drop",i.onDrop),p.success("[[modules:cover.saved]]")),i.coverEl.removeClass("saving")})},i}.apply(b,v),h!==void 0&&(y.exports=h)},72254:(y,b,s)=>{"use strict";var v,h;v=[s(29930)],h=function(p){const i={};i.show=function(e,g){const n=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:n,title:e.title||"[[global:upload-file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(d){d.modal("show"),d.on("hidden.bs.modal",function(){d.remove()});const l=d.find("#uploadForm");e.route&&l.attr("action",e.route),d.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),e.uploadModal=d,r(e,g),!1})})},i.handleImageCrop=function(e,g){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(e.url)},async function(n){n.modal({backdrop:"static"}).modal("show");const d=parseInt($(window).height()/2,10),l=document.getElementById("cropped-image");$(l).css("max-height",d);const o=(await s.e(60239).then(s.t.bind(s,65643,23))).default;let t=new o(l,{aspectRatio:e.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){e.restrictImageDimension&&(t.cropBoxData.width>e.imageDimension&&t.setCropBoxData({width:e.imageDimension}),t.cropBoxData.height>e.imageDimension&&t.setCropBoxData({height:e.imageDimension}))},ready:function(){if(!a(t,e))return n.modal("hide");if(e.restrictImageDimension){const u=l.width<l.height?l.width:l.height,f=u>e.imageDimension?e.imageDimension:u;t.setCropBoxData({width:f,height:f})}n.find(".rotate").on("click",function(){const u=this.getAttribute("data-degrees");t.rotate(u)}),n.find(".flip").on("click",function(){const u=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?t.scaleX(u):t.scaleY(u),this.setAttribute("data-option",u*-1)}),n.find(".reset").on("click",function(){t.reset()}),n.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const u=a(t,e);u&&(n.find("#upload-progress-bar").css("width","0%"),n.find("#upload-progress-box").show().removeClass("hide"),c({data:e,imageData:u,progressBarEl:n.find("#upload-progress-bar")},function(f,A){if(f)return n.find("#upload-progress-box").hide(),n.find(".upload-btn").removeClass("disabled"),n.find(".crop-btn").removeClass("disabled"),p.error(f);g(A.url),n.modal("hide")}))}),n.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),t.destroy();const u=(await s.e(60239).then(s.t.bind(s,65643,23))).default;t=new u(l,{viewMode:1,autoCropArea:1,ready:function(){n.find(".crop-btn").trigger("click")}})})}})})};function c(e,g){const n={};n[e.data.paramName]=e.data.paramValue,n.method=e.data.socketMethod,n.size=e.imageData.length,n.progress=0;const d=1e5;function l(){const o=e.imageData.slice(n.progress,n.progress+d);socket.emit("uploads.upload",{chunk:o,params:n},function(t,u){if(t)return p.error(t);if(n.progress+d<n.size)return n.progress+=o.length,e.progressBarEl.css("width",(n.progress/n.size*100).toFixed(2)+"%"),setTimeout(l,100);e.progressBarEl.css("width","100%"),g(null,u)})}l()}function a(e,g){let n;try{n=g.imageType?e.getCroppedCanvas().toDataURL(g.imageType):e.getCroppedCanvas().toDataURL()}catch(d){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(d.message)!==-1?p.error("[[error:cors-error]]"):p.error(d.message);return}return n}function r(e,g){function n(u,f){u==="error"&&e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),e.uploadModal.find("#alert-"+u).translateText(f).removeClass("hide")}const d=e.uploadModal.find("#fileInput");if(!d.val())return n("error","[[uploads:select-file-to-upload]]");const l=d[0].files[0],o=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;if(o&&l.size>o*1024)return n("error","[[error:file-too-big, "+o+"]]");if(l.name.endsWith(".gif")){s.e(98463).then(function(){var u=[s(24187)];(function(f){f.ajaxSubmit(e.uploadModal,g)}).apply(null,u)}).catch(s.oe);return}const t=new FileReader;t.addEventListener("load",function(){const u=t.result;e.uploadModal.modal("hide"),i.handleImageCrop({url:u,imageType:l.type,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},g)},!1),l&&t.readAsDataURL(l)}return i}.apply(b,v),h!==void 0&&(y.exports=h)},18675:()=>{(function(y){var b=y(window),s=function(i,c,a,r){if(arguments.length===3||r){if(a<i)return i;if(a>c)return c}return a},v=function(i){i.clientX=i.originalEvent.touches[0].clientX,i.clientY=i.originalEvent.touches[0].clientY},h=function(i){var c=(i.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(c){var a={width:0,height:0},r=new Image;return r.onload=function(){if(i.css("background-size")=="cover"){var e=i.innerWidth(),g=i.innerHeight(),n=e/g;imageAspectRatio=r.width/r.height,scale=1,imageAspectRatio>=n?scale=g/r.height:scale=e/r.width,a.width=r.width*scale,a.height=r.height*scale}else a.width=r.width,a.height=r.height},r.src=c,a}};function p(i,c){this.element=i,this.options=c,this.init()}p.prototype.init=function(){var i=y(this.element),c=(i.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],a=this.options;if(c){var r={width:0,height:0};(a.bound||a.units=="percent")&&(r=h(i)),i.on("mousedown.dbg touchstart.dbg",function(e){if(e.target===i[0]){if(e.preventDefault(),e.originalEvent.touches)v(e);else if(e.which!==1)return;var g=e.clientX,n=e.clientY,d=i.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],l=parseInt(d[1])||0,o=parseInt(d[2])||0;a.units=="percent"&&(l=Math.round(l/-200*r.width),o=Math.round(o/-200*r.height)),b.on("mousemove.dbg touchmove.dbg",function(t){t.preventDefault(),t.originalEvent.touches&&v(t);var u=t.clientX,f=t.clientY;a.units=="percent"?(l=a.axis==="y"?l:s(-r.width/2,0,l+u-g,a.bound),o=a.axis==="x"?o:s(-r.height/2,0,o+f-n,a.bound),i.css("background-position",l/r.width*-200+"% "+o/r.height*-200+"%")):(l=a.axis==="y"?l:s(i.innerWidth()-r.width,0,l+u-g,a.bound),o=a.axis==="x"?o:s(i.innerHeight()-r.height,0,o+f-n,a.bound),i.css("background-position",l+"px "+o+"px")),g=u,n=f}),b.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){a.done&&a.done(),b.off("mousemove.dbg touchmove.dbg"),b.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},p.prototype.disable=function(){var i=y(this.element);i.off("mousedown.dbg touchstart.dbg"),b.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},y.fn.backgroundDraggable=function(c){var c=c,a=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=y(this);if(typeof c>"u"||typeof c=="object"){c=y.extend({},y.fn.backgroundDraggable.defaults,c);var e=new p(this,c);r.data("dbg",e)}else if(typeof c=="string"&&r.data("dbg")){var e=r.data("dbg");p.prototype[c].apply(e,a)}})},y.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)}}]);
