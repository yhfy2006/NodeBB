"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[13201,99127,34271,1091,49897],{11599:(C,g,s)=>{var d,m;d=[s(52473),s(91749),s(49897)],m=function(u,w,v){const h={};h.prepareDOM=function(){const o=$('[component="chat/dropdown"]');o.length&&(o.on("show.bs.dropdown",r=>{i("loadChatsDropdown",$(r.target).parent().find('[component="chat/list"]'))}),o.each((r,a)=>{const t=$(a).parent().find(".dropdown-menu");t.hasClass("show")&&i("loadChatsDropdown",t.find('[component="chat/list"]'))}),socket.removeListener("event:chats.receive",f),socket.on("event:chats.receive",f),socket.removeListener("event:chats.typing",p),socket.on("event:chats.typing",p),socket.removeListener("event:chats.roomRename",E),socket.on("event:chats.roomRename",E),socket.on("event:unread.updateChatCount",async function(r){if(r){const[e,l]=await app.require(["chat","forum/chats"]);if(e.isFromBlockedUser(r.fromUid)||e.isLookingAtRoom(r.roomId)||app.user.uid===parseInt(r.fromUid,10))return;l.markChatPageElUnread(r)}let{count:a}=await v.get("/chats/unread");const t=u.get("chat/icon");a=Math.max(0,a),t.toggleClass("fa-comment",a>0).toggleClass("fa-comment-o",a<=0);const n=a>99?"99+":a;u.get("chat/icon").toggleClass("unread-count",a>0).attr("data-content",n),u.get("chat/count").toggleClass("hidden",a<=0).text(n),w.fire("action:chat.updateCount",{count:a})}))};function f(o){i("onChatMessageReceived",o)}function p(o){i("onUserTyping",o)}function E(o){i("onRoomRename",o)}async function i(o,r){(await app.require("chat"))[o](r)}return h}.apply(g,d),m!==void 0&&(C.exports=m)},49897:(C,g,s)=>{s.r(g),s.d(g,{del:()=>a,get:()=>p,head:()=>E,patch:()=>o,post:()=>i,put:()=>r});var d=s(91749),m=s.n(d),u=s(40027),w=s.n(u);const v=config.relative_path+"/api/v3";async function h(t,n){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:v+t.url,typeof n=="function"){f(t).then(e=>n(null,e),e=>n(e));return}try{return await f(t)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,u.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go("login")});throw e}}async function f(t){const{url:n}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,d.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const e=await fetch(n,t),{headers:l}=e,k=l.get("content-type"),y=k&&k.startsWith("application/json");let c;if(t.method!=="head"&&(y?c=await e.json():c=await e.text()),!e.ok)throw c?new Error(y?c.status.message:c):new Error(e.statusText);return y&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function p(t,n,e){return h({url:t+(n&&Object.keys(n).length?"?"+$.param(n):"")},e)}function E(t,n,e){return h({url:t+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},e)}function i(t,n,e){return h({url:t,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function o(t,n,e){return h({url:t,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function r(t,n,e){return h({url:t,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}function a(t,n,e){return h({url:t,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},e)}}}]);
