"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[27509,99127,34271,13417,1091,49897,63,34405],{63:(_,x,f)=>{var y,E;y=[f(29930),f(34405),f(49897),f(81335)],E=function(T,A,l,h){const m={};let o,a,i,s;m.init=function(n,t,r){o||(i=n,s=t||[],app.parseAndTranslate("modals/tag-topic",{topics:i,tagWhitelist:s},function(p){o=p,a=o.find("#tag-topic-commit"),$("body").append(o),o.find("#tag-topic-cancel").on("click",e),a.on("click",async()=>{await u(),r&&r()}),o.find(".tags").each((d,g)=>{const v=$(g),O=v.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),P=O[0].$input;i[d].tags.forEach(D=>v.tagsinput("add",D.value)),v.on("itemAdded",function(D){s.length&&!s.includes(D.item)&&(v.tagsinput("remove",D.item),T.error("[[error:tag-not-allowed]]")),P.length&&P.autocomplete("close")}),c({input:P,container:O[0].$container})})}))};function c(n){A.init({input:n.input,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:n.container,source:async(t,r)=>{socket.emit("topics.autocompleteTags",{query:t.term},function(p,d){if(p)return T.error(p);d&&r(d)})}})}async function u(){await Promise.all(o.find(".tags").map(async(n,t)=>{const r=i[n],p=$(t);r.tags=await l.put(`/topics/${r.tid}/tags`,{tags:p.tagsinput("items")}),m.updateTopicTags([r])})),e()}m.updateTopicTags=function(n){n.forEach(t=>{const r=ajaxify.data.template.topic?"partials/topic/tags":"partials/category/tags";h.render(r,{tags:t.tags}).then(function(p){const d=$(`[data-tid="${t.tid}"][component="topic/tags"]`);d.fadeOut(250,function(){d.toggleClass("hidden",t.tags.length===0),d.html(p).fadeIn(250)})})})};function e(){o&&(o.remove(),o=null)}return m}.apply(x,y),E!==void 0&&(_.exports=E)},49897:(_,x,f)=>{f.r(x),f.d(x,{del:()=>u,get:()=>o,head:()=>a,patch:()=>s,post:()=>i,put:()=>c});var y=f(91749),E=f.n(y),T=f(40027),A=f.n(T);const l=config.relative_path+"/api/v3";async function h(e,n){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:l+e.url,typeof n=="function"){m(e).then(t=>n(null,t),t=>n(t));return}try{return await m(e)}catch(t){if(t.message==="A valid login session was not found. Please log in and try again.")return(0,T.confirm)("[[error:api.reauth-required]]",r=>{r&&ajaxify.go("login")});throw t}}async function m(e){const{url:n}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,y.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const t=await fetch(n,e),{headers:r}=t,p=r.get("content-type"),d=p&&p.startsWith("application/json");let g;if(e.method!=="head"&&(d?g=await t.json():g=await t.text()),!t.ok)throw g?new Error(d?g.status.message:g):new Error(t.statusText);return d&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function o(e,n,t){return h({url:e+(n&&Object.keys(n).length?"?"+$.param(n):"")},t)}function a(e,n,t){return h({url:e+(n&&Object.keys(n).length?"?"+$.param(n):""),method:"head"},t)}function i(e,n,t){return h({url:e,method:"post",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function s(e,n,t){return h({url:e,method:"patch",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function c(e,n,t){return h({url:e,method:"put",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}function u(e,n,t){return h({url:e,method:"delete",data:n,headers:{"x-csrf-token":config.csrf_token}},t)}},34405:(_,x,f)=>{var y,E;y=[f(49897),f(29930)],E=function(T,A){const l={},h={delay:200,appendTo:null};l.init=o=>{const a={...h,...o},{input:i,onSelect:s}=a;app.loadJQueryUI(function(){i.autocomplete({...a,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,u){m(i,s,c,u)}})})},l.user=function(o,a,i){typeof a=="function"&&(i=a,a={}),a=a||{},l.init({input:o,onSelect:i,source:(s,c)=>{a.query=s.term,T.get("/api/users",a,function(u,e){if(u)return A.error(u);if(e&&e.users){const n=e.users.map(function(t){const r=$("<div></div>").html(t.username).text();return t&&{label:r,value:r,user:{uid:t.uid,name:t.username,slug:t.userslug,username:t.username,userslug:t.userslug,picture:t.picture,banned:t.banned,"icon:text":t["icon:text"],"icon:bgColor":t["icon:bgColor"]}}});c(n)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},l.group=function(o,a){l.init({input:o,onSelect:a,source:(i,s)=>{socket.emit("groups.search",{query:i.term},function(c,u){if(c)return A.error(c);if(u&&u.length){const e=u.map(function(n){return n&&{label:n.name,value:n.name,group:n}});s(e)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},l.tag=function(o,a){l.init({input:o,onSelect:a,delay:100,source:(i,s)=>{socket.emit("topics.autocompleteTags",{query:i.term,cid:ajaxify.data.cid||0},function(c,u){if(c)return A.error(c);u&&s(u),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function m(o,a,i,s){a=a||function(){};const c=jQuery.Event("keypress");c.which=13,c.keyCode=13,setTimeout(function(){o.trigger(c)},100),a(i,s)}return l}.apply(x,y),E!==void 0&&(_.exports=E)}}]);
