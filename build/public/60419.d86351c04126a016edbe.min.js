(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[60419,61861,22765,87212],{60419:(A,k,h)=>{"use strict";var m,c;m=[h(52473),h(91749),h(40027),h(29930),h(10870),h(49897),h(2269),h(47943)],c=function(a,o,r,f,y,I,C,E){const i={};i.sendMessage=async function(e,t){let d=t.val();if(!d.trim().length)return;const p=t.parents(`[component="chat/messages"][data-roomid="${e}"]`);t.val("").trigger("input");const g=t.parents('[component="chat/composer"]');i.updateRemainingLength(g),i.updateTextAreaHeight(p);const u={roomId:e,message:d};({roomId:e,message:d}=await o.fire("filter:chat.send",u));const w=g.find('[component="chat/composer/replying-to"]'),L=w.attr("data-tomid");I.post(`/chats/${e}`,{message:d,toMid:L}).then(()=>{o.fire("action:chat.sent",{roomId:e,message:d}),w.addClass("hidden"),w.attr("data-tomid","")}).catch(b=>{if(t.val(d).trigger("input"),i.updateRemainingLength(g),i.updateTextAreaHeight(p),b.message==="[[error:email-not-confirmed-chat]]")return y.showEmailConfirmWarning(b.message);f.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:b.message,type:"danger",timeout:1e4})})},i.updateRemainingLength=function(e){const t=e.find('[component="chat/input"]');e.find('[component="chat/message/length"]').text(t.val().length),e.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-t.val().length),o.fire("action:chat.updateRemainingLength",{parent:e})},i.updateTextAreaHeight=function(e){const t=e.find('[component="chat/input"]');t.css({height:i.calcAutoTextAreaHeight(t)+"px"})},i.calcAutoTextAreaHeight=function(e){const t=e.prop("scrollHeight"),d=parseFloat(e.css("border-top-width"),10)||0,p=parseFloat(e.css("border-bottom-width"),10)||0;return t+d+p};function n(e){e.css({height:i.calcAutoTextAreaHeight(e)+"px"}),e.on("input",function(){e.css({height:0}),e.css({height:i.calcAutoTextAreaHeight(e)+"px"})})}i.appendChatMessage=function(e,t){const d=e.find(".chat-message").last(),p=parseInt(d.attr("data-uid"),10),g=parseInt(d.attr("data-timestamp"),10);Array.isArray(t)||(t.newSet=t.toMid||p!==parseInt(t.fromuid,10)||parseInt(t.timestamp,10)>parseInt(g,10)+1e3*60*3,t.index=parseInt(d.attr("data-index"),10)+1),i.parseMessage(t,function(u){s(e,u,t)})};function s(e,t,d){const p=$(t),g=i.isAtBottom(e);if(p.addClass("new"),p.appendTo(e),i.onMessagesAddedToDom(p),g||d.self){i.scrollToBottomAfterImageLoad(e);const u=e.find("[data-mid]");if(u.length>150){const w=u.length-150;u.slice(0,w).remove(),e.find("[data-mid].new").removeClass("new")}}o.fire("action:chat.received",{messageEl:p})}i.onMessagesAddedToDom=function(e){e.find(".timeago").timeago(),e.find("img:not(.not-responsive)").addClass("img-fluid"),e.find("img:not(.emoji)").each(function(){C.wrapImageInLink($(this))}),o.fire("action:chat.onMessagesAddedToDom",{messageEls:e})},i.parseMessage=function(e,t){const d={messages:e,isAdminOrGlobalMod:app.user.isAdmin||app.user.isGlobalMod};Array.isArray(e)?app.parseAndTranslate("partials/chats/messages",d).then(t):app.parseAndTranslate("partials/chats/"+(e.system?"system-message":"message"),d).then(t)},i.isAtBottom=function(e,t){if(e.length)return e[0].scrollHeight-(e.outerHeight()+e.scrollTop())<(t||100)},i.scrollToBottomAfterImageLoad=function(e){if(e&&e.length){const t=e[0].querySelectorAll('[component="chat/message/body"]');E(t,()=>{i.scrollToBottom(e)})}},i.scrollToBottom=function(e){e&&e.length&&(e.attr("data-ignore-next-scroll",1),e.scrollTop(e[0].scrollHeight-e.height()),e.parents('[component="chat/message/window"]').find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},i.wrapImagesInLinks=function(e){e.find('[component="chat/message/body"] img:not(.emoji)').each(function(){C.wrapImageInLink($(this))})},i.toggleScrollUpAlert=function(e){const t=i.isAtBottom(e,300);e.parents('[component="chat/message/window"]').find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",t)},i.prepReplyTo=async function(e,t){const d=t.find('[component="chat/message/content"]'),p=t.find('[component="chat/composer"]'),g=e.attr("data-mid"),u=p.find('[component="chat/composer/replying-to"]');u.attr("data-tomid",g).find('[component="chat/composer/replying-to-text"]').translateText(`[[modules:chat.replying-to, ${e.attr("data-username")}]]`),u.removeClass("hidden"),u.find('[component="chat/composer/replying-to-cancel"]').off("click").on("click",()=>{u.attr("data-tomid",""),u.addClass("hidden")}),d.length&&i.isAtBottom(d)&&i.scrollToBottom(d),p.find('[component="chat/input"]').trigger("focus")},i.prepEdit=async function(e,t,d){const{content:p}=await I.get(`/chats/${d}/messages/${t}/raw`),g=await app.parseAndTranslate("partials/chats/edit-message",{rawContent:p}),u=e.find('[component="chat/message/body"]'),w=e.find('[component="chat/message/controls"]'),L=u.parents('[component="chat/message/content"]'),b=i.isAtBottom(L);u.addClass("hidden"),w.addClass("hidden"),g.insertAfter(u);const T=g.find("textarea");T.focus().putCursorAtEnd(),n(T),L.length&&b&&i.scrollToBottom(L);const S=(await app.require("forum/chats")).createAutoComplete(0,T,{placement:"bottom"});function M(){u.removeClass("hidden"),w.removeClass("hidden"),g.remove(),S&&S.destroy()}T.on("keyup",x=>{x.key==="Escape"&&M()}),g.find('[data-action="cancel"]').on("click",M),g.find('[data-action="save"]').on("click",function(){const x=T.val();x.trim().length&&I.put(`/chats/${d}/messages/${t}`,{message:x}).then(()=>{M(),o.fire("action:chat.edited",{roomId:d,message:x,mid:t})}).catch(_=>{T.val(x).trigger("input"),f.error(_)})}),o.fire("action:chat.prepEdit",{msgEl:e,messageId:t,roomId:d,editEl:g,messageBody:u})},i.addSocketListeners=function(){socket.removeListener("event:chats.edit",l),socket.on("event:chats.edit",l),socket.removeListener("event:chats.delete",v),socket.on("event:chats.delete",v),socket.removeListener("event:chats.restore",B),socket.on("event:chats.restore",B)};function l(e){e.messages.forEach(function(t){const d=parseInt(t.fromuid,10)===parseInt(app.user.uid,10);t.self=d?1:0,i.parseMessage(t,function(p){const g=a.get("chat/message",t.mid);g.length&&(['[component="chat/message/body"]','[component="chat/message/edited"]'].forEach(L=>{g.find(L).replaceWith(p.find(L))}),i.onMessagesAddedToDom(a.get("chat/message",t.mid)));const u=$(`[component="chat/message/parent"][data-parent-mid="${t.mid}"]`);u.length&&(u.find('[component="chat/message/parent/content"]').html(p.find('[component="chat/message/body"]').html()),i.onMessagesAddedToDom($(`[component="chat/message/parent"][data-parent-mid="${t.mid}"]`)))})})}function v(e){const t=a.get("chat/message",e),d=$(`[component="chat/message/parent"][data-parent-mid="${e}"]`),p=parseInt(t.attr("data-uid"),10)===app.user.uid,g=parseInt(d.attr("data-uid"),10)===app.user.uid;t.toggleClass("deleted",!0),d.toggleClass("deleted",!0),p||t.find('[component="chat/message/body"]').translateHtml("<p>[[modules:chat.message-deleted]]</p>"),g||d.find('[component="chat/message/parent/content"]').translateHtml("<p>[[modules:chat.message-deleted]]</p>")}function B(e){const t=a.get("chat/message",e.messageId),d=$(`[component="chat/message/parent"][data-parent-mid="${e.messageId}"]`),p=parseInt(t.attr("data-uid"),10)===app.user.uid,g=parseInt(d.attr("data-uid"),10)===app.user.uid;t.toggleClass("deleted",!1),d.toggleClass("deleted",!1),p||(t.find('[component="chat/message/body"]').translateHtml(e.content),i.onMessagesAddedToDom(a.get("chat/message",e.messageId))),!g&&d.length&&(d.find('[component="chat/message/parent/content"]').translateHtml(e.content),i.onMessagesAddedToDom($(`[component="chat/message/parent"][data-parent-mid="${e.messageId}"]`)))}return i.delete=function(e,t){r.confirm("[[modules:chat.delete-message-confirm]]",function(d){d&&I.del(`/chats/${t}/messages/${e}`,{}).then(()=>{a.get("chat/message",e).toggleClass("deleted",!0)}).catch(f.error)})},i.restore=function(e,t){I.post(`/chats/${t}/messages/${e}`,{}).then(()=>{a.get("chat/message",e).toggleClass("deleted",!1)}).catch(f.error)},i}.apply(k,m),c!==void 0&&(A.exports=c)},2269:(A,k)=>{"use strict";var h,m;h=[],m=function(){const c={},a=/-resized(\.[\w]+)?$/;return c.wrapImagesInLinks=function(o){o.find('[component="post/content"] img:not(.emoji)').each(function(){c.wrapImageInLink($(this))})},c.wrapImageInLink=function(o){let r=o.attr("src")||"";if(r!=="about:blank"&&!o.parent().is("a")){utils.isRelativeUrl(r)&&a.test(r)&&(r=r.replace(a,"$1"));const f=o.attr("alt")||"",y=r.split(".").slice(1).pop(),I=f.split("/").pop(),C=I.split(".").slice(1).pop();o.wrap('<a href="'+r+'" '+(!y&&C?' download="'+utils.escapeHTML(I)+'" ':"")+' target="_blank" rel="noopener">')}},c}.apply(k,h),m!==void 0&&(A.exports=m)},10870:(A,k,h)=>{"use strict";var m,c;m=[h(40027),h(17459),h(68636),h(29930),h(91749)],c=function(a,o,r,f,y){const I={};let C,E;I.show=function(){y.one("action:ajaxify.end",()=>{n(),i(),I.showEmailConfirmWarning()})},I.showEmailConfirmWarning=function(s){if(!config.emailPrompt||!app.user.uid||parseInt(r.getItem("email-confirm-dismiss"),10)===1)return;const l={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{r.setItem("email-confirm-dismiss",1)}};!app.user.email&&!app.user.isEmailConfirmSent?(l.message="[[error:no-email-to-confirm]]",l.clickfn=function(){f.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},f.alert(l)):!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(l.message=s||"[[error:email-not-confirmed]]",l.clickfn=function(){f.remove("email_confirm"),ajaxify.go("/me/edit/email")},f.alert(l)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(l.message="[[error:email-not-confirmed-email-sent]]",f.alert(l))};function i(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||r.getItem("cookieconsent")==="1"||(config.cookies.message=o.unescape(config.cookies.message),config.cookies.dismiss=o.unescape(config.cookies.dismiss),config.cookies.link=o.unescape(config.cookies.link),config.cookies.link_url=o.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(s){$(document.body).append(s),$(document.body).addClass("cookie-consent-open");const l=$(".cookie-consent");l.find("button").on("click",function(){r.setItem("cookieconsent","1"),l.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function n(){const s=utils.params({full:!0});C=s.has("loggedin"),E=s.get("register"),C&&(f.alert({type:"success",title:"[[global:welcome-back]] "+app.user.username+"!",message:"[[global:you-have-successfully-logged-in]]",timeout:5e3}),s.delete("loggedin")),E&&(a.alert({message:utils.escapeHTML(decodeURIComponent(E))}),s.delete("register")),s.has("lang")&&s.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${s.get("lang")}", but that is already the forum default language.`),s.delete("lang"));const l=s.toString();ajaxify.updateHistory(ajaxify.currentPage+(l?`?${l}`:"")+document.location.hash,!0)}return I.showInvalidSession=function(){a.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},I.showSessionMismatch=function(){a.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},I}.apply(k,m),c!==void 0&&(A.exports=c)},68636:(A,k,h)=>{"use strict";var m;m=function(){function c(){this._store={},this._keys=[]}c.prototype.isMock=!0,c.prototype.setItem=function(r,f){r=String(r),this._keys.indexOf(r)===-1&&this._keys.push(r),this._store[r]=f},c.prototype.getItem=function(r){return r=String(r),this._keys.indexOf(r)===-1?null:this._store[r]},c.prototype.removeItem=function(r){r=String(r),this._keys=this._keys.filter(function(f){return f!==r}),this._store[r]=null},c.prototype.clear=function(){this._keys=[],this._store={}},c.prototype.key=function(r){return r=parseInt(r,10)||0,this._keys[r]},Object.defineProperty&&Object.defineProperty(c.prototype,"length",{get:function(){return this._keys.length}});let a;const o=Date.now().toString();try{if(a=window.localStorage,a.setItem(o,o),a.getItem(o)!==o)throw Error("localStorage behaved unexpectedly");return a.removeItem(o),a}catch(r){console.warn(r),console.warn("localStorage failed, falling back on sessionStorage");try{if(a=window.sessionStorage,a.setItem(o,o),a.getItem(o)!==o)throw Error("sessionStorage behaved unexpectedly");return a.removeItem(o),a}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new c}}}.call(k,h,k,A),m!==void 0&&(A.exports=m)},32137:function(A){(function(k,h){A.exports?A.exports=h():k.EvEmitter=h()})(typeof window<"u"?window:this,function(){function k(){}let h=k.prototype;return h.on=function(m,c){if(!m||!c)return this;let a=this._events=this._events||{},o=a[m]=a[m]||[];return o.includes(c)||o.push(c),this},h.once=function(m,c){if(!m||!c)return this;this.on(m,c);let a=this._onceEvents=this._onceEvents||{},o=a[m]=a[m]||{};return o[c]=!0,this},h.off=function(m,c){let a=this._events&&this._events[m];if(!a||!a.length)return this;let o=a.indexOf(c);return o!=-1&&a.splice(o,1),this},h.emitEvent=function(m,c){let a=this._events&&this._events[m];if(!a||!a.length)return this;a=a.slice(0),c=c||[];let o=this._onceEvents&&this._onceEvents[m];for(let r of a)o&&o[r]&&(this.off(m,r),delete o[r]),r.apply(this,c);return this},h.allOff=function(){return delete this._events,delete this._onceEvents,this},k})},47943:function(A,k,h){/*!
 * imagesLoaded v5.0.0
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */(function(m,c){A.exports?A.exports=c(m,h(32137)):m.imagesLoaded=c(m,m.EvEmitter)})(typeof window<"u"?window:this,function(c,a){let o=c.jQuery,r=c.console;function f(n){return Array.isArray(n)?n:typeof n=="object"&&typeof n.length=="number"?[...n]:[n]}function y(n,s,l){if(!(this instanceof y))return new y(n,s,l);let v=n;if(typeof n=="string"&&(v=document.querySelectorAll(n)),!v){r.error(`Bad element for imagesLoaded ${v||n}`);return}this.elements=f(v),this.options={},typeof s=="function"?l=s:Object.assign(this.options,s),l&&this.on("always",l),this.getImages(),o&&(this.jqDeferred=new o.Deferred),setTimeout(this.check.bind(this))}y.prototype=Object.create(a.prototype),y.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)};const I=[1,9,11];y.prototype.addElementImages=function(n){n.nodeName==="IMG"&&this.addImage(n),this.options.background===!0&&this.addElementBackgroundImages(n);let{nodeType:s}=n;if(!s||!I.includes(s))return;let l=n.querySelectorAll("img");for(let v of l)this.addImage(v);if(typeof this.options.background=="string"){let v=n.querySelectorAll(this.options.background);for(let B of v)this.addElementBackgroundImages(B)}};const C=/url\((['"])?(.*?)\1\)/gi;y.prototype.addElementBackgroundImages=function(n){let s=getComputedStyle(n);if(!s)return;let l=C.exec(s.backgroundImage);for(;l!==null;){let v=l&&l[2];v&&this.addBackground(v,n),l=C.exec(s.backgroundImage)}},y.prototype.addImage=function(n){let s=new E(n);this.images.push(s)},y.prototype.addBackground=function(n,s){let l=new i(n,s);this.images.push(l)},y.prototype.check=function(){if(this.progressedCount=0,this.hasAnyBroken=!1,!this.images.length){this.complete();return}let n=(s,l,v)=>{setTimeout(()=>{this.progress(s,l,v)})};this.images.forEach(function(s){s.once("progress",n),s.check()})},y.prototype.progress=function(n,s,l){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!n.isLoaded,this.emitEvent("progress",[this,n,s]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,n),this.progressedCount===this.images.length&&this.complete(),this.options.debug&&r&&r.log(`progress: ${l}`,n,s)},y.prototype.complete=function(){let n=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(n,[this]),this.emitEvent("always",[this]),this.jqDeferred){let s=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[s](this)}};function E(n){this.img=n}E.prototype=Object.create(a.prototype),E.prototype.check=function(){if(this.getIsImageComplete()){this.confirm(this.img.naturalWidth!==0,"naturalWidth");return}this.proxyImage=new Image,this.img.crossOrigin&&(this.proxyImage.crossOrigin=this.img.crossOrigin),this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.proxyImage.src=this.img.currentSrc||this.img.src},E.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},E.prototype.confirm=function(n,s){this.isLoaded=n;let{parentNode:l}=this.img,v=l.nodeName==="PICTURE"?l:this.img;this.emitEvent("progress",[this,v,s])},E.prototype.handleEvent=function(n){let s="on"+n.type;this[s]&&this[s](n)},E.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},E.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},E.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)};function i(n,s){this.url=n,this.element=s,this.img=new Image}return i.prototype=Object.create(E.prototype),i.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(this.img.naturalWidth!==0,"naturalWidth"),this.unbindEvents())},i.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},i.prototype.confirm=function(n,s){this.isLoaded=n,this.emitEvent("progress",[this,this.element,s])},y.makeJQueryPlugin=function(n){n=n||c.jQuery,n&&(o=n,o.fn.imagesLoaded=function(s,l){return new y(this,s,l).jqDeferred.promise(o(this))})},y.makeJQueryPlugin(),y})}}]);
