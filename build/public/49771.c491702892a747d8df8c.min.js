"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[49771,38395],{49771:(C,k,s)=>{var u,d;u=[s(52473),s(16227),s(29930),s(65348)],d=function(E,o,m,y){const c={};let e,n,l,t;c.init=function(){l=ajaxify.data.tid,t=ajaxify.data.category,$(window).off("action:ajaxify.end",i).on("action:ajaxify.end",i),!e&&app.parseAndTranslate("modals/fork-topic",{selectedCategory:t},function(g){e=g,n=e.find("#fork_thread_commit"),$("body").append(e),y.init(e.find('[component="category-selector"]'),{onSelect:function(h){t=h},privilege:"moderate"}),e.find("#fork_thread_cancel").on("click",f),e.find("#fork-title").on("keyup",r),o.init(function(){r(),p()}),p(),n.on("click",a)})};function i(){(ajaxify.data.template.name!=="topic"||ajaxify.data.tid!==l)&&(f(),$(window).off("action:ajaxify.end",i))}function a(){t&&(n.attr("disabled",!0),socket.emit("topics.createTopicFromPosts",{title:e.find("#fork-title").val(),pids:o.pids,fromTid:l,cid:t.cid},function(g,h){function b(A){E.get("post","pid",A).fadeOut(500,function(){$(this).remove()})}if(n.removeAttr("disabled"),g)return m.error(g.message);m.alert({timeout:5e3,title:"[[global:alert.success]]",message:"[[topic:fork-success]]",type:"success",clickfn:function(){ajaxify.go("topic/"+h.slug)}}),o.pids.forEach(function(A){b(A)}),f()}))}function p(){o.pids.length?e.find("#fork-pids").translateHtml("[[topic:fork-pid-count, "+o.pids.length+"]]"):e.find("#fork-pids").translateHtml("[[topic:fork-no-pids]]")}function r(){e.find("#fork-title").val().length&&o.pids.length?n.removeAttr("disabled"):n.attr("disabled",!0)}function f(){e&&(e.remove(),e=null,o.disable())}return c}.apply(k,u),d!==void 0&&(C.exports=d)},96349:(C,k,s)=>{var u,d;u=[s(29930),s(89336),s(49897)],d=function(E,o,m){const y={};return y.init=function(c,e){let n=null;e=e||{},e.privilege=e.privilege||"topics:read",e.states=e.states||["watching","tracking","notwatching","ignoring"],e.cacheList=e.hasOwnProperty("cacheList")?e.cacheList:!0;let l=[];Array.isArray(e.localCategories)&&(l=e.localCategories.map(r=>({...r}))),e.selectedCids=e.selectedCids||ajaxify.data.selectedCids||[];const t=c.find('[component="category-selector-search"]');if(!t.length)return;const i=t.parent('[component="category/dropdown"]').length>0||t.parent('[component="category-selector"]').length>0;c.on("show.bs.dropdown",function(){i&&(c.find(".dropdown-toggle").css({visibility:"hidden"}),t.removeClass("hidden"),t.css({"z-index":c.find(".dropdown-toggle").css("z-index")+1}));function r(){const f=t.find("input").val();f.length>1||!f&&!n?a(f,function(g){n=e.cacheList&&(n||g),p(g)}):!f&&n&&p(n)}t.on("click",function(f){f.preventDefault(),f.stopPropagation()}),t.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),c.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||t.find("input").focus()}),c.on("hide.bs.dropdown",function(){i&&(c.find(".dropdown-toggle").css({visibility:"inherit"}),t.addClass("hidden")),t.off("click"),t.find("input").off("keyup")});function a(r,f){m.get("/search/categories",{search:r,query:utils.params(),parentCid:e.parentCid||0,selectedCids:e.selectedCids,privilege:e.privilege,states:e.states,showLinks:e.showLinks},function(g,{categories:h}){if(g)return E.error(g);f(l.concat(h))})}function p(r){const f=e.selectedCids.map(String);r.forEach(function(g){g.selected=f.includes(String(g.cid))}),app.parseAndTranslate(e.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(g){c.find('[component="category/list"]').html(g.find('[component="category/list"]').html()),c.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const h=o.Dropdown.getInstance(c.find(".dropdown-toggle").get(0));h&&h.update()})}},y}.apply(k,u),d!==void 0&&(C.exports=d)},65348:(C,k,s)=>{var u,d;u=[s(96349),s(40027),s(91749),s(17459)],d=function(E,o,m,y){const c={};return c.init=function(e,n){if(!e||!e.length)return;n=n||{};const l=n.onSelect||function(){};n.states=n.states||["watching","tracking","notwatching","ignoring"],n.template=n.template||"partials/category/selector-dropdown-left",m.fire("action:category.selector.options",{el:e,options:n}),E.init(e,n);const t={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const a=$(this);return a.hasClass("disabled")?!1:(t.selectCategory(a.attr("data-cid")),l(t.selectedCategory))});let i=t.el.find('[component="category-selector-selected"]').html();return y.translate(i,a=>{i=a}),t.selectCategory=function(a){const p=t.el.find('[data-cid="'+a+'"]');t.selectedCategory={cid:a,name:p.attr("data-name")},p.length?t.el.find('[component="category-selector-selected"]').html(p.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(i)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},n.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(n.template,{selectedCategory:n.selectedCategory},function(a){t.el.find('[component="category-selector-selected"]').html(a.find('[component="category-selector-selected"]').html())}),t},c.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(n){const l=o.dialog({title:e.title||"[[modules:composer.select-category]]",message:n,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:i}}}),t=c.init(l.find('[component="category-selector"]'),e);function i(a){return a.preventDefault(),t.selectedCategory&&(e.onSubmit(t.selectedCategory),l.modal("hide")),!1}e.openOnLoad&&l.on("shown.bs.modal",function(){l.find(".dropdown-toggle").dropdown("toggle")}),l.find("form").on("submit",i)})},c}.apply(k,u),d!==void 0&&(C.exports=d)},16227:(C,k,s)=>{var u,d;u=[s(52473)],d=function(E){const o={};let m;o.pids=[];let y=!1;o.init=function(t,i){o.pids.length=0,m=t,i=i||{},y=i.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',c),n()};function c(t){t.stopPropagation();const i=$(this).attr("data-pid"),a=$('[component="topic"] [data-pid="'+i+'"]');!y&&parseInt($(this).attr("data-index"),10)===0||o.togglePostSelection(a,i)}o.disable=function(){o.pids.forEach(function(t){E.get("post","pid",t).toggleClass("selected",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',c),l()},o.togglePostSelection=function(t,i){if(i){const a=o.pids.indexOf(i);a===-1?(o.pids.push(i),t.toggleClass("selected",!0)):(o.pids.splice(a,1),t.toggleClass("selected",!1)),o.pids.length&&o.pids.sort(function(p,r){return p-r}),typeof m=="function"&&m()}};function e(){return!1}function n(){$("#content").on("click",'[component="post"] button, [component="post"] a',e)}function l(){$("#content").off("click",'[component="post"] button, [component="post"] a',e)}return o}.apply(k,u),d!==void 0&&(C.exports=d)}}]);
