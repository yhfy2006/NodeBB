(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18314,99127,34271,1091,87212,33069,62441,98463,49897],{49897:(h,y,r)=>{"use strict";r.r(y),r.d(y,{del:()=>l,get:()=>o,head:()=>c,patch:()=>t,post:()=>u,put:()=>s});var b=r(91749),m=r.n(b),d=r(40027),g=r.n(d);const n=config.relative_path+"/api/v3";async function f(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:n+e.url,typeof a=="function"){v(e).then(i=>a(null,i),i=>a(i));return}try{return await v(e)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again.")return(0,d.confirm)("[[error:api.reauth-required]]",k=>{k&&ajaxify.go("login")});throw i}}async function v(e){const{url:a}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,b.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const i=await fetch(a,e),{headers:k}=i,A=k.get("content-type"),E=A&&A.startsWith("application/json");let p;if(e.method!=="head"&&(E?p=await i.json():p=await i.text()),!i.ok)throw p?new Error(E?p.status.message:p):new Error(i.statusText);return E&&p&&p.hasOwnProperty("status")&&p.hasOwnProperty("response")?p.response:p}function o(e,a,i){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},i)}function c(e,a,i){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},i)}function u(e,a,i){return f({url:e,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}function t(e,a,i){return f({url:e,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}function s(e,a,i){return f({url:e,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}function l(e,a,i){return f({url:e,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},i)}},74566:(h,y,r)=>{h.exports=r(12236)},449:(h,y,r)=>{h.exports=r(91943)},89596:(h,y,r)=>{h.exports=r(62590)},99594:(h,y,r)=>{h.exports=r(57904)},95692:(h,y,r)=>{"use strict";var b,m;b=[r(52473),r(71431),r(88518),r(49897),r(29930),r(43103),r(6411),r(68636),r(91749)],m=function(d,g,n,f,v,o,c,u,t){const s={};s.init=function(){const e=d.get("topic/quickreply/text"),a=`qr:draft:tid:${ajaxify.data.tid}`,i={element:e,strategies:[],options:{style:{"z-index":100}}};l(),$(window).one("action:ajaxify.start",()=>{l()}),$(window).trigger("composer:autocomplete:init",i),n._active.core_qr=n.setup(i),c.bind("ctrl+return",E=>{E.target===e.get(0)&&d.get("topic/quickreply/button").get(0).click()}),o.init({dragDropAreaEl:$('[component="topic/quickreply/container"] .quickreply-message'),pasteEl:e,uploadFormEl:$('[component="topic/quickreply/upload"]'),inputEl:e,route:"/api/post/upload",callback:function(E){let p=e.val();E.forEach(x=>{p=p+(p?`
`:"")+(x.isImage?"!":"")+`[${x.filename}](${x.url})`}),e.val(p)}});let k=!0;d.get("topic/quickreply/button").on("click",function(E){if(E.preventDefault(),!k)return;const p=d.get("topic/quickreply/text").val(),x={tid:ajaxify.data.tid,handle:void 0,content:p},w=p.length;if(w<parseInt(config.minimumPostLength,10))return v.error("[[error:content-too-short, "+config.minimumPostLength+"]]");if(w>parseInt(config.maximumPostLength,10))return v.error("[[error:content-too-long, "+config.maximumPostLength+"]]");k=!1,f.post(`/topics/${ajaxify.data.tid}`,x,function(S,P){if(k=!0,S)return v.error(S);P&&P.queued&&v.alert({type:"success",title:"[[global:alert.success]]",message:P.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${P.id}`)}}),d.get("topic/quickreply/text").val(""),u.removeItem(a),n._active.core_qr.hide(),t.fire("action:quickreply.success",{data:P})})});const A=u.getItem(a);A&&e.val(A),e.on("keyup",utils.debounce(function(){const E=e.val();E?u.setItem(a,E):u.removeItem(a)},1e3)),d.get("topic/quickreply/expand").on("click",E=>{E.preventDefault(),u.removeItem(a);const p=d.get("topic/quickreply/text");g.newReply({tid:ajaxify.data.tid,title:ajaxify.data.title,body:p.val()}),p.val("")})};function l(){n._active.core_qr&&(n._active.core_qr.destroy(),n._active.core_qr=null)}return s}.apply(y,b),m!==void 0&&(h.exports=m)},68636:(h,y,r)=>{"use strict";var b;b=function(){function m(){this._store={},this._keys=[]}m.prototype.isMock=!0,m.prototype.setItem=function(n,f){n=String(n),this._keys.indexOf(n)===-1&&this._keys.push(n),this._store[n]=f},m.prototype.getItem=function(n){return n=String(n),this._keys.indexOf(n)===-1?null:this._store[n]},m.prototype.removeItem=function(n){n=String(n),this._keys=this._keys.filter(function(f){return f!==n}),this._store[n]=null},m.prototype.clear=function(){this._keys=[],this._store={}},m.prototype.key=function(n){return n=parseInt(n,10)||0,this._keys[n]},Object.defineProperty&&Object.defineProperty(m.prototype,"length",{get:function(){return this._keys.length}});let d;const g=Date.now().toString();try{if(d=window.localStorage,d.setItem(g,g),d.getItem(g)!==g)throw Error("localStorage behaved unexpectedly");return d.removeItem(g),d}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(d=window.sessionStorage,d.setItem(g,g),d.getItem(g)!==g)throw Error("sessionStorage behaved unexpectedly");return d.removeItem(g),d}catch(f){return console.warn(f),console.warn("sessionStorage failed, falling back on memory storage"),new m}}}.call(y,r,y,h),b!==void 0&&(h.exports=b)},14063:(h,y,r)=>{"use strict";h=r.nmd(h);var b,m;b=[r(17459),r(91749)],m=function(d,g){const n={};let f=!1;n.init=function(){if(n.taskbar=$('[component="taskbar"]'),n.tasklist=n.taskbar.find("ul"),!n.taskbar.length||!n.tasklist.length){f=!0;return}n.taskbar.on("click","li",async function(){const t=$(this),s=t.attr("data-module"),l=t.attr("data-uuid"),e=await app.require(s);return t.hasClass("active")?e.minimize(l):(o(),e.load(l),n.toggleNew(l,!1),n.tasklist.removeClass("active"),t.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){n.closeAll()})},n.close=async function(t,s){if(f)return;if(n.tasklist.find('[data-module="'+h+'"][data-uuid="'+s+'"]').length){const e=await app.require(t);e&&typeof e.close=="function"&&e.close(s)}},n.closeAll=function(t){if(f)return;let s="[data-uuid]";t&&(s='[data-module="'+t+'"]'+s),n.tasklist.find(s).each(function(l,e){n.close(t||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},n.discard=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').remove(),v()},n.push=function(t,s,l,e){if(e=e||function(){},f)return e();const a=n.tasklist.find('li[data-uuid="'+s+'"]'),i={module:t,uuid:s,options:l,element:a};g.fire("filter:taskbar.push",i),!a.length&&i.module?c(i,e):e(a)},n.get=function(t){return f?[]:$('[data-module="'+t+'"]').map(function(l,e){return $(e).data()})},n.minimize=function(t,s){if(f)return;n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]').toggleClass("active",!1)},n.toggleNew=function(t,s,l){if(f)return;n.tasklist.find('[data-uuid="'+t+'"]').toggleClass("new",s),l||g.fire("action:taskbar.toggleNew",t)},n.updateActive=function(t){if(f)return;const s=n.tasklist.find("li");s.removeClass("active"),s.filter('[data-uuid="'+t+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+t+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},n.isActive=function(t){return f?!1:n.tasklist.find('li[data-uuid="'+t+'"]').hasClass("active")};function v(){if(f)return;n.tasklist.find("li").length>0?n.taskbar.attr("data-active","1"):n.taskbar.removeAttr("data-active")}function o(){f||n.tasklist.find(".active").removeClass("active")}function c(t,s){if(f)return s();d.translate(t.options.title,function(l){const e=$("<div></div>").text(l||"NodeBB Task").html(),a=$("<li></li>").addClass(t.options.className).html('<a href="#"'+(t.options.image?` style="background-image: url('`+t.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(t.options.icon?'<i class="fa '+t.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":t.module,"data-uuid":t.uuid}).addClass(t.options.state!==void 0?t.options.state:"active");(!t.options.state||t.options.state==="active")&&o(),n.tasklist.append(a),v(),t.element=a,a.data(t),g.fire("action:taskbar.pushed",t),s(a)})}const u=function(t,s,l){switch(s){case"title":t.find('[component="taskbar/title"]').text(l);break;case"icon":t.find("i").attr("class","fa fa-"+l);break;case"image":t.find("a").css("background-image",l?'url("'+l.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":t.find("a").css("background-color",l);break;case"color":t.find("a").css("color",l);break}};return n.update=function(t,s,l){if(f)return;const e=n.tasklist.find('[data-module="'+t+'"][data-uuid="'+s+'"]');if(!e.length)return;const a=e.data();Object.keys(l).forEach(function(i){a[i]=l[i],u(e,i,l[i])}),e.data(a)},n}.apply(y,b),m!==void 0&&(h.exports=m)},36159:(h,y,r)=>{"use strict";var b,m;b=[r(49897),r(40027),r(29930),r(24187),r(81335),r(17459),r(65285)],m=function(d,g,n,f,v,o){const c={};return c.get=u=>d.get(`/topics/${u}/thumbs`,{}),c.getByPid=u=>d.get(`/posts/${u}`,{}).then(t=>c.get(t.tid)),c.delete=(u,t)=>d.del(`/topics/${u}/thumbs`,{path:t}),c.deleteAll=u=>{c.get(u).then(t=>{Promise.all(t.map(s=>c.delete(u,s.url)))})},c.upload=u=>new Promise(t=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${u}/thumbs`},function(s){t(s)})}),c.modal={},c.modal.open=function(u){const{id:t,pid:s}=u;let{modal:l}=u,e;return new Promise(a=>{Promise.all([c.get(t),s?c.getByPid(s):[]]).then(i=>new Promise(k=>{const A=i.reduce((E,p)=>E.concat(p));e=A.length,k(A)})).then(i=>v.render("modals/topic-thumbs",{thumbs:i})).then(i=>{l?o.translate(i,function(k){l.find(".bootbox-body").html(k),c.modal.handleSort({modal:l,numThumbs:e})}):(l=g.dialog({title:"[[modules:thumbs.modal.title]]",message:i,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(c.upload(t).then(()=>{c.modal.open({...u,modal:l}),Promise.all([r.e(54516),r.e(99166),r.e(47061),r.e(49775)]).then(function(){var k=[r(71431)];(A=>{A.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),a()}).apply(null,k)}).catch(r.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),c.modal.handleDelete({...u,modal:l}),c.modal.handleSort({modal:l,numThumbs:e}))})})},c.modal.handleDelete=u=>{u.modal.get(0).addEventListener("click",s=>{s.target.closest('button[data-action="remove"]')&&g.confirm("[[modules:thumbs.modal.confirm-remove]]",l=>{if(!l)return;const e=s.target.closest("[data-id]").getAttribute("data-id"),a=s.target.closest("[data-path]").getAttribute("data-path");d.del(`/topics/${e}/thumbs`,{path:a}).then(()=>{c.modal.open(u)}).catch(n.error)})})},c.modal.handleSort=({modal:u,numThumbs:t})=>{if(t>1){const s=u.find(".topic-thumbs-modal");s.sortable({items:"[data-id]"}),s.on("sortupdate",c.modal.handleSortChange)}},c.modal.handleSortChange=(u,t)=>{const s=t.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(s).forEach((l,e)=>{const a=l.getAttribute("data-id");let i=l.getAttribute("data-path");i=i.replace(new RegExp(`^${config.upload_url}`),""),d.put(`/topics/${a}/thumbs/order`,{path:i,order:e}).catch(n.error)})},c}.apply(y,b),m!==void 0&&(h.exports=m)},24187:(h,y,r)=>{"use strict";var b,m;b=[r(64061)],m=function(){const d={};d.show=function(o,c){const u=o.hasOwnProperty("fileSize")&&o.fileSize!==void 0?parseInt(o.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:o.hasOwnProperty("showHelp")&&o.showHelp!==void 0?o.showHelp:!0,fileSize:u,title:o.title||"[[global:upload-file]]",description:o.description||"",button:o.button||"[[global:upload]]",accept:o.accept?o.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const s=t.find("#uploadForm");s.attr("action",o.route),s.find("#params").val(JSON.stringify(o.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),s.submit()}),s.submit(function(){return g(t,u,c),!1})})},d.hideAlerts=function(o){$(o).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function g(o,c,u){n(o,"status","[[uploads:uploading-file]]"),o.find("#upload-progress-bar").css("width","0%"),o.find("#upload-progress-box").show().removeClass("hide");const t=o.find("#fileInput");if(!t.val())return n(o,"error","[[uploads:select-file-to-upload]]");if(!v(t[0],c))return n(o,"error","[[error:file-too-big, "+c+"]]");d.ajaxSubmit(o,u)}function n(o,c,u){d.hideAlerts(o),c==="error"&&o.find("#fileUploadSubmitBtn").removeClass("disabled"),u=u.replace(/&amp;#44/g,"&#44"),o.find("#alert-"+c).translateText(u).removeClass("hide")}d.ajaxSubmit=function(o,c){o.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=f(t),n(o,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,s,l,e){o.find("#upload-progress-bar").css("width",e+"%")},success:function(t){let s=f(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(s=t.response.images),c(s[0].url),n(o,"success","[[uploads:upload-success]]"),setTimeout(function(){d.hideAlerts(o),o.modal("hide")},750)}})};function f(o){if(typeof o=="string")try{return JSON.parse(o)}catch{return{error:"[[error:parse-error]]"}}return o}function v(o,c){return window.FileReader&&c?o.files[0].size<=c*1e3:!0}return d}.apply(y,b),m!==void 0&&(h.exports=m)}}]);
