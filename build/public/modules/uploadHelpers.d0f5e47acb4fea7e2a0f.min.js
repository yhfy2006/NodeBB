"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[33085],{43103:(d,g,h)=>{var p,m;p=[h(29930)],m=function(f){const l={};return l.init=function(a){const n=a.uploadFormEl;if(n.length&&(n.attr("action",config.relative_path+a.route),a.dragDropAreaEl&&l.handleDragDrop({container:a.dragDropAreaEl,callback:function(r){l.ajaxSubmit({uploadForm:n,upload:r,callback:a.callback})}}),a.pasteEl&&l.handlePaste({container:a.pasteEl,callback:function(r){l.ajaxSubmit({uploadForm:n,upload:r,callback:a.callback})}}),a.uploadBtnEl)){const r=n.find('input[name="files[]"]');a.uploadBtnEl.on("click",function(){r.trigger("click")}),r.on("change",function(e){const t=(e.target||{}).files||($(this).val()?[{name:$(this).val(),type:utils.fileMimeType($(this).val())}]:null);t&&l.ajaxSubmit({uploadForm:n,upload:{files:t,fileNames:Array.from(t).map(o=>o.name)},callback:a.callback})})}},l.handleDragDrop=function(a){let n=!1;const r=a.container,e=a.container.find(".imagedrop");r.on("dragenter",function(){n||(e.css("top","0px"),e.css("height",r.height()+"px"),e.css("line-height",r.height()+"px"),e.show(),e.on("dragleave",function(){e.hide(),e.off("dragleave")}))}),e.on("drop",function(i){i.preventDefault();const c=i.originalEvent.dataTransfer.files;if(c.length){let u;if(window.FormData){u=new FormData;for(var s=0;s<c.length;++s)u.append("files[]",c[s],c[s].name)}a.callback({files:c,formData:u})}return e.hide(),!1});function t(o){return o.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){n=!0}).off("dragend").on("dragend, mouseup",function(){n=!1}),e.on("dragover",t),e.on("dragenter",t)},l.handlePaste=function(a){a.container.on("paste",function(r){const e=(r.clipboardData||r.originalEvent.clipboardData||{}).items,t=[],o=[];let i=null;window.FormData&&(i=new FormData),[].forEach.call(e,function(c){const s=c.getAsFile();if(s){const u=utils.generateUUID()+"-"+s.name;i&&i.append("files[]",s,u),t.push(s),o.push(u)}}),t.length&&a.callback({files:t,fileNames:o,formData:i})})},l.ajaxSubmit=function(a){const n=[...a.upload.files];for(let e=0;e<n.length;++e){const t=n[e].type.match(/image./);if(t&&!app.user.privileges["upload:post:image"]||!t&&!app.user.privileges["upload:post:file"])return f.error("[[error:no-privileges]]");if(!app.user.isAdmin&&n[e].size>parseInt(config.maximumFileSize,10)*1024)return a.uploadForm[0].reset(),f.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const r=Date.now();a.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:a.upload.formData,error:function(e){let t=e.responseJSON&&(e.responseJSON.error||e.responseJSON.status&&e.responseJSON.status.message)||"[[error:parse-error]]";e&&e.status===413&&(t=e.statusText||"Request Entity Too Large"),f.error(t),f.remove(r)},uploadProgress:function(e,t,o,i){f.alert({alert_id:r,message:"[[modules:composer.uploading, "+i+"%]]"})},success:function(e){const t=e.response.images;if(t&&t.length)for(var o=0;o<t.length;++o)t[o].filename=n[o].name,t[o].isImage=/image./.test(n[o].type);a.callback(t)},complete:function(){a.uploadForm[0].reset(),setTimeout(f.remove,100,r)}}),!1}),a.uploadForm.submit()},l}.apply(g,p),m!==void 0&&(d.exports=m)}}]);
