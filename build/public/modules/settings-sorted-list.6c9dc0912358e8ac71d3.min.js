"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[66173],{59175:(j,w,p)=>{var A,E;A=[p(81335),p(40027),p(91749),p(65285)],E=function(v,T,c){let m;const h={types:["sorted-list"],use:function(){m=this},set:function(t,e){const s=t.attr("data-sorted-list");e[s]=[],t.find('[data-type="item"]').each(function(a,o){const i=$(o).attr("data-sorted-list-uuid"),n=m.helper.serializeForm($('[data-sorted-list-object="'+s+'"][data-sorted-list-uuid="'+i+'"]'));b(n),e[s].push(n)})},get:async(t,e)=>{const{listEl:s,key:a,formTpl:o,formValues:i}=await c.fire("filter:settings.sorted-list.load",{listEl:t.find('[data-type="list"]'),key:t.attr("data-sorted-list"),formTpl:t.attr("data-form-template"),formValues:{}}),n=await v.render(o,i);$('[data-sorted-list="'+a+'"] [data-type="add"]').on("click",function(){const f=T.confirm(n,function(l){l&&h.addItem(f.find("form").children(),t)});c.fire("action:settings.sorted-list.modal",{modal:f})});const y=t.parents("form").attr("data-socket-get"),r=ajaxify.data[y?e:"settings"][a];if(Array.isArray(r)&&typeof r[0]!="string"){const f=await Promise.all(r.map(async l=>{({item:l}=await c.fire("filter:settings.sorted-list.loadItem",{item:l}));const g=utils.generateUUID(),u=$(n).deserialize(l);return u.attr("data-sorted-list-uuid",g),u.attr("data-sorted-list-object",a),$("#content").append(u.hide()),{itemUUID:g,item:l}}));for(const{itemUUID:l,item:g}of f){const u=await B(t,l,g);c.fire("action:settings.sorted-list.itemLoaded",{element:u})}c.fire("action:settings.sorted-list.loaded",{containerEl:t.get(0),listEl:s.get(0),hash:e,key:a})}s.sortable().addClass("pointer")},addItem:async(t,e)=>{const s=e.attr("data-sorted-list"),a=utils.generateUUID(),o=$('<form class="" data-sorted-list-uuid="'+a+'" data-sorted-list-object="'+s+'"></form>');o.append(t),$("#content").append(o.hide());let i=m.helper.serializeForm(o);({item:i}=await c.fire("filter:settings.sorted-list.loadItem",{item:i})),B(e,a,i)}};function I(t,e){t.find('[data-sorted-list-uuid="'+e+'"] [data-type="remove"]').on("click",function(){$('[data-sorted-list-uuid="'+e+'"]').remove()})}function C(t,e){const s=t.find('[data-type="list"]'),a=t.attr("data-sorted-list");$('[data-sorted-list-uuid="'+e+'"] [data-type="edit"]').on("click",function(){const i=$('[data-sorted-list-uuid="'+e+'"][data-sorted-list-object="'+a+'"]'),n=i.clone(!0).show();n.find("select").each((y,r)=>{r.value=i.find(`select#${r.id}`).val()});const d=T.confirm(n,async y=>{if(y){const r=$('<form class="" data-sorted-list-uuid="'+e+'" data-sorted-list-object="'+a+'"></form>');r.append(d.find("form").children()),$("#content").find('[data-sorted-list-uuid="'+e+'"][data-sorted-list-object="'+a+'"]').remove(),$("#content").append(r.hide());let f=m.helper.serializeForm(r);({item:f}=await c.fire("filter:settings.sorted-list.loadItem",{item:f})),b(f);const l=s.find('[data-sorted-list-uuid="'+e+'"]');B(t,e,f,l)}});c.fire("action:settings.sorted-list.modal",{modal:d})})}function B(t,e,s,a){const o=t.find('[data-type="list"]'),i=t.attr("data-item-template");return b(s),new Promise(n=>{app.parseAndTranslate(i,s,function(d){d=$(d),a?a.replaceWith(d):o.append(d),d.attr("data-sorted-list-uuid",e),I(t,e),C(t,e),c.fire("action:settings.sorted-list.parse",{itemHtml:d}),n(d.get(0))})})}function b(t){return Object.entries(t||{}).forEach(([e,s])=>{t[e]=typeof s=="string"?utils.stripHTMLTags(s,utils.stripTags):s})}return h}.apply(w,A),E!==void 0&&(j.exports=E)}}]);
