(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[68783],{52543:(d,T,p)=>{d.exports=p(28721)},28721:(d,T,p)=>{"use strict";var x,h;x=[p(29930)],h=function(f){var s={},m,l;s.init=function(i,e){var t=i.find(".tags");if(t.length){m=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,l=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,t.tagsinput({tagClass:"badge bg-info rounded-1",confirmKeys:[13,44],trimValue:!0});var n=i.find(".bootstrap-tagsinput input");y(i,e,ajaxify.data),app.loadJQueryUI(function(){n.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:i.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(r,g){socket.emit("topics.autocompleteTags",{query:r.term,cid:e.cid},function(o,c){if(o)return f.error(o);c&&g(c),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){v(n)}}),w(e.tags,t),t.on("beforeItemAdd",function(r){var g=l&&l<=s.getTags(i.attr("data-uuid")).length,o=utils.cleanUpTag(r.item,config.maximumTagLength),c=o!==r.item;if(r.cancel=c||r.item.length<config.minimumTagLength||r.item.length>config.maximumTagLength||g,r.item.length<config.minimumTagLength)return f.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(r.item.length>config.maximumTagLength)return f.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(g)return f.error("[[error:too-many-tags, "+l+"]]");c&&t.tagsinput("add",o)});var a=!1,u=!1;t.on("itemRemoved",function(r){if(u){u=!1;return}r.item&&socket.emit("topics.canRemoveTag",{tag:r.item},function(g,o){if(g)return f.error(g);o||(f.error("[[error:cant-remove-system-tag]]"),a=!0,t.tagsinput("add",r.item))})}),t.on("itemAdded",function(r){if(a){a=!1;return}var g=e.hasOwnProperty("cid")?e.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:r.item,cid:g||0},function(o,c){if(o)return f.error(o);if(!c)return u=!0,t.tagsinput("remove",r.item);$(window).trigger("action:tag.added",{cid:g,tagEl:t,tag:r.item}),n.length&&n.autocomplete("close")})})}),n.attr("tabIndex",t.attr("tabIndex")),n.on("blur",function(){v(n)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var a=$(this).attr("data-tag");return a&&w([a],t),!1})}},s.isEnoughTags=function(i){return s.getTags(i).length>=m},s.minTagCount=function(){return m},s.onChangeCategory=function(i,e,t,n){var a=i.find('[component="composer/tag/dropdown"]');a.length&&(y(i,e,n),a.toggleClass("hidden",!n.tagWhitelist||!n.tagWhitelist.length),n.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:n.tagWhitelist},function(u){a.find(".dropdown-menu").html(u)}))};function y(i,e,t){var n=i.find(".tags"),a=i.find(".bootstrap-tagsinput input");a.length&&(t.hasOwnProperty("minTags")&&(m=t.minTags),t.hasOwnProperty("maxTags")&&(l=t.maxTags),t.tagWhitelist&&t.tagWhitelist.length?(a.attr("readonly",""),a.attr("placeholder",""),n.tagsinput("items").slice().forEach(function(u){t.tagWhitelist.indexOf(u)===-1&&n.tagsinput("remove",u)})):(a.removeAttr("readonly"),a.attr("placeholder",i.find("input.tags").attr("placeholder"))),i.find(".tags-container").toggleClass("haswhitelist",!!(t.tagWhitelist&&t.tagWhitelist.length)),i.find(".tags-container").toggleClass("hidden",t.privileges&&t.privileges.hasOwnProperty("topics:tag")&&!t.privileges["topics:tag"]||l===0&&!e&&!e.tags&&!e.tags.length),t.privileges&&t.privileges.hasOwnProperty("topics:tag")&&!t.privileges["topics:tag"]&&n.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:i,tagWhitelist:t.tagWhitelist,tagsInput:a}))}function v(i){var e=jQuery.Event("keypress");e.which=13,e.keyCode=13,setTimeout(function(){i.trigger(e)},100)}function w(i,e){if(i&&i.length)for(var t=0;t<i.length;++t)e.tagsinput("add",i[t])}return s.getTags=function(i){return $('.composer[data-uuid="'+i+'"] .tags').tagsinput("items")},s}.apply(T,x),h!==void 0&&(d.exports=h)}}]);
