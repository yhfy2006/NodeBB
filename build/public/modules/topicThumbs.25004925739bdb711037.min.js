"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[62441,99127,34271,1091,98463,49897],{49897:(S,E,l)=>{l.r(E),l.d(E,{del:()=>c,get:()=>t,head:()=>n,patch:()=>r,post:()=>o,put:()=>i});var p=l(91749),g=l.n(p),u=l(40027),P=l.n(u);const h=config.relative_path+"/api/v3";async function f(e,a){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:h+e.url,typeof a=="function"){A(e).then(s=>a(null,s),s=>a(s));return}try{return await A(e)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again.")return(0,u.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go("login")});throw s}}async function A(e){const{url:a}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,p.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const s=await fetch(a,e),{headers:m}=s,b=m.get("content-type"),y=b&&b.startsWith("application/json");let d;if(e.method!=="head"&&(y?d=await s.json():d=await s.text()),!s.ok)throw d?new Error(y?d.status.message:d):new Error(s.statusText);return y&&d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d}function t(e,a,s){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):"")},s)}function n(e,a,s){return f({url:e+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},s)}function o(e,a,s){return f({url:e,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},s)}function r(e,a,s){return f({url:e,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},s)}function i(e,a,s){return f({url:e,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},s)}function c(e,a,s){return f({url:e,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},s)}},36159:(S,E,l)=>{var p,g;p=[l(49897),l(40027),l(29930),l(24187),l(81335),l(17459),l(65285)],g=function(u,P,h,f,A,t){const n={};return n.get=o=>u.get(`/topics/${o}/thumbs`,{}),n.getByPid=o=>u.get(`/posts/${o}`,{}).then(r=>n.get(r.tid)),n.delete=(o,r)=>u.del(`/topics/${o}/thumbs`,{path:r}),n.deleteAll=o=>{n.get(o).then(r=>{Promise.all(r.map(i=>n.delete(o,i.url)))})},n.upload=o=>new Promise(r=>{f.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+`/api/v3/topics/${o}/thumbs`},function(i){r(i)})}),n.modal={},n.modal.open=function(o){const{id:r,pid:i}=o;let{modal:c}=o,e;return new Promise(a=>{Promise.all([n.get(r),i?n.getByPid(i):[]]).then(s=>new Promise(m=>{const b=s.reduce((y,d)=>y.concat(d));e=b.length,m(b)})).then(s=>A.render("modals/topic-thumbs",{thumbs:s})).then(s=>{c?t.translate(s,function(m){c.find(".bootbox-body").html(m),n.modal.handleSort({modal:c,numThumbs:e})}):(c=P.dialog({title:"[[modules:thumbs.modal.title]]",message:s,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(n.upload(r).then(()=>{n.modal.open({...o,modal:c}),Promise.all([l.e(54516),l.e(99166),l.e(47061),l.e(49775)]).then(function(){var m=[l(71431)];(b=>{b.updateThumbCount(r,$(`[component="composer"][data-uuid="${r}"]`)),a()}).apply(null,m)}).catch(l.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),n.modal.handleDelete({...o,modal:c}),n.modal.handleSort({modal:c,numThumbs:e}))})})},n.modal.handleDelete=o=>{o.modal.get(0).addEventListener("click",i=>{i.target.closest('button[data-action="remove"]')&&P.confirm("[[modules:thumbs.modal.confirm-remove]]",c=>{if(!c)return;const e=i.target.closest("[data-id]").getAttribute("data-id"),a=i.target.closest("[data-path]").getAttribute("data-path");u.del(`/topics/${e}/thumbs`,{path:a}).then(()=>{n.modal.open(o)}).catch(h.error)})})},n.modal.handleSort=({modal:o,numThumbs:r})=>{if(r>1){const i=o.find(".topic-thumbs-modal");i.sortable({items:"[data-id]"}),i.on("sortupdate",n.modal.handleSortChange)}},n.modal.handleSortChange=(o,r)=>{const i=r.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(i).forEach((c,e)=>{const a=c.getAttribute("data-id");let s=c.getAttribute("data-path");s=s.replace(new RegExp(`^${config.upload_url}`),""),u.put(`/topics/${a}/thumbs/order`,{path:s,order:e}).catch(h.error)})},n}.apply(E,p),g!==void 0&&(S.exports=g)},24187:(S,E,l)=>{var p,g;p=[l(64061)],g=function(){const u={};u.show=function(t,n){const o=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:o,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(r){r.modal("show"),r.on("hidden.bs.modal",function(){r.remove()});const i=r.find("#uploadForm");i.attr("action",t.route),i.find("#params").val(JSON.stringify(t.params)),r.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),i.submit()}),i.submit(function(){return P(r,o,n),!1})})},u.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function P(t,n,o){h(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const r=t.find("#fileInput");if(!r.val())return h(t,"error","[[uploads:select-file-to-upload]]");if(!A(r[0],n))return h(t,"error","[[error:file-too-big, "+n+"]]");u.ajaxSubmit(t,o)}function h(t,n,o){u.hideAlerts(t),n==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),o=o.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+n).translateText(o).removeClass("hide")}u.ajaxSubmit=function(t,n){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(r){r=f(r),h(t,"error",r.responseJSON?.status?.message||r.responseJSON?.error||`[[error:upload-error-fallback, ${r.status} ${r.statusText}]]`)},uploadProgress:function(r,i,c,e){t.find("#upload-progress-bar").css("width",e+"%")},success:function(r){let i=f(r);r.hasOwnProperty("response")&&r.hasOwnProperty("status")&&r.status.code==="ok"&&(i=r.response.images),n(i[0].url),h(t,"success","[[uploads:upload-success]]"),setTimeout(function(){u.hideAlerts(t),t.modal("hide")},750)}})};function f(t){if(typeof t=="string")try{return JSON.parse(t)}catch{return{error:"[[error:parse-error]]"}}return t}function A(t,n){return window.FileReader&&n?t.files[0].size<=n*1e3:!0}return u}.apply(E,p),g!==void 0&&(S.exports=g)}}]);
