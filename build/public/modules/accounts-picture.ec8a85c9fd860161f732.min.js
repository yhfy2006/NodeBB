"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[43400,99127,34271,1091,16852,49897],{7524:(D,v,c)=>{var m,g;m=[c(72254),c(49897),c(40027),c(29930)],g=((p,x,b,d)=>{const u={};u.openChangeModal=()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(a,r){if(a)return d.error(a);const s=r.reduce(function(n,e){return n||e.type==="uploaded"},!1);app.parseAndTranslate("modals/change-picture",{pictures:r,uploaded:s,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:config.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},function(n){const e=b.dialog({className:"picture-switcher",title:"[[user:change-picture]]",message:n,show:!0,size:"large",buttons:{close:{label:"[[global:close]]",callback:C,className:"btn-link"},update:{label:"[[global:save-changes]]",callback:o}}});e.on("shown.bs.modal",i),e.on("click",".list-group-item",function(){e.find(".list-group-item").removeClass("active"),$(this).addClass("active")}),e.on("change",'input[type="radio"][name="icon:bgColor"]',f=>{const y=f.target.value;e.find('[component="avatar/icon"]').css("background-color",y)}),t(e);function i(){ajaxify.data.picture?e.find(".list-group-item img").each(function(){this.getAttribute("src")===ajaxify.data.picture&&$(this).parents(".list-group-item").addClass("active")}):e.find('[data-type="default"]').addClass("active");const f=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);f?f.checked=!0:document.querySelector('.modal input[type="radio"]').checked=!0}function o(){const f=e.find(".list-group-item.active").attr("data-type"),y=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";l(f,y).then(()=>{u.updateHeader(f==="default"?"":e.find(".list-group-item.active img").attr("src"),y),ajaxify.refresh()}).catch(d.error)}function C(){e.modal("hide")}})})},u.updateHeader=(a,r)=>{if(parseInt(ajaxify.data.theirid,10)!==parseInt(ajaxify.data.yourid,10))return;!a&&ajaxify.data.defaultAvatar&&(a=ajaxify.data.defaultAvatar);const s=$('[component="header/avatar"] [component="avatar/picture"]'),n=$('[component="header/avatar"] [component="avatar/icon"]');if(a){if(!s.length&&n.length){const e=$("<img/>");$(n[0].attributes).each(function(){e.attr(this.nodeName,this.nodeValue)}),e.attr("component","avatar/picture").attr("src",a).insertBefore(n)}}else s.remove();r&&n.css({"background-color":r})};function t(a){function r(n){n=(n.startsWith("http")?"":config.relative_path)+n+"?"+Date.now(),u.updateHeader(n),ajaxify.data.picture&&ajaxify.data.picture.length?($("#user-current-picture, img.avatar").attr("src",n),ajaxify.data.uploadedpicture=n):ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",n)})}function s(){ajaxify.data.uploadedpicture===ajaxify.data.picture&&(ajaxify.refresh(),u.updateHeader())}a.find('[data-action="upload"]').on("click",function(){return a.modal("hide"),p.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:!1,title:"[[user:upload-picture]]",description:"[[user:upload-a-picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(n){r(n)}),!1}),a.find('[data-action="upload-url"]').on("click",function(){return a.modal("hide"),app.parseAndTranslate("modals/upload-picture-from-url",{},function(n){n.modal("show"),n.find(".upload-btn").on("click",function(){const e=n.find("#uploadFromUrl").val();return e&&(n.modal("hide"),p.handleImageCrop({url:e,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:!1,paramName:"uid",paramValue:ajaxify.data.theirid},r)),!1})}),!1}),a.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(n){if(a.modal("hide"),n)return d.error(n);s()})})}function l(a,r){return x.put(`/users/${ajaxify.data.theirid}/picture`,{type:a,bgColor:r})}return u}).apply(v,m),g!==void 0&&(D.exports=g)},49897:(D,v,c)=>{c.r(v),c.d(v,{del:()=>n,get:()=>t,head:()=>l,patch:()=>r,post:()=>a,put:()=>s});var m=c(91749),g=c.n(m),p=c(40027),x=c.n(p);const b=config.relative_path+"/api/v3";async function d(e,i){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:b+e.url,typeof i=="function"){u(e).then(o=>i(null,o),o=>i(o));return}try{return await u(e)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again.")return(0,p.confirm)("[[error:api.reauth-required]]",C=>{C&&ajaxify.go("login")});throw o}}async function u(e){const{url:i}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,m.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const o=await fetch(i,e),{headers:C}=o,f=C.get("content-type"),y=f&&f.startsWith("application/json");let h;if(e.method!=="head"&&(y?h=await o.json():h=await o.text()),!o.ok)throw h?new Error(y?h.status.message:h):new Error(o.statusText);return y&&h&&h.hasOwnProperty("status")&&h.hasOwnProperty("response")?h.response:h}function t(e,i,o){return d({url:e+(i&&Object.keys(i).length?"?"+$.param(i):"")},o)}function l(e,i,o){return d({url:e+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"head"},o)}function a(e,i,o){return d({url:e,method:"post",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function r(e,i,o){return d({url:e,method:"patch",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function s(e,i,o){return d({url:e,method:"put",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function n(e,i,o){return d({url:e,method:"delete",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}},72254:(D,v,c)=>{var m,g;m=[c(29930)],g=function(p){const x={};x.show=function(t,l){const a=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:a,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(r){r.modal("show"),r.on("hidden.bs.modal",function(){r.remove()});const s=r.find("#uploadForm");t.route&&s.attr("action",t.route),r.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),t.uploadModal=r,u(t,l),!1})})},x.handleImageCrop=function(t,l){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(t.url)},async function(a){a.modal({backdrop:"static"}).modal("show");const r=parseInt($(window).height()/2,10),s=document.getElementById("cropped-image");$(s).css("max-height",r);const n=(await c.e(60239).then(c.t.bind(c,65643,23))).default;let e=new n(s,{aspectRatio:t.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){t.restrictImageDimension&&(e.cropBoxData.width>t.imageDimension&&e.setCropBoxData({width:t.imageDimension}),e.cropBoxData.height>t.imageDimension&&e.setCropBoxData({height:t.imageDimension}))},ready:function(){if(!d(e,t))return a.modal("hide");if(t.restrictImageDimension){const i=s.width<s.height?s.width:s.height,o=i>t.imageDimension?t.imageDimension:i;e.setCropBoxData({width:o,height:o})}a.find(".rotate").on("click",function(){const i=this.getAttribute("data-degrees");e.rotate(i)}),a.find(".flip").on("click",function(){const i=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?e.scaleX(i):e.scaleY(i),this.setAttribute("data-option",i*-1)}),a.find(".reset").on("click",function(){e.reset()}),a.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const i=d(e,t);i&&(a.find("#upload-progress-bar").css("width","0%"),a.find("#upload-progress-box").show().removeClass("hide"),b({data:t,imageData:i,progressBarEl:a.find("#upload-progress-bar")},function(o,C){if(o)return a.find("#upload-progress-box").hide(),a.find(".upload-btn").removeClass("disabled"),a.find(".crop-btn").removeClass("disabled"),p.error(o);l(C.url),a.modal("hide")}))}),a.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),e.destroy();const i=(await c.e(60239).then(c.t.bind(c,65643,23))).default;e=new i(s,{viewMode:1,autoCropArea:1,ready:function(){a.find(".crop-btn").trigger("click")}})})}})})};function b(t,l){const a={};a[t.data.paramName]=t.data.paramValue,a.method=t.data.socketMethod,a.size=t.imageData.length,a.progress=0;const r=1e5;function s(){const n=t.imageData.slice(a.progress,a.progress+r);socket.emit("uploads.upload",{chunk:n,params:a},function(e,i){if(e)return p.error(e);if(a.progress+r<a.size)return a.progress+=n.length,t.progressBarEl.css("width",(a.progress/a.size*100).toFixed(2)+"%"),setTimeout(s,100);t.progressBarEl.css("width","100%"),l(null,i)})}s()}function d(t,l){let a;try{a=l.imageType?t.getCroppedCanvas().toDataURL(l.imageType):t.getCroppedCanvas().toDataURL()}catch(r){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(r.message)!==-1?p.error("[[error:cors-error]]"):p.error(r.message);return}return a}function u(t,l){function a(i,o){i==="error"&&t.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),t.uploadModal.find("#alert-"+i).translateText(o).removeClass("hide")}const r=t.uploadModal.find("#fileInput");if(!r.val())return a("error","[[uploads:select-file-to-upload]]");const s=r[0].files[0],n=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;if(n&&s.size>n*1024)return a("error","[[error:file-too-big, "+n+"]]");if(s.name.endsWith(".gif")){c.e(98463).then(function(){var i=[c(24187)];(function(o){o.ajaxSubmit(t.uploadModal,l)}).apply(null,i)}).catch(c.oe);return}const e=new FileReader;e.addEventListener("load",function(){const i=e.result;t.uploadModal.modal("hide"),x.handleImageCrop({url:i,imageType:s.type,socketMethod:t.socketMethod,aspectRatio:t.aspectRatio,allowSkippingCrop:t.allowSkippingCrop,restrictImageDimension:t.restrictImageDimension,imageDimension:t.imageDimension,paramName:t.paramName,paramValue:t.paramValue},l)},!1),s&&e.readAsDataURL(s)}return x}.apply(v,m),g!==void 0&&(D.exports=g)}}]);
