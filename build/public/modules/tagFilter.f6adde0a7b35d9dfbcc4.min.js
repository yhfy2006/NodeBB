"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8981],{25955:(y,T,f)=>{var u,r;u=[f(91749),f(29930),f(89336)],r=function(b,w,x){const p={};p.init=function(a,n){if(!a||!a.length)return;n=n||{},n.template="partials/tags/filter-dropdown-left",b.fire("action:tag.filter.options",{el:a,options:n});const d=a.find('[component="tag/filter/search"]');n.selectedTags=n.selectedTags||ajaxify.data.selectedTags||[];let c=null,e=[],o=[];Array.isArray(n.selectedTags)?e=n.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(e=ajaxify.data.selectedTags.map(String)),o=e.slice();const h=d.parent('[component="tag/filter"]').length&&app.user.privileges["search:tags"];a.on("show.bs.dropdown",function(){h&&(a.find(".dropdown-toggle").css({visibility:"hidden"}),d.removeClass("hidden"),d.css({"z-index":a.find(".dropdown-toggle").css("z-index")+1}));function s(){const i=d.find("input").val();i.length>1||!i&&!c?A(i,function(t){c=c||t,m(t)}):!i&&c&&m(c)}d.on("click",function(i){i.preventDefault(),i.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(s,300)),s()}),a.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),a.on("hidden.bs.dropdown",function(){h&&(a.find(".dropdown-toggle").css({visibility:"inherit"}),d.addClass("hidden")),d.off("click"),d.find("input").off("keyup");let s=o.length!==e.length;if(o.forEach(function(i,t){i!==e[t]&&(s=!0)}),o=e.slice(),s&&(n.updateButton?n.updateButton({el:a,changed:s,selectedTags:e.slice()}):n.updateButton!==!1&&v(a,e)),n.onHidden){n.onHidden({changed:s,selectedTags:e.slice()});return}if(s){let i=window.location.pathname;const t=utils.params();e.length?t.tag=e.length?e:void 0:delete t.tag,delete t.page,Object.keys(t).length&&(i+="?"+decodeURIComponent($.param(t))),ajaxify.go(i)}}),a.on("click",'[component="tag/filter/list"] [data-tag]',function(){const s=a.find('[component="tag/filter/list"]'),i=$(this),t=i.find("a").attr("href");if(t&&t!=="#"&&t.length)return;const l=i.attr("data-tag"),g=i.find('[component="tag/select/icon"]');return l!==""?(e.includes(l)?e.splice(e.indexOf(l),1):e.push(l),e.sort(function(E,C){return E-C}),g.toggleClass("invisible")):(a.find('[component="tag/select/icon"]').addClass("invisible"),e=[]),s.find('[data-tag=""] i').toggleClass("invisible",!!e.length),n.selectedTags=e,n.onSelect&&n.onSelect({tag:l,selectedTags:e.slice()}),!1});function A(s,i){let t=null;ajaxify.data.template.category?t=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(t=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:s,cids:t},function(l,g){if(l)return w.error(l);i(g)})}function m(s){const i=n.selectedTags;s.forEach(function(t){t.selected=i.includes(t.valueEscaped)}),app.parseAndTranslate(n.template,{tagItems:s.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(t){a.find('[component="tag/filter/list"]').html(t.find('[component="tag/filter/list"]').html());const l=x.Dropdown.getInstance(a.find(".dropdown-toggle").get(0));l&&l.update()})}};function v(a,n){n.length>0?d({label:n.join(", ")}):d();function d(c){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:c},function(e){a.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return p}.apply(T,u),r!==void 0&&(y.exports=r)}}]);
