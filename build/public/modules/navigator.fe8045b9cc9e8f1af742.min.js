"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[65928,87549,87212],{25967:(E,A,T)=>{var P,w;P=[T(40027)],w=function(g){const d={};return d.init=function(){$("body").on("click",'[component="pagination/select-page"]',function(){return g.prompt("[[global:enter-page-number]]",function(i){d.loadPage(i)}),!1})},d.loadPage=function(i,I){if(I=I||function(){},i=parseInt(i,10),!utils.isNumber(i)||i<1||i>ajaxify.data.pagination.pageCount)return;const _=utils.params();_.page=i;const K=window.location.pathname+"?"+$.param(_);ajaxify.go(K,I)},d.nextPage=function(i){d.loadPage(ajaxify.data.pagination.currentPage+1,i)},d.previousPage=function(i){d.loadPage(ajaxify.data.pagination.currentPage-1,i)},d}.apply(A,P),w!==void 0&&(E.exports=w)},96352:(E,A,T)=>{var P,w;P=[T(25967),T(52473),T(91749),T(29930),T(17459),T(68636)],w=function(g,d,i,I,_,K){const o={};let r=0,x=0,M=0,O,S,R,B,F,C=!1,j=!0,H="";o.scrollActive=!1;let c=$(".pagination-block"),W=c.find(".pagination-text"),tt=c.find("meter"),ot=c.find(".progress-bar"),X=c.find(".unread"),v;$(window).on("action:ajaxify.start",function(){$(window).off("keydown",J)}),o.init=function(t,e,a,n,h){r=0,o.selector=t,o.callback=h,o.toTop=a||function(){},o.toBottom=n||function(){},c=$(".pagination-block"),W=c.find(".pagination-text"),tt=c.find("meter"),ot=c.find(".progress-bar"),X=c.find(".unread"),v=$(".scroller-thumb"),H=utils.findBootstrapEnvironment(),$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),c.find(".dropdown-menu").off("click").on("click",function(f){f.stopPropagation()}),c.off("shown.bs.dropdown",".wrapper").on("shown.bs.dropdown",".wrapper",function(){const f=$(this);setTimeout(async function(){["lg","xl","xxl"].includes(utils.findBootstrapEnvironment())&&f.find("input").trigger("focus"),await socket.emit("topics.getPostCountInTopic",ajaxify.data.tid)>0&&c.find("#myNextPostBtn").removeAttr("disabled")},100)}),c.find(".pageup").off("click").on("click",o.scrollUp),c.find(".pagedown").off("click").on("click",o.scrollDown),c.find(".pagetop").off("click").on("click",o.toTop),c.find(".pagebottom").off("click").on("click",o.toBottom),c.find(".pageprev").off("click").on("click",g.previousPage),c.find(".pagenext").off("click").on("click",g.nextPage),c.find("#myNextPostBtn").off("click").on("click",at),c.find("input").on("keydown",function(f){if(f.which===13){const p=$(this);if(!utils.isNumber(p.val())){p.val("");return}const b=parseInt(p.val(),10),l=U(b);p.val(""),c.find(".dopdown-menu.show").removeClass("show"),ajaxify.go(l)}}),ajaxify.data.template.topic&&(st(),M=ajaxify.data.postcount,nt(ajaxify.data.postIndex)),ct(),o.setCount(e),o.update()};let L=0;async function at(){async function t(e){return await socket.emit("topics.getMyNextPostIndex",{tid:ajaxify.data.tid,index:Math.max(1,e),sort:config.topicPostSort})}if(ajaxify.data.template.topic){let e=await t(r);L===e&&(e=await t(e)),e&&r!==e+1?(L=e,$(window).one("action:ajaxify.end",function(){c.find(".dropdown-menu").is(":hidden")&&c.find(".dropdown-toggle").dropdown("toggle")}),o.scrollToIndex(e,!0,0)):(I.alert({message:"[[topic:no-more-next-post]]",type:"info"}),L=1)}}function N(t,e){const a=t.parent(),n=a.offset(),f=t.find(".scroller-thumb-icon").height();return e<n.top?e=n.top:e>n.top+a.height()-f&&(e=n.top+a.height()-f),e}function D(t){!v||!v.length||!v.is(":visible")||(v.each((e,a)=>{const n=$(a);if(n.is(":hidden"))return;const h=n.parent(),f=h.offset(),b=n.find(".scroller-thumb-icon").height(),l=(h.height()-b)/(ajaxify.data.postcount-1),s={top:N(n,f.top+(t-1)*l),left:n.offset().left};n.offset(s),V(n,t),et(n,t)}),nt(t),G(t))}function V(t,e){H==="xs"||H==="sm"||H==="md"?t.find(".thumb-text").text(`${e}/${ajaxify.data.postcount}`):t.find(".thumb-text").translateText(`[[topic:navigator.index, ${e}, ${ajaxify.data.postcount}]]`)}async function et(t,e){const a=t.find(".thumb-timestamp");if(a.length){const n=await it(e);a.attr("title",utils.toISOString(n)).timeago()}}async function it(t){const e=$(`[component="post"][data-index=${t-1}]`);return e.length?parseInt(e.attr("data-timestamp"),10):await socket.emit("posts.getPostTimestampByIndex",{tid:ajaxify.data.tid,index:t-1})}function st(){if(!v.length)return;v.parent().off("click").on("click",function(l){if($(l.target).hasClass("scroller-container")){const y=$(l.target).find(".scroller-thumb"),s=e(y,l.pageY);return o.scrollToIndex(s-1,!0,0),!1}});function e(l,y){const s=l.parent(),m=l.find(".scroller-thumb-icon").height(),k=N(l,y-m/2),Q=s.offset(),Z=(k-Q.top)/(s.height()-m);return r=Math.max(1,Math.ceil(ajaxify.data.postcount*Z)),r>ajaxify.data.postcount?ajaxify.data.postcount:r}let a=!1;i.on("action:ajaxify.end",function(){F=null}),c.find(".dropdown-menu").parent().off("shown.bs.dropdown").on("shown.bs.dropdown",function(){D(r)});let n=null;const h=utils.debounce(et,50);function f(l){if(!n||!n.length)return;const s=n.find(".scroller-thumb-icon").height(),u=N(n,l.pageY-s/2);n.offset({top:u,left:n.offset().left});const m=e(n,l.pageY);return o.updateTextAndProgressBar(),V(n,m),h(n,m),j&&b(),j=!1,l.stopPropagation(),!1}v.off("mousedown").on("mousedown",function(l){l.originalEvent.button===0&&(a=!0,n=$(this),n.addClass("active"),$(window).on("mousemove",f),j=!0)});function p(){$(window).off("mousemove",f),a&&(o.scrollToIndex(r-1,!0,0),c.find(".dropdown-menu.show").removeClass("show")),z(),a=!1,j=!1,n&&n.length&&n.removeClass("active"),n=null}function b(){z(),S=setInterval(function(){G(r)},250)}$(window).off("mousemove",f),$(window).off("mouseup",p).on("mouseup",p),v.each((l,y)=>{const s=$(y);s.off("touchstart").on("touchstart",function(u){C=!0,R=Math.min($(window).width(),Math.max(0,u.touches[0].clientX)),B=Math.min($(window).height(),Math.max(0,u.touches[0].clientY)),j=!0,s.addClass("active")}),s.off("touchmove").on("touchmove",function(u){const m=$(window).width(),k=$(window).height(),Q=Math.abs(R-Math.min(m,Math.max(0,u.touches[0].clientX))),Z=Math.abs(B-Math.min(k,Math.max(0,u.touches[0].clientY)));if(R=Math.min(m,Math.max(0,u.touches[0].clientX)),B=Math.min(k,Math.max(0,u.touches[0].clientY)),Z>=Q&&j&&(C=!0,b()),C&&u.cancelable){u.preventDefault(),u.stopPropagation();const rt=s.find(".scroller-thumb-icon").height(),lt=N(s,B+$(window).scrollTop()-rt/2);s.offset({top:lt,left:s.offset().left});const q=e(s,B+$(window).scrollTop());o.updateTextAndProgressBar(),V(s,q),h(s,q),j&&G(q)}j=!1}),s.off("touchend").on("touchend",function(){z(),C&&(s.removeClass("active"),o.scrollToIndex(r-1,!0,0),C=!1,c.find(".dropdown-menu.show").removeClass("show"))})})}async function nt(t){const{bookmarkThreshold:e}=ajaxify.data;if(!X.length||ajaxify.data.postcount<=e||!e)return;const a=ajaxify.data.bookmark||K.getItem("topic:"+ajaxify.data.tid+":bookmark");t=Math.max(t,Math.min(a,ajaxify.data.postcount));const n=X.get(0),h=n.parentNode,f=h.getBoundingClientRect().height,p=1-t/ajaxify.data.postcount;n.style.height=`${f*p}px`;const b=h.querySelector(".scroller-thumb"),l=parseInt(b.style.height,10),y=parseInt(b.style.top||0,10)+l,s=n.querySelector(".meta a");M=Math.min(M,ajaxify.data.postcount-t);function u(m){s.innerText=m,s.setAttribute("aria-disabled",m?"false":"true"),m?s.removeAttribute("tabindex"):s.setAttribute("tabindex",-1)}if(M>0&&f-y>=l){const m=await _.translate(`[[topic:navigator.unread, ${M}]]`);s.href=`${config.relative_path}/topic/${ajaxify.data.slug}/${Math.min(t+1,ajaxify.data.postcount)}`,u(m)}else s.href=ajaxify.data.url,u("")}function z(){S&&(clearInterval(S),S=0)}async function G(t){if(!t||F===t||!c.find(".post-content").is(":visible"))return;F=t;const e=await socket.emit("posts.getPostSummaryByIndex",{tid:ajaxify.data.tid,index:t-1}),a=await app.parseAndTranslate("partials/topic/navigation-post",{post:e});c.find(".post-content").html(a).find(".timeago").timeago()}function ct(){config.usePagination||$(window).off("keydown",J).on("keydown",J)}function J(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey)return;if(t.which===36&&o.toTop)return o.toTop(),!1;if(t.which===35&&o.toBottom)return o.toBottom(),!1}}function U(t){const a=window.location.pathname.replace(config.relative_path,"").split("/");return a[1]+"/"+a[2]+"/"+a[3]+(t?"/"+t:"")}o.getCount=()=>x,o.setCount=function(t){t=parseInt(t,10),t!==x&&(x=t,o.updateTextAndProgressBar(),D(r),Y(x>0))},o.show=function(){Y(!0)},o.disable=function(){x=0,r=1,o.callback=null,o.selector=null,$(window).off("scroll",o.delayedUpdate),Y(!1)};function Y(t){t&&!ajaxify.data.template.topic&&!ajaxify.data.template.category||(c.toggleClass("ready",t),c.toggleClass("noreplies",x<=1))}return o.delayedUpdate=function(){O||(O=setTimeout(function(){o.update(),O=void 0},100))},o.update=function(){let t=r;const e=$(o.selector).filter((y,s)=>!s.getAttribute("data-navigator-ignore"));e.length&&(t=parseInt(e.first().attr("data-index"),10)+1);const a=$(window).scrollTop(),n=$(window).height(),h=$(document).height(),f=a+n/2;let p=Number.MAX_VALUE;e.each(function(){const y=$(this),s=parseInt(y.attr("data-index"),10);if(s>=0){const u=Math.abs(f-(y.offset().top+y.outerHeight(!0)/2));if(u>p)return!1;u<p&&(t=s+1,p=u)}});const b=a===0&&parseInt(e.first().attr("data-index"),10)===0,l=a+n>h-100&&parseInt(e.last().attr("data-index"),10)===x-1;b?t=1:l&&(t=x),i.fire("action:navigator.update",{newIndex:t,index:r}),t!==r&&(typeof o.callback=="function"&&o.callback(t,x),r=t,o.updateTextAndProgressBar(),D(r)),Y(x>0)},o.getIndex=()=>r,o.setIndex=t=>{r=t+1,typeof o.callback=="function"&&o.callback(r,x),o.updateTextAndProgressBar(),D(r)},o.updateTextAndProgressBar=function(){if(!utils.isNumber(r))return;r=r>x?x:r,config.usePagination?W.html(`<i class="fa fa-file"></i> ${ajaxify.data.pagination.currentPage} / ${ajaxify.data.pagination.pageCount}`):W.translateHtml("[[global:pagination.out-of, "+r+", "+x+"]]");const t=(r-1)/(x-1||1);tt.val(t),ot.width(t*100+"%")},o.scrollUp=function(){const t=$(window);if(config.usePagination&&t.scrollTop()<=0)return g.previousPage(function(){$("body,html").scrollTop($(document).height()-t.height())});$("body,html").animate({scrollTop:t.scrollTop()-t.height()})},o.scrollDown=function(){const t=$(window);if(config.usePagination&&t.scrollTop()>=$(document).height()-t.height())return g.nextPage();$("body,html").animate({scrollTop:t.scrollTop()+t.height()})},o.scrollTop=function(t){$(`${o.selector}[data-index="${t}"]:not([data-navigator-ignore])`).length?o.scrollToIndex(t,!0):ajaxify.go(U())},o.scrollBottom=function(t){parseInt(t,10)<0||($(`${o.selector}[data-index="${t}"]:not([data-navigator-ignore])`).length?o.scrollToIndex(t,!0):(t=parseInt(t,10)+1,ajaxify.go(U(t))))},o.scrollToIndex=function(t,e,a){const n=ajaxify.data.template.topic,h=ajaxify.data.template.category;if(!utils.isNumber(t)||!n&&!h)return;if(a=a!==void 0?a:400,o.scrollActive=!0,n&&d.get("post/anchor",t).length)return o.scrollToPostIndex(t,e,a);if(h&&$('[component="category/topic"][data-index="'+t+'"]').length)return o.scrollToTopicIndex(t,e,a);if(!config.usePagination){o.scrollActive=!1,t=parseInt(t,10)+1,ajaxify.go(U(t));return}const f=n?o.scrollToPostIndex:o.scrollToTopicIndex,p=1+Math.floor(t/config.postsPerPage);parseInt(p,10)!==ajaxify.data.pagination.currentPage?g.loadPage(p,function(){f(t,e,a)}):f(t,e,a)},o.shouldScrollToPost=function(t){if(!ajaxify.data.template.topic||t<=1)return!1;const e=$('[component="topic"] [component="post"]').first();return parseInt(e.attr("data-index"),10)!==t-1},o.scrollToPostIndex=function(t,e,a){const n=$(`[component="post"][data-index="${t}"]:not([data-navigator-ignore])`);o.scrollToElement(n,e,a,t)},o.scrollToTopicIndex=function(t,e,a){const n=$('[component="category/topic"][data-index="'+t+'"]');o.scrollToElement(n,e,a,t)},o.scrollToElement=async(t,e,a,n=null)=>{if(!t.length){o.scrollActive=!1;return}await i.fire("filter:navigator.scroll",{scrollTo:t,highlight:e,duration:a,newIndex:n+1});const h=t.outerHeight(!0),f=d.get("navbar").outerHeight(!0)||0,p=$(".topic-main-buttons").outerHeight(!0)||0,b=$(window).height();$(window).off("scroll",o.delayedUpdate),a=a!==void 0?a:400,o.scrollActive=!0;let l=!1;function y(){function u(){setTimeout(()=>{$(window).off("scroll",o.delayedUpdate).on("scroll",o.delayedUpdate),i.fire("action:navigator.scrolled",{scrollTo:t,highlight:e,duration:a,newIndex:n+1})},50)}function m(){if(l){u();return}l=!0,o.scrollActive=!1,s(),n?o.setIndex(n):o.update()}let k=0;if(h<b-f-p?k=t.offset().top-b/2+h/2:k=t.offset().top-f-p,a===0){$(window).scrollTop(k),m(),u();return}$("html, body").animate({scrollTop:k+"px"},a,m)}function s(){e&&($('[component="post"],[component="category/topic"]').removeClass("highlight"),t.addClass("highlight"),setTimeout(function(){t.removeClass("highlight")},1e4))}y()},o}.apply(A,P),w!==void 0&&(E.exports=w)},68636:(E,A,T)=>{var P;P=function(){function w(){this._store={},this._keys=[]}w.prototype.isMock=!0,w.prototype.setItem=function(i,I){i=String(i),this._keys.indexOf(i)===-1&&this._keys.push(i),this._store[i]=I},w.prototype.getItem=function(i){return i=String(i),this._keys.indexOf(i)===-1?null:this._store[i]},w.prototype.removeItem=function(i){i=String(i),this._keys=this._keys.filter(function(I){return I!==i}),this._store[i]=null},w.prototype.clear=function(){this._keys=[],this._store={}},w.prototype.key=function(i){return i=parseInt(i,10)||0,this._keys[i]},Object.defineProperty&&Object.defineProperty(w.prototype,"length",{get:function(){return this._keys.length}});let g;const d=Date.now().toString();try{if(g=window.localStorage,g.setItem(d,d),g.getItem(d)!==d)throw Error("localStorage behaved unexpectedly");return g.removeItem(d),g}catch(i){console.warn(i),console.warn("localStorage failed, falling back on sessionStorage");try{if(g=window.sessionStorage,g.setItem(d,d),g.getItem(d)!==d)throw Error("sessionStorage behaved unexpectedly");return g.removeItem(d),g}catch(I){return console.warn(I),console.warn("sessionStorage failed, falling back on memory storage"),new w}}}.call(A,T,A,E),P!==void 0&&(E.exports=P)}}]);
