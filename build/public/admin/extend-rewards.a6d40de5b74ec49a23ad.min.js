"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[91268],{14488:(w,b,o)=>{var l,c;l=[o(29930),o(65285)],c=function(r){const f={};let d,u,m,h;f.init=function(){d=ajaxify.data.rewards,u=ajaxify.data.active,m=ajaxify.data.conditions,h=ajaxify.data.conditionals,$("[data-selected]").each(function(){k($(this))}),$("#active").on("change","[data-selected]",function(){x($(this))}).on("click",".delete",function(){const a=$(this).parents("[data-id]"),t=a.attr("data-id");return socket.emit("admin.rewards.delete",{id:t},function(e){e?r.error(e):r.success("[[admin/extend/rewards:alert.delete-success]]")}),a.remove(),!1}).on("click",".toggle",function(){const a=$(this);return a.parent().find(".toggle").removeClass("hidden"),a.addClass("hidden"),!1}).sortable({handle:'[component="sort/handle"]',axis:"y",zIndex:9999}),$("#new").on("click",g),$("#save").on("click",E),y()};function k(a){switch(a.val(a.attr("data-selected")),a.attr("name")){case"rid":v(a);break}}function x(a){switch(a.attr("data-selected",a.val()),a.attr("name")){case"rid":v(a);break}}function v(a){const t=a.parents("[data-rid]"),e=t.find(".inputs");let s,n="";for(const i in d)if(d.hasOwnProperty(i)&&d[i].rid===a.attr("data-selected")){s=d[i].inputs,t.attr("data-rid",d[i].rid);break}if(!s)return r.error("[[admin/extend/rewards:alert.no-inputs-found]] "+a.attr("data-selected"));s.forEach(function(i){switch(n+=`<label class="form-label text-nowrap" for="${i.name}">${i.label}<br />`,i.type){case"select":n+=`<select class="form-select form-select-sm" name="${i.name}" >`,i.values.forEach(function(p){n+=`<option value="${p.value}">${p.name}</option>`});break;case"text":n+=`<input type="text" class="form-control form-control-sm" name="${i.name}"  />`;break}n+="</label>"}),e.html(n)}function y(){$("[data-rid]").each(function(a){const t=$(this).find(".inputs"),e=u[a].rewards;for(const s in e)e.hasOwnProperty(s)&&t.find('[name="'+s+'"]').val(e[s])})}function g(){const a=$("#active"),t={active:[{disabled:!0,value:"",claimable:1,rid:null,id:null}],conditions:m,conditionals:h,rewards:d};app.parseAndTranslate("admin/extend/rewards","active",t,function(e){a.append(e),e.find("select").val("")})}function E(){const a=[];$("#active li").each(function(){const t={rewards:{}},e=$(this).find("form.main").serializeArray(),s=$(this).find("form.rewards").serializeArray();e.forEach(function(n){t[n.name]=n.value}),s.forEach(function(n){t.rewards[n.name]=n.value}),t.id=$(this).attr("data-id"),t.disabled=$(this).find(".toggle.disable").hasClass("hidden"),a.push(t)}),socket.emit("admin.rewards.save",a,function(t,e){if(t)return r.error(t);const s=document.getElementById("save");s.classList.toggle("saved",!0),setTimeout(()=>{s.classList.toggle("saved",!1)},5e3),$("#active li").each(function(n){$(this).attr("data-id")||$(this).attr("data-id",e[n].id)})})}return f}.apply(b,l),c!==void 0&&(w.exports=c)}}]);
