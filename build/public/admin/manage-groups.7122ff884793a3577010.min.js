"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[159,99127,34271,69185,86198,1091,26174,49897],{26231:(A,y,s)=>{var u,g;u=[s(65348),s(13230),s(49897),s(40027),s(29930)],g=function(m,p,C,h,i){const t={};t.init=function(){c(),f(),$(".groups-list").on("click","[data-action]",function(){const n=$(this),l=n.attr("data-action"),o=n.parents("tr[data-groupname]").attr("data-groupname");switch(l){case"delete":h.confirm("[[admin/manage/groups:alerts.confirm-delete]]",function(e){e&&C.del(`/groups/${p(o)}`,{}).then(ajaxify.refresh).catch(i.error)});break}})};function c(){$("#create").on("click",function(){app.parseAndTranslate("admin/partials/create_group_modal",{}).then(n=>{n.modal("show"),n.on("shown.bs.modal",function(){const l=$("#create-modal"),o=$("#create-group-name"),e=$("#create-modal-go"),r=$("#create-modal-error");o.trigger("focus"),l.on("keypress",function(a){a.key==="Enter"&&e.trigger("click")}),n.on("hidden.bs.modal",function(){n.modal("hide"),l.remove()}),e.on("click",function(){const a={name:o.val(),description:$("#create-group-desc").val(),private:$("#create-group-private").is(":checked")?1:0,hidden:$("#create-group-hidden").is(":checked")?1:0};C.post("/groups",a).then(d=>{r.addClass("hide"),o.val(""),l.on("hidden.bs.modal",function(){ajaxify.go("admin/manage/groups/"+d.name)}),l.modal("hide")}).catch(d=>{utils.hasLanguageKey(d.status.message)||(d.status.message="[[admin/manage/groups:alerts.create-failure]]"),r.translateHtml(d.status.message).removeClass("hide")})})})})})}function f(){const n=$("#group-search");function l(){if(!n.val())return ajaxify.refresh();$(".pagination").addClass("hide");const o=$(".groups-list");socket.emit("groups.search",{query:n.val(),options:{sort:"date"}},function(e,r){if(e)return i.error(e);app.parseAndTranslate("admin/manage/groups","groups",{groups:r,categories:ajaxify.data.categories},function(a){o.find("[data-groupname]").remove(),o.find("tbody").append(a)})})}n.on("keyup",utils.debounce(l,200))}return t}.apply(y,u),g!==void 0&&(A.exports=g)},49897:(A,y,s)=>{s.r(y),s.d(y,{del:()=>o,get:()=>t,head:()=>c,patch:()=>n,post:()=>f,put:()=>l});var u=s(91749),g=s.n(u),m=s(40027),p=s.n(m);const C=config.relative_path+"/api/v3";async function h(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:C+e.url,typeof r=="function"){i(e).then(a=>r(null,a),a=>r(a));return}try{return await i(e)}catch(a){if(a.message==="A valid login session was not found. Please log in and try again.")return(0,m.confirm)("[[error:api.reauth-required]]",d=>{d&&ajaxify.go("login")});throw a}}async function i(e){const{url:r}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,u.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const a=await fetch(r,e),{headers:d}=a,v=d.get("content-type"),D=v&&v.startsWith("application/json");let E;if(e.method!=="head"&&(D?E=await a.json():E=await a.text()),!a.ok)throw E?new Error(D?E.status.message:E):new Error(a.statusText);return D&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function t(e,r,a){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},a)}function c(e,r,a){return h({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"head"},a)}function f(e,r,a){return h({url:e,method:"post",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function n(e,r,a){return h({url:e,method:"patch",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function l(e,r,a){return h({url:e,method:"put",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}function o(e,r,a){return h({url:e,method:"delete",data:r,headers:{"x-csrf-token":config.csrf_token}},a)}},96349:(A,y,s)=>{var u,g;u=[s(29930),s(89336),s(49897)],g=function(m,p,C){const h={};return h.init=function(i,t){let c=null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let f=[];Array.isArray(t.localCategories)&&(f=t.localCategories.map(r=>({...r}))),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const n=i.find('[component="category-selector-search"]');if(!n.length)return;const l=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;i.on("show.bs.dropdown",function(){l&&(i.find(".dropdown-toggle").css({visibility:"hidden"}),n.removeClass("hidden"),n.css({"z-index":i.find(".dropdown-toggle").css("z-index")+1}));function r(){const a=n.find("input").val();a.length>1||!a&&!c?o(a,function(d){c=t.cacheList&&(c||d),e(d)}):!a&&c&&e(c)}n.on("click",function(a){a.preventDefault(),a.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(r,300)),r()}),i.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||n.find("input").focus()}),i.on("hide.bs.dropdown",function(){l&&(i.find(".dropdown-toggle").css({visibility:"inherit"}),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function o(r,a){C.get("/search/categories",{search:r,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(d,{categories:v}){if(d)return m.error(d);a(f.concat(v))})}function e(r){const a=t.selectedCids.map(String);r.forEach(function(d){d.selected=a.includes(String(d.cid))}),app.parseAndTranslate(t.template,{categoryItems:r.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(d){i.find('[component="category/list"]').html(d.find('[component="category/list"]').html()),i.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!r.length);const v=p.Dropdown.getInstance(i.find(".dropdown-toggle").get(0));v&&v.update()})}},h}.apply(y,u),g!==void 0&&(A.exports=g)},65348:(A,y,s)=>{var u,g;u=[s(96349),s(40027),s(91749),s(17459)],g=function(m,p,C,h){const i={};return i.init=function(t,c){if(!t||!t.length)return;c=c||{};const f=c.onSelect||function(){};c.states=c.states||["watching","tracking","notwatching","ignoring"],c.template=c.template||"partials/category/selector-dropdown-left",C.fire("action:category.selector.options",{el:t,options:c}),m.init(t,c);const n={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const o=$(this);return o.hasClass("disabled")?!1:(n.selectCategory(o.attr("data-cid")),f(n.selectedCategory))});let l=n.el.find('[component="category-selector-selected"]').html();return h.translate(l,o=>{l=o}),n.selectCategory=function(o){const e=n.el.find('[data-cid="'+o+'"]');n.selectedCategory={cid:o,name:e.attr("data-name")},e.length?n.el.find('[component="category-selector-selected"]').html(e.find('[component="category-markup"]').html()):n.el.find('[component="category-selector-selected"]').html(l)},n.getSelectedCategory=function(){return n.selectedCategory},n.getSelectedCid=function(){return n.selectedCategory?n.selectedCategory.cid:0},c.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(c.template,{selectedCategory:c.selectedCategory},function(o){n.el.find('[component="category-selector-selected"]').html(o.find('[component="category-selector-selected"]').html())}),n},i.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(c){const f=p.dialog({title:t.title||"[[modules:composer.select-category]]",message:c,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:l}}}),n=i.init(f.find('[component="category-selector"]'),t);function l(o){return o.preventDefault(),n.selectedCategory&&(t.onSubmit(n.selectedCategory),f.modal("hide")),!1}t.openOnLoad&&f.on("shown.bs.modal",function(){f.find(".dropdown-toggle").dropdown("toggle")}),f.find("form").on("submit",l)})},i}.apply(y,u),g!==void 0&&(A.exports=g)},13230:(A,y,s)=>{var u,g,m;(function(p){g=[s(53050)],u=p,m=typeof u=="function"?u.apply(y,g):u,m!==void 0&&(A.exports=m)})(function(p){const C=p("[^\\p{L}\\s\\d\\-_]","g"),h=/[^\w\s\d\-_]/g,i=/^\s+|\s+$/g,t=/\s+/g,c=/-+/g,f=/-$/g,n=/^-/g,l=/^[\w\d\s.,\-@]+$/;return function(e,r){return e?(e=String(e).replace(i,""),l.test(e)?e=e.replace(h,"-"):e=p.replace(e,C,"-"),e=r?e:e.toLocaleLowerCase(),e=e.replace(t,"-"),e=e.replace(c,"-"),e=e.replace(f,""),e=e.replace(n,""),e):""}})}}]);
