"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[89379,99127,34271,1091,18470,49897],{27693:(x,v,c)=>{var y,k;y=[c(70012),c(57576),c(40027),c(81335),c(49897),c(29930)],k=function(E,R,l,h,m,f){const p={};p.init=function(){E.load("core.api",$(".core-api-settings")),$("#save").on("click",()=>{E.save("core.api",$(".core-api-settings"))});const e=document.querySelectorAll('[data-component="acp/tokens"] [data-action="copy"]');new R(e),$('[data-action="create"]').on("click",t),n()};function n(){const e=document.querySelector("#content form");e&&e.addEventListener("click",s=>{const r=s.target.closest("[data-action]");if(r)switch(r.getAttribute("data-action")){case"edit":i(r);break;case"delete":a(r);break;case"roll":o(r);break}})}async function t(){const e=await h.render("admin/partials/edit-token-modal",{}),s=async function(){const r=this,u=this.get(0).querySelector("form"),d=document.querySelector('[data-component="acp/tokens"] tbody'),g=u.reportValidity();if(u&&g){const D=new FormData(u),O=D.get("uid"),A=D.get("description");try{const P=await m.post("/admin/tokens",{uid:O,description:A});if(!d)return r.modal("hide"),ajaxify.refresh();ajaxify.data.tokens.push(P);const S=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[P]})).get(0);d.append(S),$(S).find(".timeago").timeago(),r.modal("hide")}catch(P){f.error(P)}}return!1};l.dialog({title:"[[admin/settings/api:create-token]]",message:e,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:s}}})}async function i(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token"),{uid:u,description:d}=await m.get(`/admin/tokens/${r}`),g=async function(){const O=this,A=this.get(0).querySelector("form"),P=A.reportValidity();if(A&&P){const S=new FormData(A),C=S.get("uid"),j=S.get("description");try{const T=await m.put(`/admin/tokens/${r}`,{uid:C,description:j}),w=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[T]})).get(0);s.replaceWith(w),$(w).find(".timeago").timeago(),O.modal("hide")}catch(T){f.error(T)}}return!1},D=await h.render("admin/partials/edit-token-modal",{uid:u,description:d});l.dialog({title:"[[admin/settings/api:update-token]]",message:D,buttons:{submit:{label:"[[modules:bootbox.submit]]",className:"btn-primary",callback:g}}})}async function a(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token");l.confirm("[[admin/settings/api:delete-confirm]]",async u=>{if(u){try{await m.del(`/admin/tokens/${r}`)}catch(d){f.error(d)}s.remove()}})}async function o(e){const s=e.closest("[data-token]"),r=s.getAttribute("data-token");l.confirm("[[admin/settings/api:roll-confirm]]",async u=>{if(u)try{const d=await m.post(`/admin/tokens/${r}/roll`),g=(await app.parseAndTranslate(ajaxify.data.template.name,"tokens",{tokens:[d]})).get(0);s.replaceWith(g),$(g).find(".timeago").timeago()}catch(d){f.error(d)}})}return p}.apply(v,y),k!==void 0&&(x.exports=k)},49897:(x,v,c)=>{c.r(v),c.d(v,{del:()=>a,get:()=>f,head:()=>p,patch:()=>t,post:()=>n,put:()=>i});var y=c(91749),k=c.n(y),E=c(40027),R=c.n(E);const l=config.relative_path+"/api/v3";async function h(o,e){if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:l+o.url,typeof e=="function"){m(o).then(s=>e(null,s),s=>e(s));return}try{return await m(o)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again.")return(0,E.confirm)("[[error:api.reauth-required]]",r=>{r&&ajaxify.go("login")});throw s}}async function m(o){const{url:e}=o;delete o.url,o.data&&!(o.data instanceof FormData)&&(o.data=JSON.stringify(o.data||{}),o.headers["content-type"]="application/json; charset=utf-8"),{options:o}=await(0,y.fire)("filter:api.options",{options:o}),o.data&&(o.body=o.data,delete o.data);const s=await fetch(e,o),{headers:r}=s,u=r.get("content-type"),d=u&&u.startsWith("application/json");let g;if(o.method!=="head"&&(d?g=await s.json():g=await s.text()),!s.ok)throw g?new Error(d?g.status.message:g):new Error(s.statusText);return d&&g&&g.hasOwnProperty("status")&&g.hasOwnProperty("response")?g.response:g}function f(o,e,s){return h({url:o+(e&&Object.keys(e).length?"?"+$.param(e):"")},s)}function p(o,e,s){return h({url:o+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},s)}function n(o,e,s){return h({url:o,method:"post",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function t(o,e,s){return h({url:o,method:"patch",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function i(o,e,s){return h({url:o,method:"put",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}function a(o,e,s){return h({url:o,method:"delete",data:e,headers:{"x-csrf-token":config.csrf_token}},s)}},70012:(x,v,c)=>{var y,k;y=[c(91749),c(29930)],k=function(E,R){let l,h=[],m=0,f;function p(n,t){typeof n!="string"&&(n=$(n),n=n.data("type")||n.attr("type")||n.prop("tagName"));const i=l.plugins[n.toLowerCase()];if(i==null)return;const a=i[t];return typeof a=="function"?a:null}return f={deepClone:function(n){return typeof n=="object"?JSON.parse(JSON.stringify(n)):n},createElement:function(n,t,i){const a=document.createElement(n);for(const o in t)t.hasOwnProperty(o)&&a.setAttribute(o,t[o]);return i&&a.appendChild(document.createTextNode(i)),a},initElement:function(n){const t=p(n,"init");t?.call(l,$(n))},destructElement:function(n){const t=p(n,"destruct");t?.call(l,$(n))},createElementOfType:function(n,t,i){let a;const o=p(n,"create");return o!=null?a=$(o.call(l,n,t,i)):(i==null&&(i={}),n!=null&&(i.type=n),a=$(f.createElement(t||"input",i))),a.data("type",n),f.initElement(a),a},cleanArray:function(n,t,i){const a=[];if(!t&&i)return n;for(let o=0;o<n.length;o+=1){let e=n[o];t&&(e===!!e?e=+e:e&&typeof e.trim=="function"&&(e=e.trim())),(i||e!=null&&e.length)&&a.push(e)}return a},isTrue:function(n){return n==="true"||+n==1},isFalse:function(n){return n==="false"||+n==0},readValue:function(n){let t=!f.isFalse(n.data("empty"));const i=!f.isFalse(n.data("trim")),a=n.data("split"),o=p(n,"get");let e;if(o!=null)return o.call(l,n,i,t);if(a!=null){t=f.isTrue(n.data("empty")),e=n.val();const s=e!=null&&e.split(a||",")||[];return f.cleanArray(s,i,t)}if(e=n.val(),i&&e!=null&&typeof e.trim=="function"&&(e=e.trim()),t||e!==void 0&&(e==null||e.length!==0))return e},fillField:function(n,t){const i=p(n,"set");let a=n.data("trim");if(a=a!=="false"&&+a!=0,i!=null)return i.call(l,n,t,a);t instanceof Array&&(t=t.join(n.data("split")||(a?", ":","))),a&&t&&typeof t.trim=="function"?(t=t.trim(),typeof t.toString=="function"&&(t=t.toString())):t!=null?(typeof t.toString=="function"&&(t=t.toString()),a&&(t=t.trim())):t="",t!==void 0&&n.val(t)},initFields:function(n){$("[data-key]",n).each(function(t,i){i=$(i);const a=p(i,"init"),o=i.data("key").split(".");let e=l.get();a?.call(l,i);for(let s=0;s<o.length;s+=1){const r=o[s];r&&e!=null&&(e=e[r])}f.fillField(i,e)})},registerReadyJobs:function(n){return m+=n,m},beforeReadyJobsDecreased:function(n){if(n==null&&(n=1),m>0&&(m-=n,m<=0)){for(let t=0;t<h.length;t+=1)h[t]();h=[]}},whenReady:function(n){m<=0?n():h.push(n)},serializeForm:function(n){const t=n.serializeObject();return n.find('input[type="checkbox"]').each(function(i,a){a=$(a),a.is(":checked")||(t[a.attr("name")]="off")}),n.find("select[multiple]").each(function(i,a){a=$(a),t[a.attr("name")]=JSON.stringify(a.val())}),t},persistSettings:function(n,t,i,a){t!=null&&t._!=null&&typeof t._!="string"&&(t=f.deepClone(t),t._=JSON.stringify(t._)),socket.emit("admin.settings.set",{hash:n,values:t},function(o){i&&(o?R.alert({title:"[[admin/admin:changes-not-saved]]",type:"danger",message:`[[admin/admin/changes-not-saved-message, ${o.message}]]`,timeout:5e3}):R.alert({title:"[[admin/admin:changes-saved]]",type:"success",message:"[[admin/admin:changes-saved-message]]",timeout:2500})),typeof a=="function"&&a(o)})},use:function(n){try{n._=JSON.parse(n._)}catch{}l.cfg=n}},l={helper:f,plugins:{},cfg:{},get:function(){return l.cfg!=null&&l.cfg._!==void 0?l.cfg._:l.cfg},registerPlugin:function(n,t){t==null?t=n.types:n.types=t,typeof n.use=="function"&&n.use.call(l);for(let i=0;i<t.length;i+=1){const a=t[i].toLowerCase();l.plugins[a]==null&&(l.plugins[a]=n)}},set:function(n,t,i,a,o){o==null&&(o=!0),f.whenReady(function(){f.use(t),f.initFields(i||"form"),f.persistSettings(n,t,o,a)})},sync:function(n,t,i){socket.emit("admin.settings.get",{hash:n},function(a,o){a?typeof i=="function"&&i(a):f.whenReady(function(){f.use(o),f.initFields(t||"form"),typeof i=="function"&&i()})})},persist:function(n,t,i,a){const o=[],e=$("[data-key]",t||"form").toArray();a==null&&(a=!0);for(let s=0;s<e.length;s+=1){const r=$(e[s]),u=f.readValue(r);let d=l.get();const g=r.data("key").split("."),D=g[g.length-1];if(g.length>1)for(let O=0;O<g.length-1;O+=1){const A=g[O];A&&d!=null&&(d=d[A])}d!=null?u!=null?d[D]=u:delete d[D]:o.push(r.data("key"))}o.length&&R.alert({title:"Attributes Not Saved",message:"'"+o.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3}),f.persistSettings(n,l.cfg,a,i)},load:function(n,t,i){i=i||function(){};const a=t.attr("data-socket-get");socket.emit(a||"admin.settings.get",{hash:n},function(o,e){if(o)return i(o);$(t).find("select[multiple]").each(function(r,u){const d=$(u).attr("name");if(d&&e.hasOwnProperty(d))try{e[d]=JSON.parse(e[d])}catch{}}),ajaxify.data[a?n:"settings"]=e,f.whenReady(function(){$(t).find("[data-sorted-list]").each(function(r,u){p(u,"get").call(l,$(u),n)})}),$(t).deserialize(e),E.fire("action:admin.settingsLoaded"),$(t).on("change","input, select, textarea",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const s=document.getElementById("save");s&&c.e(6411).then(function(){var r=[c(6411)];(function(u){u.bind("ctrl+s",function(d){s.click(),d.preventDefault()})}).apply(null,r)}).catch(c.oe),i(null,e)})},save:function(n,t,i){t=$(t);const a=t.get(0).elements;if(l.check(a)&&t.length){const e=f.serializeForm(t);f.whenReady(function(){const r=t.find("[data-sorted-list]");r.length&&r.each((u,d)=>{p(d,"set").call(l,$(d),e)})});const s=t.attr("data-socket-set");socket.emit(s||"admin.settings.set",{hash:n,values:e},function(r){if(app.flags._unsaved=!1,ajaxify.data[s?n:"settings"]=e,typeof i=="function")i(r);else if(r)R.alert({title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${r.message}]]`,type:"error",timeout:2500});else{const u=document.getElementById("save");u.classList.toggle("saved",!0),setTimeout(()=>{u.classList.toggle("saved",!1)},1500)}})}},check:function(n){const t=i=>{const a=i.target.closest(".form-group");a&&a.classList.add("has-error"),i.target.removeEventListener("invalid",t)};return Array.prototype.map.call(n,i=>{const a=i.closest(".form-group");return a&&a.classList.remove("has-error"),i.addEventListener("invalid",t),i.reportValidity()}).every(Boolean)}},f.registerReadyJobs(1),Promise.all([c.e(23662),c.e(65285),c.e(19308)]).then(function(){var n=[c(75210),c(474),c(50397),c(71575),c(40054),c(17708),c(46700),c(59175)];(function(){for(let t=0;t<arguments.length;t+=1)l.registerPlugin(arguments[t]);f.beforeReadyJobsDecreased()}).apply(null,n)}).catch(c.oe),l}.apply(v,y),k!==void 0&&(x.exports=k)}}]);
