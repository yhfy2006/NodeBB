"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[83931,99127,34271,69185,86198,1091,49897],{86871:(w,b,d)=>{var p,y;p=[d(24187),d(67308),d(65348),d(81335),d(49897),d(40027),d(29930),d(54222)],y=function(E,x,v,m,g,t,r,h){const i={};let u={};i.init=function(){const a=$("#category-settings"),e=$('[component="category/preview"]');a.find("select").each(function(){const n=$(this);n.val(n.attr("data-value"))}),v.init($('[component="settings/main/header"] [component="category-selector"]'),{onSelect:function(n){ajaxify.go("admin/manage/categories/"+n.cid)},cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),v.init($('#parent-category-selector [component="category-selector"]'),{onSelect:function(n){const o=$("#parent-cid");o.val(n.cid),s(o[0])},selectedCategory:ajaxify.data.category.parent,localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-list"}],cacheList:!1,showLinks:!0,template:"admin/partials/category/selector-dropdown-right"}),c(),a.find("input, select, textarea").on("change",function(n){s(n.target)}),$('[type="checkbox"]').on("change",function(){s($(this))}),$('[data-name="imageClass"]').on("change",function(){$(".category-preview").css("background-size",$(this).val())}),$('[data-name="bgColor"], [data-name="color"]').on("input",function(){const n=$(this);n.attr("data-name")==="bgColor"?e.css("background-color",n.val()):n.attr("data-name")==="color"&&e.css("color",n.val()),s(n[0])}),$("#save").on("click",function(){const n=$("#tag-whitelist").val()?$("#tag-whitelist").val().split(","):[];if(n.length&&n.length<parseInt($("#cid-min-tags").val(),10))return r.error("[[admin/manage/categories:alert.not-enough-whitelisted-tags]]");const o=ajaxify.data.category.cid;return g.put("/categories/"+o,u).then(()=>{app.flags._unsaved=!1,h.toggleSaveSuccess($("#save")),u={}}).catch(r.error),!1}),$(".purge").on("click",function(n){n.preventDefault(),m.render("admin/partials/categories/purge",{name:ajaxify.data.category.name,topic_count:ajaxify.data.category.topic_count}).then(function(o){const f=t.dialog({title:"[[admin/manage/categories:purge]]",message:o,size:"large",buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){f.find(".modal-footer button").prop("disabled",!0);const l=setInterval(async()=>{if(ajaxify.data.category)try{const{count:C}=await g.get(`/categories/${ajaxify.data.category.cid}/count`);let k=0;ajaxify.data.category.topic_count>0&&(k=Math.max(0,1-C/ajaxify.data.category.topic_count)*100),f.find(".progress-bar").css({width:k+"%"})}catch(C){clearInterval(l),r.error(C)}},1e3);return g.del("/categories/"+ajaxify.data.category.cid).then(()=>{setTimeout(()=>{l&&clearInterval(l),f.modal("hide"),r.success("[[admin/manage/categories:alert.purge-success]]"),ajaxify.go("admin/manage/categories")},5e3)}).catch(r.error),!1}}}})})}),$(".copy-settings").on("click",function(){return m.render("admin/partials/categories/copy-settings",{}).then(function(n){let o;const f=t.dialog({title:"[[modules:composer.select-category]]",message:n,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){if(!(!o||parseInt(o,10)===parseInt(ajaxify.data.category.cid,10)))return socket.emit("admin.categories.copySettingsFrom",{fromCid:o,toCid:ajaxify.data.category.cid,copyParent:f.find("#copyParent").prop("checked")},function(l){if(l)return r.error(l);f.modal("hide"),alert.success("[[admin/manage/categories:alert.copy-success]]"),ajaxify.refresh()}),!1}}}});f.find(".modal-footer button").prop("disabled",!0),v.init(f.find('[component="category-selector"]'),{onSelect:function(l){o=l&&l.cid,o&&f.find(".modal-footer button").prop("disabled",!1)},showLinks:!0})}),!1}),$(".upload-button").on("click",function(){const o=$(this).attr("data-cid");E.show({title:"[[admin/manage/categories:alert.upload-image]]",route:config.relative_path+"/api/admin/category/uploadpicture",params:{cid:o}},function(f){$("#category-image").val(f),e.css("background-image","url("+f+"?"+new Date().getTime()+")"),s($("#category-image"))})}),$("#category-image").on("change",function(){e.css("background-image",$(this).val()?'url("'+$(this).val()+'")':""),s($("#category-image"))}),$(".delete-image").on("click",function(n){n.preventDefault();const o=$("#category-image");o.val(""),e.css("background-image",""),s(o[0])}),e.on("click",function(){x.init($(this).find("i"),s)}),$('button[data-action="toggle"]').on("click",function(){const n=$(this),o=n.attr("data-disabled")==="1";g.put("/categories/"+ajaxify.data.category.cid,{disabled:o?0:1}).then(()=>{n.find(".label").translateText(o?"[[admin/manage/categories:disable]]":"[[admin/manage/categories:enable]]"),n.find("i").toggleClass(["fa-check","text-success"],!o).toggleClass(["fa-ban","text-danger"],o),n.attr("data-disabled",o?0:1)}).catch(r.error)})};function s(a){let e;$(a).is(":checkbox")?e=$(a).is(":checked")?1:0:e=$(a).val();const o=$(a).attr("data-name").match(/[^\][.]+/g);function f(l,C){C!==o.length&&(l[o[C]]=l[o[C]]||{},C===o.length-1&&(l[o[C]]=e),f(l[o[C]],C+1))}o&&o.length&&(o.length===1?u[o[0]]=e:o.length>1&&f(u,0)),app.flags=app.flags||{},app.flags._unsaved=!0}function c(){const a=$("#tag-whitelist");a.tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),ajaxify.data.category.tagWhitelist.forEach(function(e){a.tagsinput("add",e)}),a.on("itemAdded itemRemoved",function(){s(a)})}return i}.apply(b,p),y!==void 0&&(w.exports=y)},49897:(w,b,d)=>{d.r(b),d.d(b,{del:()=>s,get:()=>t,head:()=>r,patch:()=>i,post:()=>h,put:()=>u});var p=d(91749),y=d.n(p),E=d(40027),x=d.n(E);const v=config.relative_path+"/api/v3";async function m(c,a){if(c.url=c.url.startsWith("/api")?config.relative_path+c.url:v+c.url,typeof a=="function"){g(c).then(e=>a(null,e),e=>a(e));return}try{return await g(c)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again.")return(0,E.confirm)("[[error:api.reauth-required]]",n=>{n&&ajaxify.go("login")});throw e}}async function g(c){const{url:a}=c;delete c.url,c.data&&!(c.data instanceof FormData)&&(c.data=JSON.stringify(c.data||{}),c.headers["content-type"]="application/json; charset=utf-8"),{options:c}=await(0,p.fire)("filter:api.options",{options:c}),c.data&&(c.body=c.data,delete c.data);const e=await fetch(a,c),{headers:n}=e,o=n.get("content-type"),f=o&&o.startsWith("application/json");let l;if(c.method!=="head"&&(f?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(f?l.status.message:l):new Error(e.statusText);return f&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function t(c,a,e){return m({url:c+(a&&Object.keys(a).length?"?"+$.param(a):"")},e)}function r(c,a,e){return m({url:c+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},e)}function h(c,a,e){return m({url:c,method:"post",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function i(c,a,e){return m({url:c,method:"patch",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function u(c,a,e){return m({url:c,method:"put",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}function s(c,a,e){return m({url:c,method:"delete",data:a,headers:{"x-csrf-token":config.csrf_token}},e)}},96349:(w,b,d)=>{var p,y;p=[d(29930),d(89336),d(49897)],y=function(E,x,v){const m={};return m.init=function(g,t){let r=null;t=t||{},t.privilege=t.privilege||"topics:read",t.states=t.states||["watching","tracking","notwatching","ignoring"],t.cacheList=t.hasOwnProperty("cacheList")?t.cacheList:!0;let h=[];Array.isArray(t.localCategories)&&(h=t.localCategories.map(a=>({...a}))),t.selectedCids=t.selectedCids||ajaxify.data.selectedCids||[];const i=g.find('[component="category-selector-search"]');if(!i.length)return;const u=i.parent('[component="category/dropdown"]').length>0||i.parent('[component="category-selector"]').length>0;g.on("show.bs.dropdown",function(){u&&(g.find(".dropdown-toggle").css({visibility:"hidden"}),i.removeClass("hidden"),i.css({"z-index":g.find(".dropdown-toggle").css("z-index")+1}));function a(){const e=i.find("input").val();e.length>1||!e&&!r?s(e,function(n){r=t.cacheList&&(r||n),c(n)}):!e&&r&&c(r)}i.on("click",function(e){e.preventDefault(),e.stopPropagation()}),i.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),g.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||i.find("input").focus()}),g.on("hide.bs.dropdown",function(){u&&(g.find(".dropdown-toggle").css({visibility:"inherit"}),i.addClass("hidden")),i.off("click"),i.find("input").off("keyup")});function s(a,e){v.get("/search/categories",{search:a,query:utils.params(),parentCid:t.parentCid||0,selectedCids:t.selectedCids,privilege:t.privilege,states:t.states,showLinks:t.showLinks},function(n,{categories:o}){if(n)return E.error(n);e(h.concat(o))})}function c(a){const e=t.selectedCids.map(String);a.forEach(function(n){n.selected=e.includes(String(n.cid))}),app.parseAndTranslate(t.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(n){g.find('[component="category/list"]').html(n.find('[component="category/list"]').html()),g.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length);const o=x.Dropdown.getInstance(g.find(".dropdown-toggle").get(0));o&&o.update()})}},m}.apply(b,p),y!==void 0&&(w.exports=y)},65348:(w,b,d)=>{var p,y;p=[d(96349),d(40027),d(91749),d(17459)],y=function(E,x,v,m){const g={};return g.init=function(t,r){if(!t||!t.length)return;r=r||{};const h=r.onSelect||function(){};r.states=r.states||["watching","tracking","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",v.fire("action:category.selector.options",{el:t,options:r}),E.init(t,r);const i={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const s=$(this);return s.hasClass("disabled")?!1:(i.selectCategory(s.attr("data-cid")),h(i.selectedCategory))});let u=i.el.find('[component="category-selector-selected"]').html();return m.translate(u,s=>{u=s}),i.selectCategory=function(s){const c=i.el.find('[data-cid="'+s+'"]');i.selectedCategory={cid:s,name:c.attr("data-name")},c.length?i.el.find('[component="category-selector-selected"]').html(c.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(u)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(s){i.el.find('[component="category-selector-selected"]').html(s.find('[component="category-selector-selected"]').html())}),i},g.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(r){const h=x.dialog({title:t.title||"[[modules:composer.select-category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:u}}}),i=g.init(h.find('[component="category-selector"]'),t);function u(s){return s.preventDefault(),i.selectedCategory&&(t.onSubmit(i.selectedCategory),h.modal("hide")),!1}t.openOnLoad&&h.on("shown.bs.modal",function(){h.find(".dropdown-toggle").dropdown("toggle")}),h.find("form").on("submit",u)})},g}.apply(b,p),y!==void 0&&(w.exports=y)}}]);
