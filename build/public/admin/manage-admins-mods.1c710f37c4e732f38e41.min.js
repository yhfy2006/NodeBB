"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[37759,99127,34271,13417,69185,86198,1091,49897,34405],{3665:(v,C,s)=>{var h,g;h=[s(34405),s(49897),s(40027),s(29930),s(65348)],g=function(p,y,f,u,l){const n={};return n.init=function(){p.user($("#admin-search"),function(e,o){socket.emit("admin.user.makeAdmins",[o.item.user.uid],function(t){if(t)return u.error(t);$("#admin-search").val(""),!$('.administrator-area [data-uid="'+o.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","admins.members",{admins:{members:[o.item.user]}},function(c){$(".administrator-area").prepend(c)})})}),$(".administrator-area").on("click",".remove-user-icon",function(){const e=$(this).parents("[data-uid]"),o=e.attr("data-uid");if(parseInt(o,10)===parseInt(app.user.uid,10))return u.error("[[admin/manage/users:alerts.no-remove-yourself-admin]]");f.confirm("[[admin/manage/users:alerts.confirm-remove-admin]]",function(t){t&&socket.emit("admin.user.removeAdmins",[o],function(c){if(c)return u.error(c.message);e.remove()})})}),p.user($("#global-mod-search"),function(e,o){y.put("/groups/global-moderators/membership/"+o.item.user.uid).then(()=>{$("#global-mod-search").val(""),!$('.global-moderator-area [data-uid="'+o.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[o.item.user]}},function(t){$(".global-moderator-area").prepend(t),$("#no-global-mods-warning").addClass("hidden")})}).catch(u.error)}),$(".global-moderator-area").on("click",".remove-user-icon",function(){const e=$(this).parents("[data-uid]"),o=e.attr("data-uid");f.confirm("[[admin/manage/users:alerts.confirm-remove-global-mod]]",function(t){t&&y.del("/groups/global-moderators/membership/"+o).then(()=>{e.remove(),$(".global-moderator-area").children().length||$("#no-global-mods-warning").removeClass("hidden")}).catch(u.error)})}),l.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(e){ajaxify.go("admin/manage/admins-mods"+(e.cid?"?cid="+e.cid:""))},localCategories:[]}),p.user($(".moderator-search"),function(e,o){const t=$(e.target),c=$(e.target).attr("data-cid");y.put(`/categories/${c}/moderator/${o.item.user.uid}`,{},function(d){if(d)return u.error(d);t.val(""),!$('.moderator-area[data-cid="'+c+'"] [data-uid="'+o.item.user.uid+'"]').length&&app.parseAndTranslate("admin/manage/admins-mods","globalMods.members",{globalMods:{members:[o.item.user]}},function(a){$('.moderator-area[data-cid="'+c+'"]').prepend(a),$('.no-moderator-warning[data-cid="'+c+'"]').addClass("hidden")})})}),$(".moderator-area").on("click",".remove-user-icon",function(){const e=$(this).parents("[data-cid]"),o=e.attr("data-cid"),t=$(this).parents("[data-uid]"),c=t.attr("data-uid");f.confirm("[[admin/manage/users:alerts.confirm-remove-moderator]]",function(d){d&&y.del(`/categories/${o}/moderator/${c}`,{},function(a){if(a)return u.error(a);t.remove(),e.children().length||$('.no-moderator-warning[data-cid="'+o+'"]').removeClass("hidden")})})})},n}.apply(C,h),g!==void 0&&(v.exports=g)},49897:(v,C,s)=>{s.r(C),s.d(C,{del:()=>d,get:()=>n,head:()=>e,patch:()=>t,post:()=>o,put:()=>c});var h=s(91749),g=s.n(h),p=s(40027),y=s.n(p);const f=config.relative_path+"/api/v3";async function u(a,i){if(a.url=a.url.startsWith("/api")?config.relative_path+a.url:f+a.url,typeof i=="function"){l(a).then(r=>i(null,r),r=>i(r));return}try{return await l(a)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again.")return(0,p.confirm)("[[error:api.reauth-required]]",m=>{m&&ajaxify.go("login")});throw r}}async function l(a){const{url:i}=a;delete a.url,a.data&&!(a.data instanceof FormData)&&(a.data=JSON.stringify(a.data||{}),a.headers["content-type"]="application/json; charset=utf-8"),{options:a}=await(0,h.fire)("filter:api.options",{options:a}),a.data&&(a.body=a.data,delete a.data);const r=await fetch(i,a),{headers:m}=r,b=m.get("content-type"),A=b&&b.startsWith("application/json");let E;if(a.method!=="head"&&(A?E=await r.json():E=await r.text()),!r.ok)throw E?new Error(A?E.status.message:E):new Error(r.statusText);return A&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function n(a,i,r){return u({url:a+(i&&Object.keys(i).length?"?"+$.param(i):"")},r)}function e(a,i,r){return u({url:a+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"head"},r)}function o(a,i,r){return u({url:a,method:"post",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function t(a,i,r){return u({url:a,method:"patch",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function c(a,i,r){return u({url:a,method:"put",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function d(a,i,r){return u({url:a,method:"delete",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}},34405:(v,C,s)=>{var h,g;h=[s(49897),s(29930)],g=function(p,y){const f={},u={delay:200,appendTo:null};f.init=n=>{const e={...u,...n},{input:o,onSelect:t}=e;app.loadJQueryUI(function(){o.autocomplete({...e,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,d){l(o,t,c,d)}})})},f.user=function(n,e,o){typeof e=="function"&&(o=e,e={}),e=e||{},f.init({input:n,onSelect:o,source:(t,c)=>{e.query=t.term,p.get("/api/users",e,function(d,a){if(d)return y.error(d);if(a&&a.users){const i=a.users.map(function(r){const m=$("<div></div>").html(r.username).text();return r&&{label:m,value:m,user:{uid:r.uid,name:r.username,slug:r.userslug,username:r.username,userslug:r.userslug,picture:r.picture,banned:r.banned,"icon:text":r["icon:text"],"icon:bgColor":r["icon:bgColor"]}}});c(i)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.group=function(n,e){f.init({input:n,onSelect:e,source:(o,t)=>{socket.emit("groups.search",{query:o.term},function(c,d){if(c)return y.error(c);if(d&&d.length){const a=d.map(function(i){return i&&{label:i.name,value:i.name,group:i}});t(a)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.tag=function(n,e){f.init({input:n,onSelect:e,delay:100,source:(o,t)=>{socket.emit("topics.autocompleteTags",{query:o.term,cid:ajaxify.data.cid||0},function(c,d){if(c)return y.error(c);d&&t(d),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function l(n,e,o,t){e=e||function(){};const c=jQuery.Event("keypress");c.which=13,c.keyCode=13,setTimeout(function(){n.trigger(c)},100),e(o,t)}return f}.apply(C,h),g!==void 0&&(v.exports=g)},96349:(v,C,s)=>{var h,g;h=[s(29930),s(89336),s(49897)],g=function(p,y,f){const u={};return u.init=function(l,n){let e=null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let o=[];Array.isArray(n.localCategories)&&(o=n.localCategories.map(i=>({...i}))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const t=l.find('[component="category-selector-search"]');if(!t.length)return;const c=t.parent('[component="category/dropdown"]').length>0||t.parent('[component="category-selector"]').length>0;l.on("show.bs.dropdown",function(){c&&(l.find(".dropdown-toggle").css({visibility:"hidden"}),t.removeClass("hidden"),t.css({"z-index":l.find(".dropdown-toggle").css("z-index")+1}));function i(){const r=t.find("input").val();r.length>1||!r&&!e?d(r,function(m){e=n.cacheList&&(e||m),a(m)}):!r&&e&&a(e)}t.on("click",function(r){r.preventDefault(),r.stopPropagation()}),t.find("input").val("").on("keyup",utils.debounce(i,300)),i()}),l.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||t.find("input").focus()}),l.on("hide.bs.dropdown",function(){c&&(l.find(".dropdown-toggle").css({visibility:"inherit"}),t.addClass("hidden")),t.off("click"),t.find("input").off("keyup")});function d(i,r){f.get("/search/categories",{search:i,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(m,{categories:b}){if(m)return p.error(m);r(o.concat(b))})}function a(i){const r=n.selectedCids.map(String);i.forEach(function(m){m.selected=r.includes(String(m.cid))}),app.parseAndTranslate(n.template,{categoryItems:i.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(m){l.find('[component="category/list"]').html(m.find('[component="category/list"]').html()),l.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!i.length);const b=y.Dropdown.getInstance(l.find(".dropdown-toggle").get(0));b&&b.update()})}},u}.apply(C,h),g!==void 0&&(v.exports=g)},65348:(v,C,s)=>{var h,g;h=[s(96349),s(40027),s(91749),s(17459)],g=function(p,y,f,u){const l={};return l.init=function(n,e){if(!n||!n.length)return;e=e||{};const o=e.onSelect||function(){};e.states=e.states||["watching","tracking","notwatching","ignoring"],e.template=e.template||"partials/category/selector-dropdown-left",f.fire("action:category.selector.options",{el:n,options:e}),p.init(n,e);const t={el:n,selectedCategory:null};n.on("click","[data-cid]",function(){const d=$(this);return d.hasClass("disabled")?!1:(t.selectCategory(d.attr("data-cid")),o(t.selectedCategory))});let c=t.el.find('[component="category-selector-selected"]').html();return u.translate(c,d=>{c=d}),t.selectCategory=function(d){const a=t.el.find('[data-cid="'+d+'"]');t.selectedCategory={cid:d,name:a.attr("data-name")},a.length?t.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(c)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},e.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(e.template,{selectedCategory:e.selectedCategory},function(d){t.el.find('[component="category-selector-selected"]').html(d.find('[component="category-selector-selected"]').html())}),t},l.modal=function(n){n=n||{},n.onSelect=n.onSelect||function(){},n.onSubmit=n.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:n.message},function(e){const o=y.dialog({title:n.title||"[[modules:composer.select-category]]",message:e,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:c}}}),t=l.init(o.find('[component="category-selector"]'),n);function c(d){return d.preventDefault(),t.selectedCategory&&(n.onSubmit(t.selectedCategory),o.modal("hide")),!1}n.openOnLoad&&o.on("shown.bs.modal",function(){o.find(".dropdown-toggle").dropdown("toggle")}),o.find("form").on("submit",c)})},l}.apply(C,h),g!==void 0&&(v.exports=g)}}]);
