"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[92747,22765],{92747:(h,g,p)=>{var u,a;u=[p(49897),p(40027),p(29930),p(2269)],a=function(l,c,n){const r={},b={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};r.open=function(t){config.enablePostHistory&&l.get(`/posts/${t}/diffs`,{}).then(o=>{d(o).then(i=>{const e=c.dialog({title:"[[topic:diffs.title]]",message:i,size:"large",onEscape:!0,backdrop:!0});if(!o.timestamps.length)return;const s=e.find("select"),f=e.find('button[data-action="restore"]'),m=e.find('button[data-action="delete"]'),_=e.find("ul.posts-list"),E=e.find(".number-of-diffs strong");s.on("change",function(){r.load(t,this.value,_),f.prop("disabled",o.timestamps.indexOf(this.value)===0),m.prop("disabled",o.timestamps.indexOf(this.value)===0)}),f.on("click",function(){r.restore(t,s.val(),e)}),m.on("click",function(){r.delete(t,s.val(),s,E)}),e.on("shown.bs.modal",function(){r.load(t,s.val(),_),f.prop("disabled",!0),m.prop("disabled",!0)})})}).catch(n.error)},r.load=function(t,o,i){config.enablePostHistory&&l.get(`/posts/${t}/diffs/${o}`,{}).then(e=>{e.deleted=!!parseInt(e.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[e]},function(s){i.empty().append(s),i.find(".timeago").timeago()})}).catch(n.error)},r.restore=function(t,o,i){config.enablePostHistory&&l.put(`/posts/${t}/diffs/${o}`,{}).then(()=>{i.modal("hide"),n.success("[[topic:diffs.post-restored]]")}).catch(n.error)},r.delete=function(t,o,i,e){l.del(`/posts/${t}/diffs/${o}`).then(s=>{d(s,"diffs").then(f=>{i.empty().append(f),i.trigger("change");const m=i.find("option").length;e.text(m),n.success("[[topic:diffs.deleted]]")})}).catch(n.error)};function d(t,o){return new Promise(i=>{const e=[{diffs:t.revisions.map(function(s){const f=parseInt(s.timestamp,10);return{username:s.username,timestamp:f,pretty:new Date(f).toLocaleString(config.userLang.replace("_","-"),b)}}),numDiffs:t.timestamps.length,editable:t.editable,deletable:t.deletable},function(s){i(s)}];o&&e.unshift(o),app.parseAndTranslate("modals/post-history",...e)})}return r}.apply(g,u),a!==void 0&&(h.exports=a)},2269:(h,g)=>{var p,u;p=[],u=function(){const a={},l=/-resized(\.[\w]+)?$/;return a.wrapImagesInLinks=function(c){c.find('[component="post/content"] img:not(.emoji)').each(function(){a.wrapImageInLink($(this))})},a.wrapImageInLink=function(c){let n=c.attr("src")||"";if(n!=="about:blank"&&!c.parent().is("a")){utils.isRelativeUrl(n)&&l.test(n)&&(n=n.replace(l,"$1"));const r=c.attr("alt")||"",b=n.split(".").slice(1).pop(),d=r.split("/").pop(),t=d.split(".").slice(1).pop();c.wrap('<a href="'+n+'" '+(!b&&t?' download="'+utils.escapeHTML(d)+'" ':"")+' target="_blank" rel="noopener">')}},a}.apply(g,p),u!==void 0&&(h.exports=u)}}]);
