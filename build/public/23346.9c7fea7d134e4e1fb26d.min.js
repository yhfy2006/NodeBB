(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[23346],{12236:(y,S,c)=>{"use strict";var p,E;p=[c(49897),c(29930)],E=function(F,a){const n={};n.init=function(i,e){const t=i.find(".draft-icon"),r=i.attr("data-uuid");function o(){$(`[component="composer"][data-uuid="${r}"]`).length&&(e.save_id||(e.save_id=utils.generateSaveId(app.user.uid)),n.addToDraftList("available",e.save_id),n.addToDraftList("open",e.save_id),f(i,t,e))}i.on("keyup","textarea, input.handle, input.title",utils.debounce(o,1e3)),i.on("click",'input[type="checkbox"]',utils.debounce(o,1e3)),i.on("click",'[component="category/list"] [data-cid]',utils.debounce(o,1e3)),i.on("itemAdded",".tags",utils.debounce(o,1e3)),i.on("thumb.uploaded",o),t.on("animationend",function(){$(this).toggleClass("active",!1)}),$(window).on("unload",function(){const l=n.getList("open");l.length&&l.forEach(m=>n.removeFromDraftList("open",m))}),n.migrateGuest(),n.migrateThumbs(...arguments)};function u(i){return parseInt(i,10)>0?localStorage:sessionStorage}n.get=function(i){if(!i)return null;const e=i.split(":")[1],t=u(e);try{const r=t.getItem(i),o=JSON.parse(r)||null;if(!o)throw new Error(`can't parse draft json for ${i}`);return o.save_id=i,o.timestamp&&(o.timestampISO=utils.toISOString(o.timestamp)),$(window).trigger("action:composer.drafts.get",{save_id:i,draft:o,storage:t}),o}catch{return console.warn(`[composer/drafts] Could not get draft ${i}, removing`),n.removeFromDraftList("available"),n.removeFromDraftList("open"),null}};function f(i,e,t){if(x(app.user.uid?"localStorage":"sessionStorage")&&t&&t.save_id&&i.length){const r=i.find("input.title"),o=r&&r.length&&r.val(),l=i.find("textarea").val(),m=u(app.user.uid);if(l.length||o&&o.length){const v={save_id:t.save_id,action:t.action,text:l,uuid:i.attr("data-uuid"),timestamp:Date.now()};if(t.action==="topics.post"){const P=i.find("input.tags").val();v.tags=P,v.title=o,v.cid=t.cid}else t.action==="posts.reply"?(v.title=t.title,v.tid=t.tid,v.toPid=t.toPid):t.action==="posts.edit"&&(v.pid=t.pid,v.title=o||t.title);app.user.uid||(v.handle=i.find("input.handle").val()),m.setItem(t.save_id,JSON.stringify(v)),$(window).trigger("action:composer.drafts.save",{storage:m,postData:t,postContainer:i}),e.toggleClass("active",!0)}else n.removeDraft(t.save_id)}}n.removeDraft=function(i){if(!i)return;n.removeFromDraftList("available",i),n.removeFromDraftList("open",i);const e=i.split(":")[1],t=u(e);t.removeItem(i),$(window).trigger("action:composer.drafts.remove",{storage:t,save_id:i})},n.getList=function(i){try{const e=localStorage.getItem(`drafts:${i}`);return JSON.parse(e)||[]}catch{return console.warn("[composer/drafts] Could not read list of available drafts"),[]}},n.addToDraftList=function(i,e){if(!x(app.user.uid?"localStorage":"sessionStorage")||!e)return;const t=n.getList(i);t.includes(e)||(t.push(e),localStorage.setItem("drafts:"+i,JSON.stringify(t)))},n.removeFromDraftList=function(i,e){if(!x(app.user.uid?"localStorage":"sessionStorage")||!e)return;const t=n.getList(i);t.includes(e)&&(t.splice(t.indexOf(e),1),localStorage.setItem("drafts:"+i,JSON.stringify(t)))},n.migrateGuest=function(){if(x("localStorage")&&app.user.uid){const i=/^composer:\d+:\d$/,e=Object.keys(sessionStorage).filter(function(o){return i.test(o)}),t=new Set([]),r=e.map(function(o){const l=o.split(":");return l[1]=app.user.uid,t.add(l.join(":")),l.join(":")});return e.forEach(function(o,l){localStorage.setItem(r[l],sessionStorage.getItem(o)),sessionStorage.removeItem(o)}),t.forEach(function(o){n.addToDraftList("available",o)}),t}},n.migrateThumbs=function(i,e){if(!app.uid)return;const t=i.attr("data-uuid"),r=n.get(e.save_id);r&&r.uuid&&F.put(`/topics/${r.uuid}/thumbs`,{tid:t}).then(()=>{Promise.all([c.e(23662),c.e(65285),c.e(54516),c.e(99166),c.e(47061),c.e(11484)]).then(function(){var o=[c(71431)];(function(l){l.updateThumbCount(t,i)}).apply(null,o)}).catch(c.oe)})},n.listAvailable=function(){return n.getList("available").map(n.get).filter(Boolean)},n.getAvailableCount=function(){return n.listAvailable().length},n.open=function(i){if(!i)return;const e=n.get(i);g(i,e)},n.loadOpen=function(){if(ajaxify.data.template.login||ajaxify.data.template.register||config.hasOwnProperty("openDraftsOnPageLoad")&&!config.openDraftsOnPageLoad)return;const i=n.getList("available"),e=n.getList("open");i.length&&i.forEach(function(t){if(!t||e.includes(t))return;const r=n.get(t);if(!r||!r.text&&!r.title){n.removeFromDraftList("available",t),n.removeFromDraftList("open",t);return}g(t,r)})};function g(i,e){const r=i.split(":")[1];parseInt(app.user.uid,10)===parseInt(r,10)&&Promise.all([c.e(23662),c.e(65285),c.e(54516),c.e(99166),c.e(47061),c.e(11484)]).then(function(){var o=[c(71431)];(function(l){e.action==="topics.post"?l.newTopic({save_id:e.save_id,cid:e.cid,handle:app.user&&app.user.uid?void 0:utils.escapeHTML(e.handle),title:utils.escapeHTML(e.title),body:e.text,tags:String(e.tags||"").split(",")}):e.action==="posts.reply"?F.get("/topics/"+e.tid,{},function(m,v){if(m)return a.error(m);l.newReply({save_id:e.save_id,tid:e.tid,toPid:e.toPid,title:v.title,body:e.text})}):e.action==="posts.edit"&&l.editPost({save_id:e.save_id,pid:e.pid,title:e.title?utils.escapeHTML(e.title):void 0,body:e.text})}).apply(null,o)}).catch(c.oe)}function x(i){var e;try{e=window[i];var t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(r){return r instanceof DOMException&&(r.code===22||r.code===1014||r.name==="QuotaExceededError"||r.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}return n}.apply(S,p),E!==void 0&&(y.exports=E)},91943:(y,S,c)=>{"use strict";var p,E;p=[c(89596),c(99594),c(36159),c(51916)],E=function(F,a,n,s){var u={},f={picture:function(){var e=this;e.find("#files").attr("accept","image/*").click()},upload:function(){var e=this;e.find("#files").attr("accept","").click()},thumbs:function(){u.exitFullscreen();var e=this;Promise.all([c.e(54516),c.e(99166),c.e(47061),c.e(29567)]).then(function(){var t=[c(71431)];(function(r){const o=e.get(0).getAttribute("data-uuid"),l=r.posts[o];(l.action==="topics.post"||l.action==="posts.edit"&&l.isMain)&&n.modal.open({id:o,pid:l.pid}).then(()=>{e.trigger("thumb.uploaded"),r.updateThumbCount(o,e)})}).apply(null,t)}).catch(c.oe)},tags:function(){var e=this;e.find(".tags-container").toggleClass("hidden")},zen:function(){var e=this;$(window).one("resize",function(){function t(){s.isFullscreen||(app.toggleNavbar(!0),$("html").removeClass("zen-mode"),a.reposition(e),$(window).off("resize",t))}s.isFullscreen&&(app.toggleNavbar(!1),$("html").addClass("zen-mode"),e.find(".write").focus(),$(window).on("resize",t),$(window).one("action:composer.topics.post action:composer.posts.reply action:composer.posts.edit action:composer.discard",s.exit))}),s.toggle(e.get(0)),$(window).trigger("action:composer.fullscreen",{postContainer:e})}},g=[];u.exitFullscreen=function(){s.isEnabled&&s.isFullscreen&&s.exit()},u.addComposerButtons=function(){const e=$(".formatting-bar"),t=e.find(".formatting-group #fileForm");g.forEach(o=>{let l="";Array.isArray(o.dropdownItems)&&o.dropdownItems.length?l=i(o):l=`
					<li title="${o.title||""}">
						<button data-format="${o.name}" class="btn btn-sm btn-link text-reset position-relative" aria-label="${o.title||""}">
							<i class="${o.iconClass}"></i>
							${x(o)}
						</button>
					</li>
				`,t.before(l)}),e.find(".formatting-group>li").tooltip({container:"#content",animation:!1,trigger:"manual"}).on("mouseenter",function(o){const l=$(o.target);l.hasClass("dropdown-menu")||!!l.parents(".dropdown-menu").length||$(this).tooltip("show")}).on("click mouseleave",function(){$(this).tooltip("hide")})};function x(e){let t="";return e.badge&&(t='<span class="px-1 position-absolute top-0 start-100 translate-middle badge rounded text-bg-info"></span>'),t}function i(e){const t=e.dropdownItems.map(function(r){return`
				<li>
					<a href="#" data-format="${r.name}" class="dropdown-item rounded-1 position-relative" role="menuitem">
						<i class="${r.iconClass} text-secondary"></i> ${r.text}
						${x(r)}
					</a>
				</li>
			`});return`
			<li class="dropdown bottom-sheet" tab-index="-1" title="${e.title}">
				<button class="btn btn-sm btn-link text-reset" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="${e.title}">
					<i class="${e.iconClass}"></i>
				</button>
				<ul class="dropdown-menu p-1" role="menu">
				${t}
				</ul>
			</li>
		`}return u.addButton=function(e,t,r,o){o=o||e.replace("fa fa-",""),f[o]=t,g.push({name:o,iconClass:e,title:r})},u.addDropdown=function(e){g.push({iconClass:e.iconClass,title:e.title,dropdownItems:e.dropdownItems}),e.dropdownItems.forEach(t=>{t.name&&t.onClick&&(f[t.name]=t.onClick)})},u.getDispatchTable=function(){return f},u.addButtonDispatch=function(e,t){f[e]=t},u.addHandler=function(e){e.on("click",".formatting-bar [data-format]",function(t){var r=$(this).attr("data-format"),o=$(this).parents('[component="composer"]').find("textarea")[0];f.hasOwnProperty(r)&&(f[r].call(e,o,o.selectionStart,o.selectionEnd,t),F.render(e))})},u}.apply(S,p),E!==void 0&&(y.exports=E)},62590:(y,S,c)=>{"use strict";var p,E;p=[c(91749)],E=function(F){var a={};return a.render=function(n,s){if(s=s||function(){},!n.find(".preview-container").is(":visible"))return s();var u=n.find("textarea");socket.emit("plugins.composer.renderPreview",u.val(),function(f,g){f||(g=$("<div>"+g+"</div>"),g.find("img:not(.not-responsive)").addClass("img-fluid"),n.find(".preview").html(g),F.fire("action:composer.preview",{postContainer:n,preview:g}),s())})},a.matchScroll=function(n){if(n.find(".preview-container").is(":visible")){var s=n.find("textarea"),u=n.find(".preview");if(s.length&&u.length){var f=s[0].scrollHeight-s.height();if(f===0)return;var g=s.scrollTop()/f;u.scrollTop(Math.max(u[0].scrollHeight-u.height(),0)*g)}}},a.handleToggler=function(n){const s=n.get(0);a.env=utils.findBootstrapEnvironment();const u=["xs","sm"].includes(a.env),f=s.querySelector('.formatting-bar [data-action="preview"]'),g=f.querySelector(".show-text"),x=f.querySelector(".hide-text"),i=localStorage.getItem("composer:previewToggled"),e=config["composer-default"].hidePreviewOnOpen==="on";let t=!u&&(i===null&&!e||i==="true");const r=s.querySelector(".preview-container"),o=s.querySelector(".write-container");if(!f)return;function l(m){u?(r.classList.toggle("hide",!1),o.classList.toggle("maximized",!1),r.classList.toggle("d-none",!m),r.classList.toggle("d-flex",m),r.classList.toggle("w-100",m),o.classList.toggle("d-flex",!m),o.classList.toggle("d-none",m),o.classList.toggle("w-100",!m)):(r.classList.toggle("hide",!m),o.classList.toggle("w-50",m),o.classList.toggle("w-100",!m),localStorage.setItem("composer:previewToggled",m)),g.classList.toggle("hide",m),x.classList.toggle("hide",!m),m&&a.render(n),a.matchScroll(n)}a.toggle=l,f.addEventListener("click",m=>{m.button===0&&(t=!t,l(t))}),l(t)},a}.apply(S,p),E!==void 0&&(y.exports=E)},57904:(y,S,c)=>{"use strict";var p,E;p=[c(14063)],E=function(F){var a={},n=0,s=.3,u=.05,f=768,g=$("body"),x=$(window),i=$('[component="navbar"]');const e=document.getElementById("content");var t=i[0];function r(){return localStorage.getItem("composer:resizeRatio")||.5}function o(d){localStorage.setItem("composer:resizeRatio",Math.min(d,1))}function l(){var d;t?d=t.getBoundingClientRect():d={bottom:0};var h=Math.max(d.bottom,0),w={top:0,left:0,right:window.innerWidth,bottom:window.innerHeight};return w.width=w.right,w.height=w.bottom,w.boundedTop=h,w.boundedHeight=w.bottom-h,w}function m(d,h){var w=l(),A=d[0],M=window.getComputedStyle(A),O=parseInt(M.getPropertyValue("min-height"),10),T=Math.max(O/window.innerHeight,s);if(w.width>=f){const B=(w.height-w.boundedHeight)/w.height;h=Math.min(Math.max(h,T+B),1);var z=h*w.boundedHeight/w.height;A.style.top=((1-z)*100).toString()+"%";var L=A.getBoundingClientRect();e.style.paddingBottom=(L.bottom-L.top).toString()+"px"}else A.style.top=0,e.style.paddingBottom=0;d.ratio=h,F.updateActive(d.attr("data-uuid"))}var v=m,P=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;return P&&(v=function(d,h){P(function(){m(d,h),setTimeout(function(){x.trigger("action:composer.resize"),d.trigger("action:composer.resize")},0)})}),a.reposition=function(d){var h=r();h>=1-u&&(h=1,d.addClass("maximized")),v(d,h)},a.maximize=function(d,h){h?v(d,1):a.reposition(d)},a.handleResize=function(d){var h=0,w=0,A=0,M=d.find(".resizer"),O=M[0];function T(b){var D=O.getBoundingClientRect(),R=(D.top+D.bottom)/2;h=(R-b.clientY)/2,w=b.clientY,x.on("mousemove",z),x.on("mouseup",L),g.on("touchmove",B)}function z(b){var D=b.clientY-h,R=l(),I=(R.height-D)/R.boundedHeight;v(d,I)}function L(b){b.preventDefault(),A=b.clientY,d.find("textarea").focus(),x.off("mousemove",z),x.off("mouseup",L),g.off("touchmove",B);var D=A-h,R=l(),I=(R.height-D)/R.boundedHeight;A-w===0&&d.hasClass("maximized")?(d.removeClass("maximized"),I=!n||n>=1-u?.5:n,v(d,I)):A-w===0||I>=1-u?(v(d,1),d.addClass("maximized"),n=I):d.removeClass("maximized"),o(I)}function B(b){b.preventDefault(),z(b.touches[0])}M.on("mousedown",function(b){b.button===0&&(b.preventDefault(),T(b))}).on("touchstart",function(b){b.preventDefault(),T(b.touches[0])}).on("touchend",L)},a}.apply(S,p),E!==void 0&&(y.exports=E)},51916:y=>{/*!
* screenfull
* v5.2.0 - 2021-11-03
* (c) Sindre Sorhus; MIT License
*/(function(){"use strict";var S=typeof window<"u"&&typeof window.document<"u"?window.document:{},c=y.exports,p=function(){for(var a,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=0,u=n.length,f={};s<u;s++)if(a=n[s],a&&a[1]in S){for(s=0;s<a.length;s++)f[n[0][s]]=a[s];return f}return!1}(),E={change:p.fullscreenchange,error:p.fullscreenerror},F={request:function(a,n){return new Promise(function(s,u){var f=function(){this.off("change",f),s()}.bind(this);this.on("change",f),a=a||S.documentElement;var g=a[p.requestFullscreen](n);g instanceof Promise&&g.then(f).catch(u)}.bind(this))},exit:function(){return new Promise(function(a,n){if(!this.isFullscreen){a();return}var s=function(){this.off("change",s),a()}.bind(this);this.on("change",s);var u=S[p.exitFullscreen]();u instanceof Promise&&u.then(s).catch(n)}.bind(this))},toggle:function(a,n){return this.isFullscreen?this.exit():this.request(a,n)},onchange:function(a){this.on("change",a)},onerror:function(a){this.on("error",a)},on:function(a,n){var s=E[a];s&&S.addEventListener(s,n,!1)},off:function(a,n){var s=E[a];s&&S.removeEventListener(s,n,!1)},raw:p};if(!p){c?y.exports={isEnabled:!1}:window.screenfull={isEnabled:!1};return}Object.defineProperties(F,{isFullscreen:{get:function(){return!!S[p.fullscreenElement]}},element:{enumerable:!0,get:function(){return S[p.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return!!S[p.fullscreenEnabled]}}}),c?y.exports=F:window.screenfull=F})()}}]);
