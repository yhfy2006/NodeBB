"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[92619,33069],{92619:(y,H,c)=>{var B,I;B=[c(52473),c(14063),c(17459),c(91749),c(40027),c(29930),c(49897)],I=function(U,p,r,m,k,h,A){const i={};let o=!1;i.openChat=function(t,e){if(!app.user.uid)return h.error("[[error:not-logged-in]]");function a(d){i.load(d.attr("data-uuid")),i.center(d),i.focusInput(d)}m.fire("filter:chat.openChat",{modal:!0,roomId:t,uid:e}).then(d=>{if(!d.modal)return ajaxify.go(`/chats/${t}`);i.modalExists(t)?a(i.getModal(t)):A.get(`/chats/${t}`,{uid:e||app.user.uid}).then(s=>{s.users=s.users.filter(function(f){return f&&parseInt(f.uid,10)!==parseInt(app.user.uid,10)}),s.uid=e||app.user.uid,s.isSelf=!0,i.createModal(s,a)}).catch(h.error)})},i.newChat=function(t,e){function a(){A.post("/chats",{uids:[t]}).then(({roomId:d})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+d):i.openChat(d),e(null,d)}).catch(h.error)}if(e=e||function(){},!app.user.uid)return h.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return h.error("[[error:cant-chat-with-yourself]]");A.get(`/users/${t}/status`).then(({status:d})=>{if(d!=="dnd")return a();k.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(s){s&&a()})}).catch(h.error)},i.loadChatsDropdown=function(t){A.get("/chats",{uid:app.user.uid,after:0}).then(e=>{const a=e.rooms.map(d=>(d&&d.teaser&&(d.teaser.timeagoLong=$.timeago(new Date(parseInt(d.teaser.timestamp,10)))),d));r.toggleTimeagoShorthand(async function(){a.forEach(f=>{f&&f.teaser&&(f.teaser.timeago=$.timeago(new Date(parseInt(f.teaser.timestamp,10))),f.teaser.timeagoShort=f.teaser.timeago)}),r.toggleTimeagoShorthand();const d=await app.parseAndTranslate("partials/chats/dropdown",{rooms:a}),s=t.get(0);t.find("*").not(".navigation-link").remove(),t.prepend(d),t.off("click").on("click","[data-roomid]",function(f){if([".user-link",".mark-read"].some(n=>f.target.closest(n)))return;const v=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+v):i.openChat(v)}),s.removeEventListener("click",u),s.addEventListener("click",u),$('[component="chats/mark-all-read"]').off("click").on("click",async function(){const f=document.querySelectorAll('[component="chat/list"] [data-roomid]');await Promise.all(Array.prototype.map.call(f,async v=>{const n=v.getAttribute("data-roomid");await A.del(`/chats/${n}/state`),ajaxify.data.template.chats&&i.markChatElUnread($(v),!1)}))})})}).catch(h.error)};function u(t){if(!t.target.closest(".mark-read"))return;t.stopPropagation();const a=t.target.closest("[data-roomid]");i.toggleReadState(a)}i.toggleReadState=function(t){const e=!t.classList.contains("unread"),a=t.getAttribute("data-roomid");A[e?"put":"del"](`/chats/${a}/state`,{}).catch(d=>{h.error(d),i.markChatElUnread($(t),!e)}),i.markChatElUnread($(t),e)},i.isFromBlockedUser=function(t){return app.user.blocks.includes(parseInt(t,10))},i.isLookingAtRoom=function(t){return ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(t,10)},i.markChatElUnread=function(t,e){if(t.length>0){t.toggleClass("unread",e);const a=t.find(".mark-read");a.length&&(a.find(".read").toggleClass("hidden",e),a.find(".unread").toggleClass("hidden",!e))}},i.onChatMessageReceived=function(t){app.user.blocks.includes(parseInt(t.fromUid,10))||i.modalExists(t.roomId)&&(t.self=parseInt(app.user.uid,10)===parseInt(t.fromUid,10)?1:0,o||(o=t.self===0),t.message.self=t.self,t.message.timestamp=Math.min(Date.now(),t.message.timestamp),t.message.timestampISO=utils.toISOString(t.message.timestamp),l(t))};function l(t){const e=i.getModal(t.roomId),a=t.message.fromUser.username,d=t.self===1;c.e(60419).then(function(){var s=[c(60419)];(function(f){e.find('[data-mid="'+t.message.messageId+'"]').length||f.appendChatMessage(e.find('[component="chat/message/content"]'),t.message),e.is(":visible")?(p.updateActive(e.attr("data-uuid")),f.isAtBottom(e.find('[component="chat/message/content"]'))&&f.scrollToBottomAfterImageLoad(e.find('[component="chat/message/content"]'))):ajaxify.data.template.chats||i.toggleNew(e.attr("data-uuid"),!0,!0),!d&&(!e.is(":visible")||!app.isFocused)&&p.push("chat",e.attr("data-uuid"),{title:"[[modules:chat.chatting-with]] "+(t.roomName||a),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,s)}).catch(c.oe)}return i.onRoomRename=function(t){const e=i.getModal(t.roomId),a=e.find('[component="chat/room/name"]'),d=a.attr("data-icon");a.length&&a.html(t.newName?`<i class="fa ${d} text-muted"></i> ${t.newName}`:t.chatWithMessage);const s=$("<div></div>").html(t.newName).text();p.update("chat",e.attr("data-uuid"),{title:s}),m.fire("action:chat.renamed",Object.assign(t,{modal:e}))},i.onUserTyping=function(t){if(t.uid===app.user.uid||i.isFromBlockedUser(t.uid))return;const e=i.getModal(t.roomId);e.length&&i.updateTypingUserList(e,t)},i.updateTypingUserList=async function(t,{uid:e,username:a,typing:d}){const s=t.find('[component="chat/composer/typing"]'),f=s.find('[component="chat/composer/typing/users"]'),v=f.find(`[data-uid="${e}"]`);d&&!v.length?$("<div/>").attr("data-uid",e).text(a).appendTo(f):!d&&v.length&&v.remove();const n=[];f.children().each((x,C)=>{n.push($(C).text())});const g=s.find('[component="chat/composer/typing/text"]'),E=n.length>3?"n":n.length;if(E){const x=`modules:chat.user-typing-${E}`,C=r.compile.apply(null,[x,...n]);g.html(await r.translate(C))}g.toggleClass("hidden",!n.length)},i.getModal=function(t){return $("#chat-modal-"+t)},i.modalExists=function(t){return $("#chat-modal-"+t).length!==0},i.createModal=function(t,e){e=e||function(){},Promise.all([c.e(6411),c.e(54516),c.e(60419),c.e(16255),c.e(34615)]).then(function(){var a=[c(41088),c(38636),c(60419),c(65161)];(function(d,s,f,v){app.parseAndTranslate("chat",t,function(n){const g=t.roomId;if(i.modalExists(g))return e(i.getModal(t.roomId));const E=utils.generateUUID();let x=!1;n.attr("id","chat-modal-"+g),n.attr("data-roomid",g),n.attr("intervalId",0),n.attr("data-uuid",E),n.css("position","fixed"),n.appendTo($("body")),n.find(".timeago").timeago(),n.find('[data-bs-toggle="tooltip"]').tooltip({trigger:"hover",container:"#content"}),f.wrapImagesInLinks(n.find('[component="chat/messages"] .chat-content')),i.center(n),app.loadJQueryUI(function(){n.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),n.find(".modal-content").on("resize",function(R,T){T.originalSize.height!==T.size.height&&n.find(".modal-body").css("height",i.calculateChatListHeight(n))}),n.draggable({start:function(){p.updateActive(E),n.css({bottom:"auto",right:"auto"})},stop:function(){i.focusInput(n)},distance:10,handle:".modal-header"})}),d.apply(n.find('[component="chat/messages"] .chat-content')),n.find("#chat-close-btn").on("click",function(){i.close(E)});function C(){const R=U.get("chat/input").val();$(window).one("action:ajaxify.end",function(){U.get("chat/input").val(R)}),ajaxify.go(`user/${app.user.userslug}/chats/${g}`),i.close(E)}n.find(".modal-header").on("dblclick",C),n.find('button[data-action="maximize"]').on("click",C),n.find('button[data-action="minimize"]').on("click",function(){const R=n.attr("data-uuid");i.minimize(R)}),n.on("mouseup",function(){p.updateActive(n.attr("data-uuid")),x&&(x=!1)}),n.on("mousemove",function(R){R.which===1&&(x=!0)}),n.on("mousemove keypress click",function(){o&&(A.del(`/chats/${g}/state`,{}),o=!1)}),s.addActionHandlers(n.find('[component="chat/message/window"]'),g),s.addRenameHandler(g,n.find('[data-action="rename"]')),s.addLeaveHandler(g,n.find('[data-action="leave"]')),s.addDeleteHandler(g,n.find('[data-action="delete"]')),s.addSendHandlers(g,n.find(".chat-input"),n.find('[data-action="send"]')),s.addManageHandler(g,n.find('[data-action="manage"]')),s.createAutoComplete(g,n.find('[component="chat/input"]')),s.addScrollHandler(g,t.uid,n.find('[component="chat/message/content"]')),s.addScrollBottomHandler(g,n.find('[component="chat/message/content"]')),s.addParentHandler(n.find('[component="chat/message/content"]')),s.addCharactersLeftHandler(n),s.addTextareaResizeHandler(n),s.addTypingHandler(n,g),s.addIPHandler(n),s.addTooltipHandler(n),s.addUploadHandler({dragDropAreaEl:n.find(".modal-content"),pasteEl:n,uploadFormEl:n.find('[component="chat/upload"]'),uploadBtnEl:n.find('[component="chat/upload/button"]'),inputEl:n.find('[component="chat/input"]')}),f.addSocketListeners(),v.init(g,n),s.addNotificationSettingHandler(g,n),p.push("chat",n.attr("data-uuid"),{title:"[[modules:chat.chatting-with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){p.toggleNew(n.attr("data-uuid"),!t.isSelf),m.fire("action:chat.loaded",n),typeof e=="function"&&e(n)})})}).apply(null,a)}).catch(c.oe)},i.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},i.close=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');clearInterval(e.attr("intervalId")),e.attr("intervalId",0),e.remove(),e.data("modal",null),p.discard("chat",t),e.attr("data-mobile")&&i.disableMobileBehaviour(e);const a=e.attr("data-roomid");Promise.all([c.e(6411),c.e(54516),c.e(60419),c.e(16255),c.e(26832)]).then(function(){var d=[c(38636)];(function(s){s.destroyAutoComplete(a)}).apply(null,d)}).catch(c.oe),socket.emit("modules.chats.leave",a),m.fire("action:chat.closed",{uuid:t,modal:e})},i.center=function(t){const e=t.attr("data-center");if(!e||e==="false")return;let a=!1;return t.hasClass("hide")&&(t.removeClass("hide"),a=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),a&&t.addClass("hide"),t},i.load=function(t){c.e(60419).then(function(){var e=[c(60419)];(function(a){const d=$('.chat-modal[data-uuid="'+t+'"]');d.removeClass("hide"),p.updateActive(t),a.scrollToBottomAfterImageLoad(d.find(".chat-content")),i.focusInput(d);const s=d.attr("data-roomid");A.del(`/chats/${s}/state`,{}),socket.emit("modules.chats.enter",s);const f=utils.findBootstrapEnvironment();(f==="xs"||f==="sm")&&i.enableMobileBehaviour(d)}).apply(null,e)}).catch(c.oe)},i.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const e=t.find(".modal-body");e.css("height",i.calculateChatListHeight(t));function a(){e.css("height",i.calculateChatListHeight(t)),c.e(60419).then(function(){var d=[c(60419)];(function(s){s.scrollToBottom(t.find(".chat-content"))}).apply(null,d)}).catch(c.oe)}$(window).on("resize",a),$(window).one("action:ajaxify.start",function(){i.close(t.attr("data-uuid")),$(window).off("resize",a)})},i.disableMobileBehaviour=function(){app.toggleNavbar(!0)},i.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},i.minimize=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');e.addClass("hide"),p.minimize("chat",t),clearInterval(e.attr("intervalId")),e.attr("intervalId",0),m.fire("action:chat.minimized",{uuid:t,modal:e})},i.toggleNew=p.toggleNew,i}.apply(H,B),I!==void 0&&(y.exports=I)},14063:(y,H,c)=>{y=c.nmd(y);var B,I;B=[c(17459),c(91749)],I=function(U,p){const r={};let m=!1;r.init=function(){if(r.taskbar=$('[component="taskbar"]'),r.tasklist=r.taskbar.find("ul"),!r.taskbar.length||!r.tasklist.length){m=!0;return}r.taskbar.on("click","li",async function(){const o=$(this),u=o.attr("data-module"),l=o.attr("data-uuid"),t=await app.require(u);return o.hasClass("active")?t.minimize(l):(h(),t.load(l),r.toggleNew(l,!1),r.tasklist.removeClass("active"),o.addClass("active")),!1}),$(window).on("action:app.loggedOut",function(){r.closeAll()})},r.close=async function(o,u){if(m)return;if(r.tasklist.find('[data-module="'+y+'"][data-uuid="'+u+'"]').length){const t=await app.require(o);t&&typeof t.close=="function"&&t.close(u)}},r.closeAll=function(o){if(m)return;let u="[data-uuid]";o&&(u='[data-module="'+o+'"]'+u),r.tasklist.find(u).each(function(l,t){r.close(o||t.getAttribute("data-module"),t.getAttribute("data-uuid"))})},r.discard=function(o,u){if(m)return;r.tasklist.find('[data-module="'+o+'"][data-uuid="'+u+'"]').remove(),k()},r.push=function(o,u,l,t){if(t=t||function(){},m)return t();const e=r.tasklist.find('li[data-uuid="'+u+'"]'),a={module:o,uuid:u,options:l,element:e};p.fire("filter:taskbar.push",a),!e.length&&a.module?A(a,t):t(e)},r.get=function(o){return m?[]:$('[data-module="'+o+'"]').map(function(l,t){return $(t).data()})},r.minimize=function(o,u){if(m)return;r.tasklist.find('[data-module="'+o+'"][data-uuid="'+u+'"]').toggleClass("active",!1)},r.toggleNew=function(o,u,l){if(m)return;r.tasklist.find('[data-uuid="'+o+'"]').toggleClass("new",u),l||p.fire("action:taskbar.toggleNew",o)},r.updateActive=function(o){if(m)return;const u=r.tasklist.find("li");u.removeClass("active"),u.filter('[data-uuid="'+o+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+o+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},r.isActive=function(o){return m?!1:r.tasklist.find('li[data-uuid="'+o+'"]').hasClass("active")};function k(){if(m)return;r.tasklist.find("li").length>0?r.taskbar.attr("data-active","1"):r.taskbar.removeAttr("data-active")}function h(){m||r.tasklist.find(".active").removeClass("active")}function A(o,u){if(m)return u();U.translate(o.options.title,function(l){const t=$("<div></div>").text(l||"NodeBB Task").html(),e=$("<li></li>").addClass(o.options.className).html('<a href="#"'+(o.options.image?` style="background-image: url('`+o.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(o.options.icon?'<i class="fa '+o.options.icon+'"></i> ':"")+'<span aria-label="'+t+'" component="taskbar/title">'+t+"</span></a>").attr({title:t,"data-module":o.module,"data-uuid":o.uuid}).addClass(o.options.state!==void 0?o.options.state:"active");(!o.options.state||o.options.state==="active")&&h(),r.tasklist.append(e),k(),o.element=e,e.data(o),p.fire("action:taskbar.pushed",o),u(e)})}const i=function(o,u,l){switch(u){case"title":o.find('[component="taskbar/title"]').text(l);break;case"icon":o.find("i").attr("class","fa fa-"+l);break;case"image":o.find("a").css("background-image",l?'url("'+l.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":o.find("a").css("background-color",l);break;case"color":o.find("a").css("color",l);break}};return r.update=function(o,u,l){if(m)return;const t=r.tasklist.find('[data-module="'+o+'"][data-uuid="'+u+'"]');if(!t.length)return;const e=t.data();Object.keys(l).forEach(function(a){e[a]=l[a],i(t,a,l[a])}),t.data(e)},r}.apply(H,B),I!==void 0&&(y.exports=I)}}]);
