"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[18631],{18631:(C,P,r)=>{var g,f;g=[r(47536),r(91749),r(29930),r(49897)],f=function(m,v,w,A){const c={};c.init=function(e){const o=e.closest("[data-pid]"),i=o.data("pid"),t=e.find('[component="post/replies/open"]'),n=e.find('[component="post/replies/loading"]'),a=e.find('[component="post/replies/close"]');t.is(":not(.hidden)")&&n.is(".hidden")?(t.addClass("hidden"),n.removeClass("hidden"),A.get(`/posts/${i}/replies`,{},function(s,{replies:u}){const p=u;if(n.addClass("hidden"),s)return t.removeClass("hidden"),w.error(s);a.removeClass("hidden"),p.forEach((d,l)=>{d&&(d.index=l)}),m.modifyPostsByPrivileges(p);const h={posts:p,privileges:ajaxify.data.privileges,"downvote:disabled":ajaxify.data["downvote:disabled"],"reputation:disabled":ajaxify.data["reputation:disabled"],loggedIn:!!app.user.uid,hideReplies:config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0};app.parseAndTranslate("topic","posts",h,async function(d){const l=$("<ul>",{component:"post/replies",class:"list-unstyled"}).html(d).hide();e.attr("data-target-component")?o.find('[component="'+e.attr("data-target-component")+'"]').html(l):l.insertAfter(e),l.slideDown("fast"),await m.onNewPostsAddedToDom(d),v.fire("action:posts.loaded",{posts:p})})})):a.is(":not(.hidden)")&&(a.addClass("hidden"),t.removeClass("hidden"),n.addClass("hidden"),o.find('[component="post/replies"]').slideUp("fast",function(){$(this).remove()}))},c.onNewPost=function(e){const o=e.posts[0];o&&(y(o,1),e.hideReplies=config.hasOwnProperty("showNestedReplies")?!config.showNestedReplies:!0,app.parseAndTranslate("topic","posts",e,async function(i){const t=$('[component="post"][data-pid="'+o.toPid+'"] [component="post/replies"]').first();t.length&&(config.topicPostSort==="newest_to_oldest"?t.prepend(i):t.append(i),await m.onNewPostsAddedToDom(i))}))},c.onPostPurged=function(e){y(e,-1)};function y(e,o){const i=document.querySelector(`[component="post"][data-pid="${e.toPid}"]`);if(!i)return;const t=$('[component="post"][data-pid="'+e.toPid+'"]').find('[component="post/reply-count"]').first(),n=t.find('[component="post/reply-count/text"]'),a=t.find('[component="post/reply-count/avatars"]'),s=Math.max(0,(parseInt(n.attr("data-replies"),10)||0)+o),u=t.find(".timeago").attr("title",e.timestampISO),p=i.getAttribute("data-index"),h=s===1&&Math.abs(e.index-p)===1;n.attr("data-replies",s),t.toggleClass("hidden",s<=0||h),s>1?n.translateText("[[topic:replies-to-this-post, "+s+"]]"):n.translateText("[[topic:one-reply-to-this-post]]"),!a.find('[data-uid="'+e.uid+'"]').length&&s<7&&app.parseAndTranslate("topic","posts",{posts:[{replies:{count:s,hasMore:!1,users:[e.user]}}]},function(d){a.prepend(d.find('[component="post/reply-count/avatars"]').html())}),a.addClass("hasMore"),u.data("timeago",null).timeago()}return c}.apply(P,g),f!==void 0&&(C.exports=f)}}]);
